<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.17.2 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="ko" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>PHP + nginx + mysql @ docker로 게시판 구현하기 - 위즐리 블로그</title>
<meta name="description" content="Overview ">


  <meta name="author" content="Wizley">


<meta property="og:type" content="article">
<meta property="og:locale" content="ko_KR">
<meta property="og:site_name" content="위즐리 블로그">
<meta property="og:title" content="PHP + nginx + mysql @ docker로 게시판 구현하기">
<meta property="og:url" content="http://localhost:4000/dev/PHP-+-nginx-+-mysql-@-docker%EB%A1%9C-%EA%B2%8C%EC%8B%9C%ED%8C%90-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0/">


  <meta property="og:description" content="Overview ">







  <meta property="article:published_time" content="2020-02-25T00:00:00+09:00">





  

  


<link rel="canonical" href="http://localhost:4000/dev/PHP-+-nginx-+-mysql-@-docker%EB%A1%9C-%EA%B2%8C%EC%8B%9C%ED%8C%90-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Wizley",
      "url": "http://localhost:4000/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="위즐리 블로그 Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

    
  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          위즐리 블로그
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/dev/" >dev</a>
            </li><li class="masthead__menu-item">
              <a href="/android/" >android</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">토글 메뉴</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="https://avatars1.githubusercontent.com/u/32321029?s=460&v=4" alt="Wizley" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Wizley</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>I think I wanna become Android developer for now</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">팔로우</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">KR</span>
        </li>
      

      
        
          
        
          
        
          
        
      

      

      
        <li>
          <a href="mailto:wizley@kakao.com">
            <meta itemprop="email" content="wizley@kakao.com" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> 이메일
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      
        <li>
          <a href="https://github.com/wizleysw" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="PHP + nginx + mysql @ docker로 게시판 구현하기">
    <meta itemprop="description" content="Overview">
    <meta itemprop="datePublished" content="2020-02-25T00:00:00+09:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">PHP + nginx + mysql @ docker로 게시판 구현하기
</h1>
          
          <!--
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  37 분 소요

</p>
          -->
          <p class="page_data"><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> 게시일: <time datetime="2020-02-25T00:00:00+09:00">February 25, 2020</time></p>
            
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On This Page</h4></header>
              <ul class="toc__menu">
  <li><a href="#overview">Overview</a></li>
  <li><a href="#settings">Settings</a>
    <ul>
      <li><a href="#nginx">nginx</a></li>
      <li><a href="#docker-container">docker container</a></li>
      <li><a href="#docker-compose">docker compose</a></li>
    </ul>
  </li>
  <li><a href="#user-db-구현-및-계정-관련-기능-구현">User DB 구현 및 계정 관련 기능 구현</a>
    <ul>
      <li><a href="#계정정보-db-설계">계정정보 DB 설계</a></li>
      <li><a href="#db-연결-확인">DB 연결 확인</a></li>
      <li><a href="#로그인-구현">로그인 구현</a></li>
      <li><a href="#로그아웃-구현">로그아웃 구현</a></li>
      <li><a href="#회원가입-구현">회원가입 구현</a></li>
      <li><a href="#prepared-statement">prepared statement</a></li>
      <li><a href="#session">Session</a></li>
      <li><a href="#소스코드-모듈화">소스코드 모듈화</a></li>
    </ul>
  </li>
  <li><a href="#board-db-구현-및-게시판-기능-구현">Board DB 구현 및 게시판 기능 구현</a>
    <ul>
      <li><a href="#게시판-db-설계">게시판 DB 설계</a></li>
      <li><a href="#게시판-글-목록-조회-구현">게시판 글 목록 조회 구현</a></li>
      <li><a href="#게시판-글-내용-조회-구현">게시판 글 내용 조회 구현</a></li>
      <li><a href="#게시판-글-수정-구현">게시판 글 수정 구현</a></li>
      <li><a href="#게시판-글-작성-구현">게시판 글 작성 구현</a></li>
      <li><a href="#게시판-글-삭제-구현">게시판 글 삭제 구현</a></li>
      <li><a href="#키워드-검색-기능-구현">키워드 검색 기능 구현</a></li>
      <li><a href="#회원탈퇴-구현">회원탈퇴 구현</a></li>
    </ul>
  </li>
  <li><a href="#template">Template</a></li>
  <li><a href="#github-link">GITHUB link</a></li>
</ul>

            </nav>
          </aside>
        
        <h2 id="overview">Overview</h2>

<p>이번 프로젝트의 목표는 크게 3가지로 나눌 수 있을 것 같다.</p>

<p>첫 번째 목표는 웹개발을 해본다는 것이다. PHP는 대학교를 첫 입학했던 시기에는 가장 많이 사용하는 웹 개발 언어였다. 하지만 지금은 React, Django 등의 더 사용하기 쉽고 강력한 프레임웍들이 나왔고 PHP의 개발자들이 단점 보완에 적극적이지 않다는 이유등으로 점차 사용되지 않는 언어가 되어가고 있다. 하지만 기존에 구현된 수많은 사이트는 php를 사용하기 때문에 한 번쯤은 사용을 해보는 것이 좋다고 생각하였다.</p>

<p>두 번째 목표는 도커를 사용해보는 것이다. 현재 내 머리속의 스케치를 보면 php, nginx, mysql의 조합으로 이번 프로젝트를 진행하게 될 터인데 Docker의 장점을 활용하여 배포시에 환경 세팅에 대한 부분을 덜 수 있으며 가능하면 Docker를 통해 망분리를 진행해보고자 한다. 이 부분은 Docker를 아직 제대로 사용해본 적이 없기 때문에 진행되면서 보완이 될 것이라는 생각이 된다.</p>

<p>마지막으로 세 번째 목표는 보안의 관점에서 개발을 진행해보는 것이다. 고질적으로 php는 예전부터 보안적인 측면이 약했다고 생각한다. 물론 지금은 많이 발전하여 xss등에 대한 대비도 가능하겠지만 개발을 진행하면서 이런 부분들에 대해서 고민해보는 시간을 가지면 좋을 것 같았다.</p>

<p>만들고자 하는 게시판의 기본기능은 다음과 같이 요약이 가능할 것 같다.</p>

<ol>
  <li>회원가입</li>
  <li>로그인</li>
  <li>글 작성</li>
  <li>글 수정</li>
  <li>글 삭제</li>
  <li>글 조회</li>
  <li>회원탈퇴</li>
</ol>

<p>위의 모든 작업들은 DB처리가 필요하며 로그인을 위해서는 세션에 대한 구현도 필요하다. 또한 글에 대한 생성/조회/삭제의 과정은 쿼리에 대한 처리의 과정이 될 것이며 그 과정에서 xss, injection, csrf 등의 악의적인 공격이 가능한지를 검증하는 과정이 필요할 것이다. 그저 개발을 진행하는 것보다는 상용된 사이트의 모습을 모방하여 진행을 할 것인데 그 예제로는 PPOMPPU라는 사이트를 사용하게 될 것 같다. 해당 사이트의 자유게시판을 모습을 엇비슷하게 만들면 디자인에 대한 고민의 시간을 줄일 수 있다는 판단때문이다.</p>

<h2 id="settings">Settings</h2>
<p>위에서 언급했듯이 올해의 첫 프로젝트부터 Docker를 활용하기로 맘을 먹었다. 그리고 나는 Mac을 사용하기 때문에 Mac에서 도커를 생성하여 개발을 진행할 것이다. 게시판은 php, nginx, mysql의 조합으로 개발을 진행할 것인데 mysql은 DB로 사용되는 것을 알지만 nginx가 왜 필요한지에 대한 의문이 들었다.</p>

<h3 id="nginx">nginx</h3>

<p>nginx는 동시접속을 효율적으로 처리하기 위해 개발이 된 웹 서버 프로그램이며 동시접속자의 수가 700명을 초과할 경우 서버를 증설하거나 nginx를 도입한다고 한다. nginx는 크게 두 가지 역할을 가지고 있는데 첫 번째 역할이 HTTP 서버이다. Html, CSS, Javascript등의 정적인 정보들을 앞단에서 처리해줌으로써 서버의 과부하를 줄이는데 사용됨을 의미한다.</p>

<p>두 번째로는 리버스 프록시 서버로서의 역할인데 클라이언트가 웹 서버로 바로 요청을 하는 것이 아닌 nginx서버를 요청을 하고 nginx 서버에서 요청을 전달하도록 하는데, 이 상황에서 nginx가 여러 서버로 분산해서 요청을 전달하는 로드 밸런싱을 위해 사용되기도 한다는 것이다. 이를 통해 서버에 대한 노출이 최소화되며 layer가 한단계 더 추가된다는 장점이 있다.</p>

<p>또 하나의 특징으로는 비동기 처리 방식을 채택한다는 점을 들 수 있는데, 이로 인하여 1개의 연결당 하나의 쓰레드를 할당하는 방식이 아닌 Event handler가 다수의 연결을 비동기로 처리해 한정된 자원으로 처리가 가능하다. 해당 부분에 대한 설명은 아래의 링크를 참조하면 좋을 것 같다.</p>

<p><a href="https://blog.naver.com/jhc9639/221108496101">readdir과 readdirSync 성능비교와 비동기 그리고 동기</a></p>

<p>그러면 이제 Docker를 설치해야 되는데 mysql, php, nginx를 각각 다른 Container로 받아오는 작업을 할 차례이다. latest 태그를 통해 최신 버전을 받을 수 있지만 개발 환경을 통일하기 위해 모든 컨테이너를 특정 버전을 명시하여 받을 것이다.</p>

<h3 id="docker-container">docker container</h3>

<p>도커에 대한 간단한 사용법은 아래의 링크를 통해 배우면 좋다.</p>

<p><a href="https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html">초보를 위한 도커 안내서</a>
<a href="https://www.44bits.io/ko/post/almost-perfect-development-environment-with-docker-and-docker-compose">컴포즈 사용법</a></p>

<p>dockerHub 공식 사이트를 확인해보면 현재 latest의 tag를 확인할 수 있는데 글을 쓰는 현재의 nginx의 latest는 1.17버전인 것을 확인이 가능하다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">Wizley:~/Project/PHP/Board #</span><span class="w"> </span>docker pull nginx:1.17
<span class="go">1.17: Pulling from library/nginx
bc51dd8edc1b: Pull complete
66ba67045f57: Pull complete
bf317aa10aa5: Pull complete
Digest: sha256:ad5552c786f128e389a0263104ae39f3d3c7895579d45ae716f528185b36bc6f
Status: Downloaded newer image for nginx:1.17
docker.io/library/nginx:1.17
</span></code></pre></div></div>

<p>마찬가지로 같은 방식으로 php와 mysql등의 필요한 Container를 다운받는다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">Wizley:~/Project/PHP/Board #</span><span class="w"> </span>docker pull php:7.4
<span class="go">7.4: Pulling from library/php
bc51dd8edc1b: Already exists
a3224e2c3a89: Pull complete
be7a066df88f: Pull complete
bfdf741d72a9: Pull complete
ff9fc07eebd4: Pull complete
669e424fd246: Pull complete
b2d37f53b7e3: Pull complete
4d87d4b3feb8: Pull complete
d81f0fa01716: Pull complete
Digest: sha256:005e3ccd42cdb97fc609c9732708207f03729822202dab0647168e8f937e7d48
Status: Downloaded newer image for php:7.4
docker.io/library/php:7.4

</span><span class="gp">Wizley:~/Project/PHP/Board #</span><span class="w"> </span>docker pull mysql:8.0.19
<span class="go">8.0.19: Pulling from library/mysql
619014d83c02: Pull complete
9ced578c3a5f: Pull complete
731f6e13d8ea: Pull complete
3c183de42679: Pull complete
6de69b5c2f3c: Pull complete
00f0a4086406: Pull complete
84d93aea836d: Pull complete
f18efbfd8d76: Pull complete
012b302865d1: Pull complete
fe16fd240f59: Pull complete
ca3e793e545e: Pull complete
51d0f2cb2610: Pull complete
Digest: sha256:6d0741319b6a2ae22c384a97f4bbee411b01e75f6284af0cce339fee83d7e314
Status: Downloaded newer image for mysql:8.0.19
docker.io/library/mysql:8.0.19
</span></code></pre></div></div>

<p>개발 환경에 사용될 각각의 버전은 다음과 같다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
nginx               1.17                2073e0bcb60e        2 weeks ago         127MB
php                 fpm                 c17c65c110d8        2 weeks ago         405MB
php                 7.4                 7dc31b4f3403        2 weeks ago         405MB
mysql               8.0.19              791b6e40940c        2 weeks ago         465MB
</span></code></pre></div></div>

<p>(이 시점에서 알게 된 것은 PHP가 아닌 PHP-fpm을 사용하는 것이 좋다는 것이다. TechEmpower의 오래된 benchmark를 통해 php-fpm + php + nginx의 성능이 효율적이며 php-fpm을 통해 CGI의 처리 효율을 높일 수 있다고 한다.)</p>

<h3 id="docker-compose">docker compose</h3>

<p>이 시점에서 고민을 하는 건 바로 네트워크를 물리는 작업이다. Docker 컨테이너를 frontend / backend 두 개의 네트워크로 분리한 뒤 각각 nginx+php-fpm / mysql+php-fpm 로 세팅을 하는 작업을 위해 compose를 작성할 필요가 있다.</p>

<p><a href="https://docs.docker.com/compose/networking/">Networking in Compose</a></p>

<p>그 전에 Docker로 개발할 때 개발자들이 주로 타는 프로세스가 있다.</p>

<ol>
  <li>Dockerfile 작성</li>
  <li>docker-compose.yml 작성</li>
  <li>개발 : docker-compose up</li>
  <li>배포 : 이미지화 및 registry, docker stack deploy</li>
</ol>

<p>하지만 지금 시점에서 도커에 대해서 잘 모르는 상태이니 docker-compose부터 세팅을 하도록 하겠다.</p>

<p>도커 컴포즈를 통해서는 다음의 작업에 초점을 둔다.</p>

<ol>
  <li>Container의 이름</li>
  <li>image 연결</li>
  <li>network 분리(frontend/backend)</li>
  <li>port 설정</li>
</ol>

<p>여러 사이트를 통해 작성한 docker-compose.yml은 다음과 같다.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3'</span>

<span class="na">services</span><span class="pi">:</span>
 <span class="na">web</span><span class="pi">:</span>
  <span class="na">container_name</span><span class="pi">:</span> <span class="s">board_nginx</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:1.17</span>
  <span class="na">networks</span><span class="pi">:</span>
   <span class="pi">-</span> <span class="s">frontend</span>
  <span class="na">ports</span><span class="pi">:</span>
   <span class="pi">-</span> <span class="s2">"</span><span class="s">80:80"</span>
  <span class="na">volumes</span><span class="pi">:</span>
   <span class="pi">-</span> <span class="s">./board:/board</span>
   <span class="pi">-</span> <span class="s">./site.conf:/etc/nginx/conf.d/default.conf</span>
 <span class="na">php</span><span class="pi">:</span>
  <span class="na">container_name</span><span class="pi">:</span> <span class="s">board_phpfpm</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">php:fpm</span>
  <span class="na">networks</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">frontend</span>
  <span class="pi">-</span> <span class="s">backend</span>
  <span class="na">volumes</span><span class="pi">:</span>
   <span class="pi">-</span> <span class="s">./board:/board</span>
 <span class="na">db</span><span class="pi">:</span>
  <span class="na">container_name</span><span class="pi">:</span> <span class="s">board_mysql</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">mysql:8.0.19</span>
  <span class="na">networks</span><span class="pi">:</span>
   <span class="pi">-</span> <span class="s">backend</span>
  <span class="na">ports</span><span class="pi">:</span>
   <span class="pi">-</span> <span class="s2">"</span><span class="s">3300:3300"</span>
  <span class="na">volumes</span><span class="pi">:</span>
   <span class="pi">-</span> <span class="s">./mysql/data:/var/lib/mysql</span>
   <span class="pi">-</span> <span class="s">./mysql/config:/etc/mysql/conf.d</span>
  <span class="na">environment</span><span class="pi">:</span>
   <span class="pi">-</span> <span class="s">MYSQL_ROOT_PASSWORD=alpine</span>
   <span class="pi">-</span> <span class="s">MYSQL_USER=wizley</span>
   <span class="pi">-</span> <span class="s">MYSQL_PASSWORD=alpine</span>
<span class="na">networks</span><span class="pi">:</span>
 <span class="na">frontend</span><span class="pi">:</span>
 <span class="na">backend</span><span class="pi">:</span>

</code></pre></div></div>

<p>container_name은 말그대로 컨테이너의 이름을 설정하는 방법이고, image는 미리 다운받은 Docker image를 버전과 함께 명시한다. volumes의 경우 Docker내부에서 작업한 것들을 내 로컬에 저장을 하기 위해 명시한 것인데 위의 /etc/nginx/conf.d/default.conf는 도커 내부의 파일 위치이며 해당 값이 로컬의 기준으로 ./site.conf로 백업이 된다. network를 통해 frontend, backend를 명시했다.</p>

<p>이제 docker-compose up 명령어를 실행하면 다음과 같은 결과를 확인가능하다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">Wizley:~/Project/PHP/Board #</span><span class="w"> </span>docker-compose up
<span class="go">Starting board_mysql    ... done
Starting board_nginx    ... done
Recreating board_phpfpm ... done
Attaching to board_mysql, board_nginx, board_phpfpm
board_mysql | 2020-02-20 04:26:57+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.19-1debian9 started.
board_mysql | 2020-02-20 04:26:57+00:00 [Note] [Entrypoint]: Switching to dedicated user 'mysql'
board_mysql | 2020-02-20 04:26:57+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.19-1debian9 started.
php_1  | [20-Feb-2020 04:26:57] NOTICE: fpm is running, pid 1
php_1  | [20-Feb-2020 04:26:57] NOTICE: ready to handle connections
board_mysql | 2020-02-20T04:26:58.085950Z 0 [Warning] [MY-011070] [Server] 'Disabling symbolic links using --skip-symbolic-links (or equivalent) is the default. Consider not using this option as it' is deprecated and will be removed in a future release.
board_mysql | 2020-02-20T04:26:58.086081Z 0 [System] [MY-010116] [Server] /usr/sbin/mysqld (mysqld 8.0.19) starting as process 1
board_mysql | 2020-02-20T04:26:58.484400Z 0 [Warning] [MY-010068] [Server] CA certificate ca.pem is self signed.
board_mysql | 2020-02-20T04:26:58.487668Z 0 [Warning] [MY-011810] [Server] Insecure configuration for --pid-file: Location '/var/run/mysqld' in the path is accessible to all OS users. Consider choosing a different directory.
board_mysql | 2020-02-20T04:26:58.512163Z 0 [System] [MY-010931] [Server] /usr/sbin/mysqld: ready for connections. Version: '8.0.19'  socket: '/var/run/mysqld/mysqld.sock'  port: 3306  MySQL Community Server - GPL.
board_mysql | 2020-02-20T04:26:58.638064Z 0 [System] [MY-011323] [Server] X Plugin ready for connections. Socket: '/var/run/mysqld/mysqlx.sock' bind-address: '::' port: 33060
</span></code></pre></div></div>

<p>이 시점에서 docker ps -a 를 통해 세팅이 제대로 되었는지 확인해보면,</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">Wizley:~/Project/PHP/Board #</span><span class="w"> </span>docker ps <span class="nt">-a</span>
<span class="go">CONTAINER ID        IMAGE               COMMAND                  CREATED              STATUS              PORTS                                         NAMES
1f1d7824207f        php:fpm             "docker-php-entrypoi…"   About a minute ago   Up About a minute   9000/tcp                                      board_phpfpm
</span><span class="gp">966990d4455e        mysql:8.0.19        "docker-entrypoint.s…"   21 minutes ago       Up About a minute   3306/tcp, 0.0.0.0:3300-&gt;</span>3300/tcp, 33060/tcp   board_mysql
<span class="gp">12e7e8c4f6d4        nginx:1.17          "nginx -g 'daemon of…"   52 minutes ago       Up About a minute   0.0.0.0:80-&gt;</span>80/tcp                            board_nginx
</code></pre></div></div>

<p>정확히 compose의 설정대로 이미지가 올라간 것을 확인 가능하다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">Wizley:~/Project/PHP/Board #</span><span class="w"> </span>docker network <span class="nb">ls</span>
<span class="go">NETWORK ID          NAME                DRIVER              SCOPE
cf37099fabab        board_backend       bridge              local
55aa5bf4b62f        board_default       bridge              local
97a213511557        board_frontend      bridge              local
f7b586735a32        bridge              bridge              local
35b24f992dca        host                host                local
7138c9085194        none                null                local
</span></code></pre></div></div>

<p>network 명령을 통해 board_backend와 board_frontend 네트워크가 생성된 것을 확인할 수 있는데 php, mysql, nginx가 제대로 설정되었는지 까지는 확인이 불가능하였다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">Wizley:~/Project/PHP/Board #</span><span class="w"> </span>docker inspect board_backend
<span class="go">[
    {
        "Name": "board_backend",
        "Id": "cf37099fababdaae343b9775ff847000320279bb3aff4af90d754bb09a7cdc3d",
        "Created": "2020-02-20T03:28:31.4474033Z",
        "Scope": "local",
        "Driver": "bridge",
        "EnableIPv6": false,
        "IPAM": {
            "Driver": "default",
            "Options": null,
            "Config": [
                {
                    "Subnet": "172.20.0.0/16",
                    "Gateway": "172.20.0.1"
                }
            ]
        },
        "Internal": false,
        "Attachable": true,
        "Ingress": false,
        "ConfigFrom": {
            "Network": ""
        },
        "ConfigOnly": false,
        "Containers": {
            "1f1d7824207f556488e8202b92553b1d8dc8da773c34b5d509097cea0318a591": {
                "Name": "board_phpfpm",
                "EndpointID": "a8f5c89d1c7111a4e0f839bb1115b418102b3af2e513a024cbdb9a30ee8fafd2",
                "MacAddress": "02:42:ac:14:00:03",
                "IPv4Address": "172.20.0.3/16",
                "IPv6Address": ""
            },
            "966990d4455e6ab0336d7f9133a0bc1b3f8bee66d156d5a74ad96a3cbd89f8fc": {
                "Name": "board_mysql",
                "EndpointID": "8ef4a9896952cf15457f6c1600441dabcf6854c2e4d87e06bb307f0a00ab2311",
                "MacAddress": "02:42:ac:14:00:02",
                "IPv4Address": "172.20.0.2/16",
                "IPv6Address": ""
            }
        },
        "Options": {},
        "Labels": {
            "com.docker.compose.network": "backend",
            "com.docker.compose.project": "board",
            "com.docker.compose.version": "1.25.4"
        }
    }
]
</span></code></pre></div></div>

<p>하지만 다행히도 docker inspect를 통해 board_backend의 Containers부분을 통해 board_phpfpm과 board_mysql이 같은 네트워크에 연동된 것을 확인할 수 있다.</p>

<p>이제 국룰인 HelloWorld를 띄워볼 차례이다.</p>

<p><a href="https://teamsmiley.github.io/2018/12/29/php-docker/">Docker를 사용하여 php를 운영해보자</a></p>

<p>위의 사이트를 참조하여 아래와 같이 site.conf를 작성하였다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">Wizley:~/Project/PHP/Board #</span><span class="w"> </span><span class="nb">cat </span>site.conf
<span class="go">server {
</span><span class="gp">    index index.php;</span><span class="w">
</span><span class="gp">    server_name wizley.com;</span><span class="w">
</span><span class="gp">    error_log  /var/log/nginx/error.log;</span><span class="w">
</span><span class="gp">    access_log /var/log/nginx/access.log;</span><span class="w">
</span><span class="gp">    root /board;</span><span class="w">
</span><span class="go">
</span><span class="gp">    location ~ \.php$</span><span class="w"> </span><span class="o">{</span>
<span class="gp">        try_files $</span>uri <span class="o">=</span>404<span class="p">;</span>
<span class="gp">        fastcgi_split_path_info ^(.+\.php)(/.+)$</span><span class="p">;</span>
<span class="gp">        fastcgi_pass php:9000;</span><span class="w">
</span><span class="gp">        fastcgi_index index.php;</span><span class="w">
</span><span class="gp">        include fastcgi_params;</span><span class="w">
</span><span class="gp">        fastcgi_param SCRIPT_FILENAME $</span>document_root<span class="nv">$fastcgi_script_name</span><span class="p">;</span>
<span class="gp">        fastcgi_param PATH_INFO $</span>fastcgi_path_info<span class="p">;</span>
<span class="go">    }
}
</span></code></pre></div></div>

<p>이제 board 디렉토리로 이동하여 아래와 같이 index.html을 생성한다.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Wizley:~/Project/PHP/Board/board # cat index.html
<span class="nt">&lt;html&gt;</span>
helloworld
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>그 결과 localhost에 접속하면 영롱한 helloworld 문구를 확인할 수 있다.</p>

<p><img src="https://raw.githubusercontent.com/wizleysw/wizleysw.github.io/master/_posts/img/php_board/helloworld.png" alt="helloworld" /></p>

<p>이제 database 설계를 진행할 것인데 가장 먼저 User 정보에 대한 부분의 설계를 해야된다.</p>

<h2 id="user-db-구현-및-계정-관련-기능-구현">User DB 구현 및 계정 관련 기능 구현</h2>

<p>이제 DB를 설계해야되는데 게시판 기능을 크게 보았을 때 2개의 부류로 나눌 수 있다. 계정과 작성글이다.</p>

<h3 id="계정정보-db-설계">계정정보 DB 설계</h3>

<p>회원가입 기능을 통해 계정정보를 생성할 때 가장 중요한 것은 ID와 PASSWORD일 것이다. 그리고 부가적으로 효율적인 관리를 위해서 계정 생성일자 및 고유식별번호, 계정의 정지 활성화 여부판단에 사용될 상태정보, 닉네임 정도를 들 수 있겠다. 이를 정리해서 나타내면 다음과 같다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- id
- password
- created
- unique_id
- status
- nickname
</code></pre></div></div>

<p>이를 위해서 크게 User라는 데이터 베이스를 생성하고 account라는 table에 위의 정보를 추가하는 작업을 수행하도록 하겠다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">Wizley:~/Project/PHP/php_board #</span><span class="w"> </span>docker ps <span class="nt">-a</span>
<span class="go">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                         NAMES
</span><span class="gp">b734c92f7c80        nginx:1.17          "nginx -g 'daemon of…"   10 minutes ago      Up 10 minutes       0.0.0.0:80-&gt;</span>80/tcp                            board_nginx
<span class="gp">f68ab5883779        mysql:8.0.19        "docker-entrypoint.s…"   10 minutes ago      Up 10 minutes       3306/tcp, 0.0.0.0:3300-&gt;</span>3300/tcp, 33060/tcp   board_mysql
<span class="go">205810f910ad        php:fpm             "docker-php-entrypoi…"   10 minutes ago      Up 10 minutes       9000/tcp                                      board_phpfpm

</span><span class="gp">Wizley:~/Project/PHP/php_board #</span><span class="w"> </span>docker <span class="nb">exec</span> <span class="nt">-it</span> board_mysql /bin/bash
<span class="gp">root@f68ab5883779:/#</span><span class="w"> </span>mysql <span class="nt">-u</span> wizley <span class="nt">-p</span>
<span class="go">Enter password:
</span><span class="gp">Welcome to the MySQL monitor.  Commands end with ;</span><span class="w"> </span>or <span class="se">\g</span><span class="nb">.</span>
<span class="go">Your MySQL connection id is 8
Server version: 8.0.19 MySQL Community Server - GPL

Copyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

</span><span class="gp">Type 'help;</span><span class="s1">' or '</span><span class="se">\h</span><span class="s1">' for help. Type '</span><span class="se">\c</span><span class="s1">' to clear the current input statement.
</span><span class="go">
</span><span class="gp">mysql&gt;</span><span class="w">
</span></code></pre></div></div>

<p>exec 명령어를 통해 Container 내부로 접속하였다. 이제 database를 추가하면 된다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">mysql&gt;</span><span class="w"> </span>show databases<span class="p">;</span>
<span class="go">+--------------------+
| Database           |
+--------------------+
| information_schema |
+--------------------+
1 row in set (0.01 sec)

</span><span class="gp">mysql&gt;</span><span class="w"> </span>CREATE DATABASE User<span class="p">;</span>
<span class="go">ERROR 1044 (42000): Access denied for user 'wizley'@'%' to database 'User'
</span></code></pre></div></div>

<p>하지만 여기서 Access Denied를 통해 Wizley라는 계정의 권한으로 작업을 수행하지 못한다는 문구가 나온다. 이를 해결하기 위해서는 몇가지 명령어를 실행해야 한다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">mysql&gt;</span><span class="w"> </span>grant all privileges on <span class="k">*</span> <span class="nb">.</span> <span class="k">*</span> to <span class="s1">'wizley'</span>@<span class="s1">'%'</span><span class="p">;</span>
<span class="go">Query OK, 0 rows affected (0.01 sec)
</span></code></pre></div></div>

<p>위의 명령어를 수행하고 나서 다시 wizley로 로그인을 하면 다음과 같이 databases가 추가로 보이는 것을 확인 가능하다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">root@f68ab5883779:/#</span><span class="w"> </span>mysql <span class="nt">-u</span> wizley <span class="nt">-p</span>
<span class="go">Enter password:

</span><span class="gp">mysql&gt;</span><span class="w"> </span>show databases<span class="p">;</span>
<span class="go">+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| sys                |
+--------------------+
</span></code></pre></div></div>

<p>이제 User라는 데이터베이스를 추가하는 작업이 가능하다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">mysql&gt;</span><span class="w"> </span>CREATE DATABASE User<span class="p">;</span>
<span class="go">Query OK, 1 row affected (0.00 sec)

</span><span class="gp">mysql&gt;</span><span class="w"> </span>show databases<span class="p">;</span>
<span class="go">+--------------------+
| Database           |
+--------------------+
| User               |
| information_schema |
| mysql              |
| performance_schema |
| sys                |
+--------------------+
5 rows in set (0.00 sec)
</span></code></pre></div></div>

<p>User라는 데이터베이스를 추가하였고 목록에 추가된 것을 확인이 가능하다. 이제 조건에 맞게 account라는 Table을 생성할 것인데 이 경우에 NOT_NULL, PRIMARY KEY등의 설정이 필요하다. uniqueID의 경우 겹치는 값이 있으면 안되기 때문에 PRIMARY KEY가 설정되어 있어야 하며, ID또는 PASSWORD또한 없으면 안되는 정보이기에 NOT_NULL 조건이 붙어야 된다는 의미이다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">mysql&gt;</span><span class="w"> </span>use User<span class="p">;</span>
<span class="go">Database changed
</span><span class="gp">mysql&gt;</span><span class="w"> </span>CREATE TABLE Account
<span class="gp">    -&gt;</span><span class="w"> </span><span class="o">(</span>
<span class="gp">    -&gt;</span><span class="w"> </span>uniqueID INT NOT NULL AUTO_INCREMENT,
<span class="gp">    -&gt;</span><span class="w"> </span>userID CHAR<span class="o">(</span>16<span class="o">)</span> NOT NULL,
<span class="gp">    -&gt;</span><span class="w"> </span>password CHAR<span class="o">(</span>128<span class="o">)</span> NOT NULL,
<span class="gp">    -&gt;</span><span class="w"> </span>created DATETIME,
<span class="gp">    -&gt;</span><span class="w"> </span>status INT NOT NULL,
<span class="gp">    -&gt;</span><span class="w"> </span>nickname VARCHAR<span class="o">(</span>10<span class="o">)</span> NOT NULL,
<span class="gp">    -&gt;</span><span class="w"> </span>PRIMARY KEY<span class="o">(</span>uniqueID<span class="o">)</span>
<span class="gp">    -&gt;</span><span class="w"> </span><span class="o">)</span><span class="p">;</span>
<span class="go">Query OK, 0 rows affected (0.02 sec)

</span><span class="gp">mysql&gt;</span><span class="w"> </span>show tables<span class="p">;</span>
<span class="go">+----------------+
| Tables_in_User |
+----------------+
| Account        |
+----------------+
1 row in set (0.00 sec)
</span></code></pre></div></div>

<p>Account라는 테이블을 위의 설계와 같이 생성하였다. 이제 테스트를 위해 하나의 계정을 생성해보았다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">mysql&gt;</span><span class="w"> </span>INSERT INTO Account<span class="o">(</span>userID, password, status, nickname<span class="o">)</span> VALUES<span class="o">(</span><span class="s1">'admin'</span>, <span class="s1">'alpine'</span>, 1, <span class="s1">'Admin'</span><span class="o">)</span><span class="p">;</span>
<span class="go">Query OK, 1 row affected (0.00 sec)

</span><span class="gp">mysql&gt;</span><span class="w"> </span><span class="k">select</span> <span class="k">*</span> from Account<span class="p">;</span>
<span class="go">+----------+--------+----------+---------+--------+----------+
| uniqueID | userID | password | created | status | nickname |
+----------+--------+----------+---------+--------+----------+
|        1 | admin  | alpine   | NULL    |      1 | Admin    |
+----------+--------+----------+---------+--------+----------+
1 row in set (0.00 sec)
</span></code></pre></div></div>

<h3 id="db-연결-확인">DB 연결 확인</h3>

<p>admin이라는 계정이 alpine이라는 패스워드로 생성된 것을 확인할 수 있다. 이제 제대로 DB가 backend 네트워크로 연결이 되었는지 확인을 하기 위해서 간단한 php 코드를 작성해볼 것이다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
	<span class="nv">$conn</span> <span class="o">=</span> <span class="nb">mysqli_connect</span><span class="p">(</span><span class="s1">'db'</span><span class="p">,</span> <span class="s1">'wizley'</span><span class="p">,</span> <span class="s1">'alpine'</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$conn</span><span class="p">){</span>
		<span class="k">die</span><span class="p">(</span><span class="s2">"Connection Error!"</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">echo</span> <span class="s2">"Success!"</span><span class="p">;</span>
	<span class="nx">mysqli_close</span><span class="p">(</span><span class="nv">$conn</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<p>위와 같은 코드를 작성하고 구동을 해보았더니 Undefined mysqli_connect 에러가 발생하였다. php-mysqli가 설치되지 않아서 발생하는 문제였다. 해당 부분을 수정하기 위해 많은 삽질을 하였지만 기존의 Container에서는 고치지 못하였기에 다른 Image를 땡겨 쓰기로 마음먹었다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">FROM php:fpm-alpine
RUN docker-php-ext-install mysqli
</span></code></pre></div></div>

<p>위와 같이 Dockerfile을 생성하였고 build를 하였다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">Wizley:~/Project/PHP/php_board #</span><span class="w"> </span>docker build <span class="nt">--tag</span> phpmysqli:1.0 <span class="nb">.</span>
<span class="go">Sending build context to Docker daemon  198.9MB
Step 1/2 : FROM php:fpm-alpine
fpm-alpine: Pulling from library/php
c9b1b535fdd9: Pull complete
c1c0a1817bec: Pull complete
cdd5b3ea1fc3: Pull complete
db87396003bd: Pull complete
6e71cca12e10: Pull complete
ed2310d2f791: Pull complete
601ef2217a14: Pull complete
41dc18d982f5: Pull complete
72be421f63f8: Pull complete
f10dd871243f: Pull complete
</span></code></pre></div></div>

<p>그 후에 설치된 image 목록을 확인해보면 phpmysqli가 추가된 것을 확인할 수 있다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">Wizley:~ #</span><span class="w"> </span>docker images
<span class="go">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
phpmysqli           1.0                 b5cd17f37d99        6 minutes ago       83.9MB
nginx               1.17                2073e0bcb60e        2 weeks ago         127MB
php                 fpm                 c17c65c110d8        2 weeks ago         405MB
php                 7.4                 7dc31b4f3403        2 weeks ago         405MB
mysql               8.0.19              791b6e40940c        2 weeks ago         465MB
php                 fpm-alpine          4a1ce12adee5        3 weeks ago         83.6MB
</span></code></pre></div></div>

<p>이제 docker-compose 파일에서도 약간의 수정이 필요하다.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="na">php</span><span class="pi">:</span>
  <span class="na">container_name</span><span class="pi">:</span> <span class="s">board_phpmysqli</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">b5cd17f37d99</span>
  <span class="na">networks</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">frontend</span>
  <span class="pi">-</span> <span class="s">backend</span>
  <span class="na">volumes</span><span class="pi">:</span>
   <span class="pi">-</span> <span class="s">./board:/board</span>
</code></pre></div></div>

<p>image부분에 위의 IMAGE ID를 넣어주었고 container_name도 board_phpmysqli로 변경하였다. 그 후에 구동을 하면 Success! 문구가 뜨는 것을 확인 가능하다.</p>

<p>이제 좀더 세부적인 데이터를 가져오도록 할 것이다. DB안에 맨 처음 추가한 admin을 조회하는 간단한 쿼리문을 짜볼 것이다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
	<span class="nv">$conn</span> <span class="o">=</span> <span class="nb">mysqli_connect</span><span class="p">(</span><span class="s2">"db"</span><span class="p">,</span> <span class="s2">"wizley"</span><span class="p">,</span> <span class="s2">"alpine"</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$conn</span><span class="p">){</span>
		<span class="k">die</span><span class="p">(</span><span class="s2">"Connection Error!"</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="nx">mysqli_select_db</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span> <span class="s2">"User"</span><span class="p">);</span>
	<span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT * FROM Account"</span><span class="p">;</span>
	<span class="nv">$result</span> <span class="o">=</span> <span class="nx">mysqli_query</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span> <span class="nv">$query</span><span class="p">);</span>
	<span class="nv">$row</span> <span class="o">=</span> <span class="nx">mysqli_fetch_array</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>
	<span class="k">echo</span> <span class="s2">"UserID   : "</span> <span class="o">.</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'userID'</span><span class="p">]</span> <span class="o">.</span> <span class="s2">"&lt;br&gt;"</span><span class="p">;</span>
	<span class="k">echo</span> <span class="s2">"password : "</span> <span class="o">.</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'password'</span><span class="p">]</span> <span class="o">.</span> <span class="s2">"&lt;br&gt;"</span><span class="p">;</span>
	<span class="nx">mysqli_close</span><span class="p">(</span><span class="nv">$conn</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<p>확인해보면 아래와 같이 admin / alpine이라는 정보를 가져온 것을 확인할 수 있다!</p>

<p><img src="https://raw.githubusercontent.com/wizleysw/wizleysw.github.io/master/_posts/img/php_board/queryCheck.png" alt="queryCheck" /></p>

<p>이제 원하는대로 DB의 쿼리작업이 가능하게 되었다.</p>

<h3 id="로그인-구현">로그인 구현</h3>

<p>쿼리의 조회가 가능하기 때문에 userID와 password를 사용하여 올바른 계정정보인지 검사하는 루틴에 대한 작성이 가능하다. 지금 이 단계에서는 loginForm이라는 HTML페이지를 생성한 뒤 loginCheck.php를 통해 조회하는 기능을 구현해볼 것이다.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
	<span class="nt">&lt;title&gt;</span>로그인<span class="nt">&lt;/title&gt;</span>
	<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
	<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"loginCheck.php"</span> <span class="na">method=</span><span class="s">"POST"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"userID"</span> <span class="na">placeholder=</span><span class="s">"아이디"</span><span class="nt">&gt;&lt;br&gt;</span>
		<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">placeholder=</span><span class="s">"패스워드"</span><span class="nt">&gt;&lt;br&gt;</span>
		<span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>로그인<span class="nt">&lt;/button&gt;</span>
	<span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/body&gt;</span>
</code></pre></div></div>

<p>위와 같이 간단하게 FORM을 생성하였고 userID와 password를 입력받은 뒤에 submit 버튼을 통해 loginCheck.php로 검사로직이 넘어가도록 구현을 하였다. 이제 loginCheck.php를 작성할 차례이다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
	<span class="nv">$conn</span> <span class="o">=</span> <span class="nb">mysqli_connect</span><span class="p">(</span><span class="s2">"db"</span><span class="p">,</span> <span class="s2">"wizley"</span><span class="p">,</span> <span class="s2">"alpine"</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$conn</span><span class="p">){</span>
		<span class="k">die</span><span class="p">(</span><span class="s2">"Connection Error!!"</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="nx">mysqli_select_db</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span> <span class="s2">"User"</span><span class="p">);</span>
	<span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT * FROM Account WHERE userID = '</span><span class="si">{</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'userID'</span><span class="p">]</span><span class="si">}</span><span class="s2">' AND password = '</span><span class="si">{</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'password'</span><span class="p">]</span><span class="si">}</span><span class="s2">'"</span><span class="p">;</span>
	<span class="nv">$result</span> <span class="o">=</span> <span class="nx">mysqli_query</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span> <span class="nv">$query</span><span class="p">);</span>
	<span class="nv">$row</span> <span class="o">=</span> <span class="nx">mysqli_fetch_array</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>

	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$row</span><span class="p">){</span>
		<span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("아이디 또는 패스워드가 올바르지 않습니다.");'</span><span class="p">;</span>
		<span class="k">echo</span> <span class="s1">'location.href="/loginForm.php";&lt;/script&gt;'</span><span class="p">;</span>
		<span class="k">exit</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">echo</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'userID'</span><span class="p">]</span> <span class="o">.</span> <span class="s2">"님"</span><span class="p">;</span>
	<span class="nx">mysqli_close</span><span class="p">(</span><span class="nv">$conn</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<p>POST로 전송된 userID와 password가 db의 User Database의 Account 테이블 내에서 올바른 값인지 조회된 뒤 결과에 따라 userID를 출력하거나 loginForm으로 리다이렉트를 한다.</p>

<p><img src="https://raw.githubusercontent.com/wizleysw/wizleysw.github.io/master/_posts/img/php_board/loginForm.png" alt="loginForm" /></p>

<h3 id="로그아웃-구현">로그아웃 구현</h3>

<p>로그인이 있으면 로그아웃 기능도 구현이 되어야 한다. 하지만 대부분의 유저들이 로그아웃을 진행하지 않기 때문에 Cookie를 생성하여 expire date를 구현하는게 좋아보인다. 이 시점에서 Session과 Cookie에 대한 개념을 아는 것이 중요한데 가장 큰 차이는 세션은 정보를 관리하는 대상이 서버인지 클라이언트인지가 다르다는 점이다.</p>

<p><a href="https://interconnection.tistory.com/74">쿠키와 세션 개념</a></p>

<p>쿠키를 통해 로그인 유지 상태에 변경을 주기 위해서는 아이디와 패스워드에 대한 검증이 끝난 직후에 발급을 하는 것이 가장 좋을 것이다. loginCheck.php를 다음과 같이 수정한다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
	<span class="nv">$conn</span> <span class="o">=</span> <span class="nb">mysqli_connect</span><span class="p">(</span><span class="s2">"db"</span><span class="p">,</span> <span class="s2">"wizley"</span><span class="p">,</span> <span class="s2">"alpine"</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$conn</span><span class="p">){</span>
		<span class="k">die</span><span class="p">(</span><span class="s2">"Connection Error!!"</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="nx">mysqli_select_db</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span> <span class="s2">"User"</span><span class="p">);</span>
	<span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT * FROM Account WHERE userID = '</span><span class="si">{</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'userID'</span><span class="p">]</span><span class="si">}</span><span class="s2">' AND password = '</span><span class="si">{</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'password'</span><span class="p">]</span><span class="si">}</span><span class="s2">'"</span><span class="p">;</span>
	<span class="nv">$result</span> <span class="o">=</span> <span class="nx">mysqli_query</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span> <span class="nv">$query</span><span class="p">);</span>
	<span class="nv">$row</span> <span class="o">=</span> <span class="nx">mysqli_fetch_array</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>

	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$row</span><span class="p">){</span>
		<span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("아이디 또는 패스워드가 올바르지 않습니다.");'</span><span class="p">;</span>
		<span class="k">echo</span> <span class="s1">'location.href="/loginForm.php";&lt;/script&gt;'</span><span class="p">;</span>
		<span class="k">exit</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="nb">setcookie</span><span class="p">(</span><span class="s2">"expireTime"</span><span class="p">,</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'userID'</span><span class="p">],</span> <span class="nb">time</span><span class="p">()</span><span class="o">+</span><span class="mi">3600</span><span class="p">);</span>
	<span class="k">echo</span> <span class="s1">'&lt;script&gt;location.href="/index.php"&lt;/script&gt;'</span><span class="p">;</span>
	
	<span class="nx">mysqli_close</span><span class="p">(</span><span class="nv">$conn</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<p>이제 로그인에 성공하면 expireTime이라는 이름으로 userID 값을 가진 쿠키가 1시간동안 유지되게 된다. 이제 로그인을 한 후에 이동할 페이지를 만들어야 되는데 이름은 index.php로 지을 것이다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
	<span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">'expireTime'</span><span class="p">])){</span>
		<span class="k">echo</span> <span class="s2">"로그인 정보 "</span> <span class="o">.</span> <span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">'expireTime'</span><span class="p">];</span>
	<span class="p">}</span>

	<span class="k">else</span><span class="p">{</span>
		<span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("로그인 페이지로 이동합니다.");'</span><span class="p">;</span>
		<span class="k">echo</span> <span class="s1">'location.href="/loginForm.php";&lt;/script&gt;'</span><span class="p">;</span>
	<span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<p>COOKIE에서 expireTime을 가져와 존재할 경우에는 그 값인 userID를 적어주고 아닌 경우에는 loginForm으로 이동시키는 간단한 로직이다.</p>

<p>이제 로그아웃을 만들차례인데, 먼저 COOKIE를 확인하여 로그인한 상태인지를 본다. 그 후 로그아웃 버튼을 누르면 로그아웃이 진행되도록 할 것이다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
	<span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">'expireTime'</span><span class="p">])){</span>
		<span class="k">echo</span> <span class="s1">'로그인 정보 '</span> <span class="o">.</span> <span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">'expireTime'</span><span class="p">]</span> <span class="o">.</span> <span class="s1">'&lt;br&gt;'</span><span class="p">;</span>
		<span class="k">echo</span> <span class="s1">'&lt;a href="/logout.php"&gt;로그아웃&lt;/a&gt;'</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">else</span><span class="p">{</span>
		<span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("로그인 페이지로 이동합니다.");'</span><span class="p">;</span>
		<span class="k">echo</span> <span class="s1">'location.href="/loginForm.php";&lt;/script&gt;'</span><span class="p">;</span>
	<span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<p>다시 index.php에 버튼을 하나 추가해준다. 이제 이 버튼을 누르면 쿠키의 만료 기간을 현재의 시간보다 이전으로 변경함으로써 효력을 다하도록 만든다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
	<span class="nb">setcookie</span><span class="p">(</span><span class="s2">"expireTime"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="nb">time</span><span class="p">()</span><span class="o">-</span><span class="mi">99999999</span><span class="p">);</span>
<span class="cp">?&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
	<span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">/index.php</span><span class="dl">"</span><span class="p">;</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>

<p>이제 로그아웃 버튼을 클릭하면 로그아웃이 진행된다!</p>

<h3 id="회원가입-구현">회원가입 구현</h3>

<p>로그인 부분이 대략적으로 구현되었으니 이제 회원가입 기능의 구현이 필요하다. 이를 위해서 loginForm 부분에 회원가입 링크를 추가해준다.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;title&gt;</span>로그인<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"loginCheck.php"</span> <span class="na">method=</span><span class="s">"POST"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"userID"</span> <span class="na">placeholder=</span><span class="s">"아이디"</span><span class="nt">&gt;&lt;br&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">placeholder=</span><span class="s">"패스워드"</span><span class="nt">&gt;&lt;br&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>로그인<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"signUp.php"</span><span class="nt">&gt;</span>회원가입<span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/body&gt;</span>
</code></pre></div></div>

<p>그리고 회원가입을 처리하기 위한 signUp.php를 생성한다. 여기서는 INSERT를 통해 계정정보를 USER database의 Account에 넣는 작업을 수행할 것이다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
  <span class="nv">$conn</span> <span class="o">=</span> <span class="nb">mysqli_connect</span><span class="p">(</span><span class="s1">'db'</span><span class="p">,</span> <span class="s1">'wizley'</span><span class="p">,</span> <span class="s1">'alpine'</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$conn</span><span class="p">){</span>
    <span class="k">die</span><span class="p">(</span><span class="s2">"Connection Error!"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nv">$dateNow</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s2">"Y-m-d H:i:s"</span><span class="p">);</span>
  <span class="nx">mysqli_select_db</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span> <span class="s2">"User"</span><span class="p">);</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"
    INSERT INTO Account(userID, password, nickname, created, status) 
    VALUES('</span><span class="si">{</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'userID'</span><span class="p">]</span><span class="si">}</span><span class="s2">', '</span><span class="si">{</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'password'</span><span class="p">]</span><span class="si">}</span><span class="s2">', '</span><span class="si">{</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'nickname'</span><span class="p">]</span><span class="si">}</span><span class="s2">', '</span><span class="nv">$dateNow</span><span class="s2">', 1)
  "</span><span class="p">;</span>

  <span class="nv">$result</span> <span class="o">=</span> <span class="nx">mysqli_query</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span> <span class="nv">$query</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$result</span><span class="p">){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("정보를 다시 확인해주시기 바랍니다.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>
<span class="cp">?&gt;</span>

<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
  <span class="nx">alert</span><span class="p">(</span><span class="dl">"</span><span class="s2">회원가입이 완료되었습니다.</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">/loginForm.php</span><span class="dl">"</span><span class="p">;</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>

<p>테스트를 수행하기 전에 TABLE의 정보를 보면 다음과 같다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">mysql&gt;</span><span class="w"> </span><span class="k">select</span> <span class="k">*</span> from Account<span class="p">;</span>
<span class="go">+----------+--------+----------+---------+--------+----------+
| uniqueID | userID | password | created | status | nickname |
+----------+--------+----------+---------+--------+----------+
|        1 | admin  | alpine   | NULL    |      1 | Admin    |
+----------+--------+----------+---------+--------+----------+
1 row in set (0.00 sec)
</span></code></pre></div></div>

<p>이제 abcd / abcd / abcd로 아이디, 패스워드, 닉네임을 지정하고 회원가입을 진행하면 다음의 상태가 된다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">mysql&gt;</span><span class="w"> </span><span class="k">select</span> <span class="k">*</span> from Account<span class="p">;</span>
<span class="go">+----------+--------+----------+---------------------+--------+----------+
| uniqueID | userID | password | created             | status | nickname |
+----------+--------+----------+---------------------+--------+----------+
|        1 | admin  | alpine   | NULL                |      1 | Admin    |
|        4 | abcd   | abcd     | 2020-02-20 10:14:44 |      1 | abcd     |
+----------+--------+----------+---------------------+--------+----------+
2 rows in set (0.00 sec)
</span></code></pre></div></div>

<p>데이터 값은 잘 들어간 것을 확인할 수 있다. 여기서 uniqueID가 4인 이유는 2,3을 테스트에 사용하였기 때문이다. 이제 보안의 관점에서 봤을때 3가지 큰 로직 문제를 들 수 있다.</p>

<ol>
  <li>userId와 nickname의 중복검사 수행여부</li>
  <li>password 필드의 평문 저장된 패스워드 정보</li>
  <li>아무값도 입력하지 않아도 회원가입됨</li>
</ol>

<p>물론 여기서 xss라던가 sqli 취약점이 존재하겠지만 그 둘은 배제하고 로직적으로 구현이 필요한 부분은 위와 같이 요약할 수 있겠다. 그러면 중복검사 부분부터 추가하는 작업을 수행해보자. INSERT부분이 수행되기 전에 해당 userID랑 nickname을 조회하여 존재하는지에 대한 예외처리를 진행하면 된다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">mysqli_select_db</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span> <span class="s2">"User"</span><span class="p">);</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT * FROM Account WHERE userID = '</span><span class="si">{</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'userID'</span><span class="p">]</span><span class="si">}</span><span class="s2">'"</span><span class="p">;</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nx">mysqli_query</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span> <span class="nv">$query</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">mysqli_num_rows</span><span class="p">(</span><span class="nv">$result</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("이미 존재하는 아이디입니다.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT * FROM Account WHERE nickname = '</span><span class="si">{</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'nickname'</span><span class="p">]</span><span class="si">}</span><span class="s2">'"</span><span class="p">;</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nx">mysqli_query</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span> <span class="nv">$query</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">mysqli_num_rows</span><span class="p">(</span><span class="nv">$result</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("다른 닉네임을 선택해주세요.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nv">$dateNow</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s2">"Y-m-d H:i:s"</span><span class="p">);</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"
    INSERT INTO Account(userID, password, nickname, created, status) 
    VALUES('</span><span class="si">{</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'userID'</span><span class="p">]</span><span class="si">}</span><span class="s2">', '</span><span class="si">{</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'password'</span><span class="p">]</span><span class="si">}</span><span class="s2">', '</span><span class="si">{</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'nickname'</span><span class="p">]</span><span class="si">}</span><span class="s2">', '</span><span class="nv">$dateNow</span><span class="s2">', 1)
  "</span><span class="p">;</span>

  <span class="nv">$result</span> <span class="o">=</span> <span class="nx">mysqli_query</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span> <span class="nv">$query</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$result</span><span class="p">){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("정보를 다시 확인해주시기 바랍니다.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>조회를 위해서 Account에서 userID와 nickname으로 쿼리를 조회해 한개라도 존재하면 history.back();을 하도록 세팅하였다. 이 과정에서 mysqli_num_rows($result)&gt;0 을 mysqli_num_rows($result&gt;0) 으로 잘못 작성하는 바람에 에러가 발생하지 않고 회원가입이 진행하였고 디비는 다음과 같이 더럽혀졌다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">mysql&gt;</span><span class="w"> </span><span class="k">select</span> <span class="k">*</span> from Account<span class="p">;</span>
<span class="go">+----------+--------+----------+---------------------+--------+----------+
| uniqueID | userID | password | created             | status | nickname |
+----------+--------+----------+---------------------+--------+----------+
|        1 | admin  | alpine   | NULL                |      1 | Admin    |
|        4 | abcd   | abcd     | 2020-02-20 10:14:44 |      1 | abcd     |
|        5 | abcd   | 1        | 2020-02-20 10:21:29 |      1 | 1        |
|        6 | admin  | 1        | 2020-02-20 10:22:17 |      1 | 1        |
|        7 | abcd   | 1        | 2020-02-20 10:23:08 |      1 | 1        |
|        8 | 11     | 1        | 2020-02-20 10:23:24 |      1 | 1        |
|        9 | admin  | 1        | 2020-02-20 10:23:32 |      1 | 1        |
|       10 | 123    | ????     | 2020-02-20 10:23:45 |      1 | 123      |
|       11 | admin  | a        | 2020-02-20 10:24:28 |      1 |          |
|       12 |        |          | 2020-02-20 10:28:35 |      1 |          |
+----------+--------+----------+---------------------+--------+----------+
</span></code></pre></div></div>

<p>쿼리에 대한 로깅을 하기 위해서 아래와 같이 설정을 변경하였다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">mysql&gt;</span><span class="w"> </span>SHOW VARIABLES LIKE <span class="s1">'%general%'</span><span class="p">;</span>
<span class="go">+------------------+---------------------------------+
| Variable_name    | Value                           |
+------------------+---------------------------------+
| general_log      | OFF                             |
| general_log_file | /var/lib/mysql/f68ab5883779.log |
+------------------+---------------------------------+
2 rows in set (0.01 sec)

</span><span class="gp">mysql&gt;</span><span class="w">
</span><span class="gp">mysql&gt;</span><span class="w"> </span>SET GLOBAL general_log <span class="o">=</span> ON<span class="p">;</span>
<span class="go">Query OK, 0 rows affected (0.02 sec)

</span><span class="gp">mysql&gt;</span><span class="w"> </span>SHOW VARIABLES LIKE <span class="s1">'%general%'</span><span class="p">;</span>
<span class="go">+------------------+---------------------------------+
| Variable_name    | Value                           |
+------------------+---------------------------------+
| general_log      | ON                              |
| general_log_file | /var/lib/mysql/f68ab5883779.log |
+------------------+---------------------------------+
2 rows in set (0.01 sec)
</span></code></pre></div></div>

<p>그리고 해당 경로의 log파일을 확인해보면 다음과 같이 쿼리를 확인할 수 있다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">root@f68ab5883779:/#</span><span class="w"> </span><span class="nb">cat</span> /var/lib/mysql/f68ab5883779.log
<span class="go">/usr/sbin/mysqld, Version: 8.0.19 (MySQL Community Server - GPL). started with:
Tcp port: 3306  Unix socket: /var/run/mysqld/mysqld.sock
Time                 Id Command    Argument
2020-02-20T10:34:42.900555Z    29 Query SHOW VARIABLES LIKE '%general%'
2020-02-20T10:35:40.703799Z    86 Connect wizley@board_phpmysqli.php_board_backend on  using TCP/IP
2020-02-20T10:35:40.704496Z    86 Init DB User
2020-02-20T10:35:40.705589Z    86 Query SELECT * FROM Account WHERE userID = 'admin'
2020-02-20T10:35:40.706479Z    86 Query SELECT * FROM Account WHERE nickname = '123'
2020-02-20T10:35:40.707205Z    86 Query INSERT INTO Account(userID, password, nickname, created, status)
    VALUES('admin', '123', '123', '2020-02-20 10:35:40', 1)
2020-02-20T10:35:40.709930Z    86 Quit
</span></code></pre></div></div>

<p>여기서 내가 넣은 쿼리가 제대로 작동을 했기에 멘붕이 왔지만 스트레스받으면서 소스코드를 계속 확인하다보니 발견할 수 있었다. 이제 저 부분을 통해서 중복에 대한 검사가 진행된다.</p>

<p>이제 두 번째로 고쳐야되는 부분은 password의 평문저장이다. DB를 설계할 때 hash화를 고려했기 때문에 해당 필드의 길이를 길게 두었었다.</p>

<p><a href="https://m.blog.naver.com/psj9102/221223524085">PHP : password_hash 함수로 암호화</a></p>

<p>위의 링크를 확인해보면 password_hash라는 함수가 php 내부에 구현되어 있는 것을 확인할 수 있다. 이제 해당 부분을 INSERT 문에 적용해주면 된다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$dateNow</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s2">"Y-m-d H:i:s"</span><span class="p">);</span>
  <span class="nv">$passwordHashed</span> <span class="o">=</span> <span class="nb">password_hash</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'password'</span><span class="p">],</span> <span class="nx">PASSWORD_DEFAULT</span><span class="p">);</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"
    INSERT INTO Account(userID, password, nickname, created, status) 
    VALUES('</span><span class="si">{</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'userID'</span><span class="p">]</span><span class="si">}</span><span class="s2">', '</span><span class="nv">$passwordHashed</span><span class="s2">', '</span><span class="si">{</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'nickname'</span><span class="p">]</span><span class="si">}</span><span class="s2">', '</span><span class="nv">$dateNow</span><span class="s2">', 1)
  "</span><span class="p">;</span>
</code></pre></div></div>

<p>이제 이 값이 제대로 적용이 되서 login이 가능한지를 확인하기 위해서는 login쪽의 로직을 변경해야 된다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
  <span class="nv">$conn</span> <span class="o">=</span> <span class="nb">mysqli_connect</span><span class="p">(</span><span class="s2">"db"</span><span class="p">,</span> <span class="s2">"wizley"</span><span class="p">,</span> <span class="s2">"alpine"</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$conn</span><span class="p">){</span>
    <span class="k">die</span><span class="p">(</span><span class="s2">"Connection Error!!"</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">mysqli_select_db</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span> <span class="s2">"User"</span><span class="p">);</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT * FROM Account WHERE userID = '</span><span class="si">{</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'userID'</span><span class="p">]</span><span class="si">}</span><span class="s2">'"</span><span class="p">;</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nx">mysqli_query</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span> <span class="nv">$query</span><span class="p">);</span>
  <span class="nv">$row</span> <span class="o">=</span> <span class="nx">mysqli_fetch_array</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$row</span><span class="p">){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("아이디 또는 패스워드가 올바르지 않습니다.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'location.href="/loginForm.php";&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="nb">password_verify</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'password'</span><span class="p">],</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'password'</span><span class="p">])){</span>
    <span class="nb">setcookie</span><span class="p">(</span><span class="s2">"expireTime"</span><span class="p">,</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'userID'</span><span class="p">],</span> <span class="nb">time</span><span class="p">()</span><span class="o">+</span><span class="mi">3600</span><span class="p">);</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;location.href="/index.php"&lt;/script&gt;'</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">else</span><span class="p">{</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("아이디 또는 패스워드가 올바르지 않습니다.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'location.href="/loginForm.php";&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">mysqli_close</span><span class="p">(</span><span class="nv">$conn</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<p>loginCheck 부분을 다음과 같이 변경하였다. 그리고 abcd라는 아이디에 대해서 로그인을 시도하면 로그인에 성공하는 것을 확인 가능하다! 이제 이 과정에서 get_magic_quotes_gpc() 등을 통해 좀더 POST로 넘어오는 데이터에 대한 검증을 강화하도록 하겠다.</p>

<p><a href="https://idkwim.tistory.com/154">회원가입 폼 검증 후 출력</a></p>

<p>위의 사이트의 유용한 부분을 가져와서 추가하였다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
  <span class="nv">$conn</span> <span class="o">=</span> <span class="nb">mysqli_connect</span><span class="p">(</span><span class="s2">"db"</span><span class="p">,</span> <span class="s2">"wizley"</span><span class="p">,</span> <span class="s2">"alpine"</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$conn</span><span class="p">){</span>
    <span class="k">die</span><span class="p">(</span><span class="s2">"Connection Error!!"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="nf">fix_string</span><span class="p">(</span><span class="nv">$string</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">get_magic_quotes_gpc</span><span class="p">())</span> <span class="nv">$string</span><span class="o">=</span><span class="nb">stripslashes</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">htmlentities</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nv">$id</span><span class="o">=</span><span class="nv">$pw</span><span class="o">=</span><span class="s2">""</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'userID'</span><span class="p">]))</span>
    <span class="nv">$id</span><span class="o">=</span><span class="nx">fix_string</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'userID'</span><span class="p">]);</span>
  <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'password'</span><span class="p">]))</span>
    <span class="nv">$pw</span><span class="o">=</span><span class="nx">fix_string</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'password'</span><span class="p">]);</span>

  <span class="k">if</span><span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("아이디를 잘못 입력하셨습니다.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'location.href="/loginForm.php";&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$pw</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("패스워드를 다시 입력해주세요.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'location.href="/loginForm.php";&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">mysqli_select_db</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span> <span class="s2">"User"</span><span class="p">);</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT * FROM Account WHERE userID = '</span><span class="nv">$id</span><span class="s2">'"</span><span class="p">;</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nx">mysqli_query</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span> <span class="nv">$query</span><span class="p">);</span>
  <span class="nv">$row</span> <span class="o">=</span> <span class="nx">mysqli_fetch_array</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$row</span><span class="p">){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("아이디 또는 패스워드가 올바르지 않습니다.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'location.href="/loginForm.php";&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="nb">password_verify</span><span class="p">(</span><span class="nv">$pw</span><span class="p">,</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'password'</span><span class="p">])){</span>
    <span class="nb">setcookie</span><span class="p">(</span><span class="s2">"expireTime"</span><span class="p">,</span> <span class="nv">$id</span><span class="p">,</span> <span class="nb">time</span><span class="p">()</span><span class="o">+</span><span class="mi">3600</span><span class="p">);</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;location.href="/index.php"&lt;/script&gt;'</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">else</span><span class="p">{</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("아이디 또는 패스워드가 올바르지 않습니다.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'location.href="/loginForm.php";&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">mysqli_close</span><span class="p">(</span><span class="nv">$conn</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<h3 id="prepared-statement">prepared statement</h3>

<p>조금 보완되긴 했지만 sqli를 막기 위해서는 prepared statement를 사용하는게 좋을 것 같다. 바꿔보도록 하자.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$conn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mysqli</span><span class="p">(</span><span class="s2">"db"</span><span class="p">,</span> <span class="s2">"wizley"</span><span class="p">,</span> <span class="s2">"alpine"</span><span class="p">,</span> <span class="s2">"User"</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$conn</span><span class="p">){</span>
  <span class="k">die</span><span class="p">(</span><span class="s2">"Connection Error!!"</span><span class="p">);</span>
<span class="p">}</span>

<span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT* FROM Account WHERE userID LIKE ?"</span><span class="p">;</span>
<span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">stmt_init</span><span class="p">();</span>
<span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bind_param</span><span class="p">(</span><span class="s2">"s"</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">get_result</span><span class="p">();</span>
<span class="nv">$row</span> <span class="o">=</span> <span class="nx">mysqli_fetch_array</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>
</code></pre></div></div>

<p><a href="http://www.fun25.co.kr/blog/php-mysqli-simple-sample">prepared statement 예제</a></p>

<p>위와 같이 약간의 변경을 하였고, prepare와 bind_param을 통해 파라미터의 데이터 타입등에 대한 설정을 하였다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">2020-02-20T13:41:37.437438Z   135 Prepare INSERT INTO Account(userID, password, nickname, created, status)
    VALUES(?,?,?,'2020-02-20 13:41:37',1)
2020-02-20T13:41:37.437713Z   135 Execute INSERT INTO Account(userID, password, nickname, created, status)
</span><span class="gp">    VALUES('test3','$</span>2y<span class="nv">$10$Z5KBtyAqTkrwZ</span>.cp7GMW3OQlOdflgyHl8bTFwJ9VnD9.8zA3/fPBe<span class="s1">','</span>test3<span class="s1">','</span>2020-02-20 13:41:37<span class="s1">',1)
</span><span class="go">2020-02-20T13:41:37.439564Z   135 Close stmt
</span></code></pre></div></div>

<p>정상적으로 작동하는 것까지 확인이 된다.</p>

<h3 id="session">Session</h3>

<p>이제 세션을 추가할 차례이다. PHP에서는 session_start()를 통해 세션값을 생성한다고 한다. 마찬가지로 로그인이 되는 그 시점에 발급하는 것이 가장 좋아보인다. 해당 값은 기존의 COOKIE를 대체하여 로그인 여부를 확인하는 flag의 역할로 활용될 것이다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span><span class="p">(</span><span class="nb">password_verify</span><span class="p">(</span><span class="nv">$pw</span><span class="p">,</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'password'</span><span class="p">])){</span>
  <span class="nb">session_start</span><span class="p">();</span>
  <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'USERSESSION'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$id</span><span class="p">;</span>
  <span class="nb">setcookie</span><span class="p">(</span><span class="s2">"expireTime"</span><span class="p">,</span> <span class="nv">$id</span><span class="p">,</span> <span class="nb">time</span><span class="p">()</span><span class="o">+</span><span class="mi">3600</span><span class="p">);</span>
  <span class="k">echo</span> <span class="s1">'&lt;script&gt;location.href="/index.php"&lt;/script&gt;'</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>loginCheck.php 부분에서 SESSION을 추가해준다. 그리고 다른 php파일들에는 session_start()를 추가해주면 된다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
  <span class="nb">session_start</span><span class="p">();</span>
  <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'USERSESSION'</span><span class="p">])){</span>
  <span class="k">echo</span> <span class="s1">'로그인 정보 '</span> <span class="o">.</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'USERSESSION'</span><span class="p">]</span> <span class="o">.</span> <span class="s1">'&lt;br&gt;'</span><span class="p">;</span>
  <span class="k">echo</span> <span class="s1">'&lt;a href="/logout.php"&gt;로그아웃&lt;/a&gt;'</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">else</span><span class="p">{</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("로그인 페이지로 이동합니다.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'location.href="/loginForm.php";&lt;/script&gt;'</span><span class="p">;</span>
  <span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<p>이제 로그인 후에 SESSION에 대한 정보를 확인해보면 아래와 같이 생성된 것을 확인이 가능하다.</p>

<p><img src="https://raw.githubusercontent.com/wizleysw/wizleysw.github.io/master/_posts/img/php_board/session.png" alt="session" /></p>

<p>그리고 서버쪽의 /tmp 폴더의 내부에 세션파일이 저장된다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">/tmp #</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-al</span>
<span class="go">total 16
drwxrwxrwt    1 root     root          4096 Feb 21 10:32 .
drwxr-xr-x    1 root     root          4096 Feb 20 07:04 ..
-rw-------    1 www-data www-data         0 Feb 20 13:54 sess_0f3199d2a07722100a88c9a6f94408b9
-rw-------    1 www-data www-data         0 Feb 20 13:55 sess_46065d93eaa6a2970aa186fd18ef4654
-rw-------    1 www-data www-data        23 Feb 20 13:58 sess_6595d62b49e2689cb2554439fca4e43a
-rw-------    1 www-data www-data         0 Feb 20 13:54 sess_79e56a43f802556787697272a23f3dbf
-rw-------    1 www-data www-data        23 Feb 21 10:44 sess_c99d3d8bbe51b9787f8896c84e851b73
</span><span class="gp">/tmp #</span><span class="w"> </span><span class="nb">cat </span>sess_c99d3d8bbe51b9787f8896c84e851b73
<span class="gp">USERSESSION|s:4:"abcd";</span>/tmp <span class="c">#</span>
<span class="go">
</span></code></pre></div></div>

<p>해당 값을 지우면 로그인이 되어 있지 않은 상태로 판단하여 loginForm.php을 띄우게 된다. logout 부분에서는 세션에 대한 정보를 제거해야하기 때문에 아래와 같이 session_destroy(); 를 추가해주면 된다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
  <span class="nb">session_start</span><span class="p">();</span>
  <span class="nb">setcookie</span><span class="p">(</span><span class="s2">"expireTime"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="nb">time</span><span class="p">()</span><span class="o">-</span><span class="mi">99999999</span><span class="p">);</span>
  <span class="nb">session_destroy</span><span class="p">();</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<p>여기까지 회원가입과 로그인과 관련된 간단한 골격에 대한 설계가 마무리 되었다.</p>

<h3 id="소스코드-모듈화">소스코드 모듈화</h3>

<p>새로운 DB를 설계하기 전에 약간의 코드 리팩토링을 진행하도록 할건데 겹치는 기능을 수행하는 코드를 하나의 독립된 php파일로 분리하는 작업이다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;title&gt;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$title</span><span class="p">;</span> <span class="cp">?&gt;</span><span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
</code></pre></div></div>

<p>HTML파일의 윗 부분은 매번 같은 구조로 설계를 진행하고 있으니 그 타이틀의 값만 변경하면 된다. 그리고 이에 맞춰서 loginForm.php를 다음과 같이 변경하면 된다.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php
  $title = "로그인";
  require_once('head.php');
?&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"loginCheck.php"</span> <span class="na">method=</span><span class="s">"POST"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"userID"</span> <span class="na">placeholder=</span><span class="s">"아이디"</span> <span class="na">required</span><span class="nt">&gt;&lt;br&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">placeholder=</span><span class="s">"패스워드"</span> <span class="na">required</span><span class="nt">&gt;&lt;br&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>로그인<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"signUp.php"</span><span class="nt">&gt;</span>회원가입<span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/body&gt;</span>
</code></pre></div></div>

<p>DB부분도 mysqli를 요청하는 부분은 동일하기 때문에 분리를 진행한다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
  <span class="nv">$conn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mysqli</span><span class="p">(</span><span class="s2">"db"</span><span class="p">,</span> <span class="s2">"wizley"</span><span class="p">,</span> <span class="s2">"alpine"</span><span class="p">,</span> <span class="s2">"User"</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$conn</span><span class="p">){</span>
    <span class="k">die</span><span class="p">(</span><span class="s2">"Connection Error!"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<p>UserDBconnect.php라는 독립된 파일로 분리함으로써 db명 또는 Database의 이름을 한 파일에서만 변경해주면 같은 DB를 사용하고 있는 여러 php에 대한 값을 한 번에 변경가능하다. 이 시점에서 또 드는 고민이 게시판 기능의 작성자명으로 nickname을 사용하는 것이 낫다는 것이다. 그리고 그 값은 session에 저장되면 좋을 것 같아서 로직 수정을 하도록 하겠다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT* FROM Account WHERE userID LIKE ?"</span><span class="p">;</span>
  <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">stmt_init</span><span class="p">();</span>
  <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bind_param</span><span class="p">(</span><span class="s2">"s"</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">get_result</span><span class="p">();</span>
  <span class="nv">$row</span> <span class="o">=</span> <span class="nx">mysqli_fetch_array</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$row</span><span class="p">){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("아이디 또는 패스워드가 올바르지 않습니다.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'location.href="/loginForm.php";&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="nb">password_verify</span><span class="p">(</span><span class="nv">$pw</span><span class="p">,</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'password'</span><span class="p">])){</span>
    <span class="nb">session_start</span><span class="p">();</span>
    <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'USERSESSION'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$id</span><span class="p">;</span>
    <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'NICKNAME'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'nickname'</span><span class="p">];</span>
    <span class="nb">setcookie</span><span class="p">(</span><span class="s2">"expireTime"</span><span class="p">,</span> <span class="nv">$id</span><span class="p">,</span> <span class="nb">time</span><span class="p">()</span><span class="o">+</span><span class="mi">3600</span><span class="p">);</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;location.href="/index.php"&lt;/script&gt;'</span><span class="p">;</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>다행히 기존의 result값을 row에 저장해놓았기에 해당 값을 기준으로 NICKNAME이라는 값을 하나 더 저장해놓으면 됬다. 그리고 다시 서버의 세션상태를 보면 다음과 같이 닉네임이 저장되어 있는 것을 확인 가능하다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">/tmp #</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-al</span>
<span class="go">total 16
drwxrwxrwt    1 root     root          4096 Feb 21 10:48 .
drwxr-xr-x    1 root     root          4096 Feb 20 07:04 ..
-rw-------    1 www-data www-data         0 Feb 20 13:54 sess_0f3199d2a07722100a88c9a6f94408b9
-rw-------    1 www-data www-data         0 Feb 20 13:55 sess_46065d93eaa6a2970aa186fd18ef4654
-rw-------    1 www-data www-data        23 Feb 20 13:58 sess_6595d62b49e2689cb2554439fca4e43a
-rw-------    1 www-data www-data         0 Feb 20 13:54 sess_79e56a43f802556787697272a23f3dbf
-rw-------    1 www-data www-data        42 Feb 21 10:48 sess_c99d3d8bbe51b9787f8896c84e851b73
</span><span class="gp">/tmp #</span><span class="w"> </span><span class="nb">cat </span>sess_c99d3d8bbe51b9787f8896c84e851b73
</code></pre></div></div>

<h2 id="board-db-구현-및-게시판-기능-구현">Board DB 구현 및 게시판 기능 구현</h2>

<p>이제 게시판 부분의 구현을 진행할 차례이다. User와 마찬가지로 새로운 DB를 생성하여 Board라는 이름을 지어줄 것이다. 그리고 Table 명으로 FreeBoard를 주어서 간단한 자유게시판의 기능을 구현하는데 까지 진행한 뒤에 이 프로젝트를 마무리할 예정이다. 물론 실제 게시판 배포에서는 좋아요/싫어요, 댓글 기능 등 추가적인 구현이 필요하겠지만 PHP는 이런식으로 돌아가는구나를 아는 정도로 마칠 프로젝트라 Django를 구현하는 과정에서 고민을 해보도록 하겠다..</p>

<h3 id="게시판-db-설계">게시판 DB 설계</h3>

<p>게시판의 주요 컨텐츠는 다음과 같이 요약할 수 있다.</p>

<p>1.글 번호 
2.글 제목
3.글 작성자
4.글 작성시간
5.글 내용
6.비밀글 여부 
7.비밀글 패스워드
8.전체/로그인 글 여부
9.조회수</p>

<p>여기서 글 번호는 고유 번호로 PRIMARY KEY를 사용하여 구현하면 될 것 같고 작성자는 세션을 통해 얻어오는 것이 가능하다. 전체/로그인의 경우 게시판 글이 권한을 구분해주는 것인데 1일 경우 로그인을 하지 않은 계정으로도 열람이 가능하도록 하며, 그 외에는 로그인을 해야지만 글의 컨텐츠를 확인할 수 있도록 할 것이다. 또한 만약의 경우를 생각해서 2의 값으로는 게시판을 블락하는 용도로도 발전할 수 있을 것 같다. 비밀글은 글에 패스워드를 걸어서 특정 사용자만 볼 수 있도록 하는 것이다.</p>

<p>이제 DB를 설계해보자.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">mysql&gt;</span><span class="w"> </span>CREATE DATABASE Board<span class="p">;</span>
<span class="go">Query OK, 1 row affected (0.01 sec)

</span><span class="gp">mysql&gt;</span><span class="w"> </span>show databases<span class="p">;</span>
<span class="go">+--------------------+
| Database           |
+--------------------+
| Board              |
| User               |
| information_schema |
| mysql              |
| performance_schema |
| sys                |
+--------------------+
6 rows in set (0.00 sec)
</span></code></pre></div></div>

<p>정상적으로 Board라는 database를 생성하였다. 이제 해당 DB아래에 FreeBoard 테이블을 생성할 것이다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">mysql&gt;</span><span class="w"> </span>use Board<span class="p">;</span>
<span class="go">Database changed
</span><span class="gp">mysql&gt;</span><span class="w"> </span>CREATE TABLE FreeBoard
<span class="gp">    -&gt;</span><span class="w"> </span><span class="o">(</span>
<span class="gp">    -&gt;</span><span class="w"> </span>boardNo int NOT NULL AUTO_INCREMENT,
<span class="gp">    -&gt;</span><span class="w"> </span>title VARCHAR<span class="o">(</span>16<span class="o">)</span> NOT NULL,
<span class="gp">    -&gt;</span><span class="w"> </span>author VARCHAR<span class="o">(</span>16<span class="o">)</span> NOT NULL,
<span class="gp">    -&gt;</span><span class="w"> </span><span class="nb">time </span>datetime NOT NULL,
<span class="gp">    -&gt;</span><span class="w"> </span>content text NOT NULL,
<span class="gp">    -&gt;</span><span class="w"> </span>secret int,
<span class="gp">    -&gt;</span><span class="w"> </span>secretPassword VARCHAR<span class="o">(</span>128<span class="o">)</span>,
<span class="gp">    -&gt;</span><span class="w"> </span>permission int NOT NULL,
<span class="gp">    -&gt;</span><span class="w"> </span>PRIMARY KEY<span class="o">(</span>boardNo<span class="o">)</span>
<span class="gp">    -&gt;</span><span class="w"> </span><span class="o">)</span>
<span class="gp">    -&gt;</span><span class="w"> </span><span class="p">;</span>
<span class="go">Query OK, 0 rows affected (0.02 sec)
</span></code></pre></div></div>

<p>자 이제 DB에 대한 설계를 완료하였다. 이제 게시판 기능을 구현하면 된다.</p>

<h3 id="게시판-글-목록-조회-구현">게시판 글 목록 조회 구현</h3>

<p>가장 먼저 만들 페이지는 글 목록을 읽어와서 뿌려주는 페이지이다. 이를 위해서는 Board DB의 FreeBoard 테이블에 쿼리를 요청하여 response를 for문으로 받아와서 뿌려주어야 한다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
  <span class="nb">session_start</span><span class="p">();</span>
  <span class="nv">$title</span> <span class="o">=</span> <span class="s2">"자유게시판"</span><span class="p">;</span>
  <span class="k">require_once</span><span class="p">(</span><span class="s1">'head.php'</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'USERSESSION'</span><span class="p">])){</span>
  <span class="k">echo</span> <span class="s1">'로그인 정보 '</span> <span class="o">.</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'NICKNAME'</span><span class="p">]</span> <span class="o">.</span> <span class="s1">'&lt;br&gt;'</span><span class="p">;</span>
  <span class="k">echo</span> <span class="s1">'&lt;a href="/logout.php"&gt;로그아웃&lt;/a&gt;'</span><span class="p">;</span>
  <span class="p">}</span>
<span class="cp">?&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>

<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"board"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;table&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
      <span class="nt">&lt;th&gt;</span>번호<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>제목<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>열람여부<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>닉네임<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>작성일<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>

    <span class="cp">&lt;?php</span>
      <span class="k">require_once</span><span class="p">(</span><span class="s1">'BoardDBConnect.php'</span><span class="p">);</span>
      <span class="nv">$count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT* FROM FreeBoard"</span><span class="p">;</span>
      <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">stmt_init</span><span class="p">();</span>
      <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
      <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
      <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">get_result</span><span class="p">();</span>
      <span class="k">while</span><span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nx">mysqli_fetch_array</span><span class="p">(</span><span class="nv">$result</span><span class="p">)){</span>
        <span class="nv">$count</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">echo</span> <span class="s2">"&lt;tr&gt;"</span><span class="p">;</span>
        <span class="k">echo</span> <span class="s2">"&lt;td&gt;</span><span class="si">{</span><span class="nv">$count</span><span class="si">}</span><span class="s2">&lt;/td&gt;"</span><span class="p">;</span>
        <span class="k">echo</span> <span class="s2">"&lt;td&gt;</span><span class="si">{</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'title'</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/td&gt;"</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'secret'</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">){</span>
          <span class="k">echo</span> <span class="s2">"&lt;td&gt;비밀글&lt;/td&gt;"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'permission'</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">){</span>
          <span class="k">echo</span> <span class="s2">"&lt;td&gt;전체공개&lt;/td&gt;"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span><span class="p">{</span>
          <span class="k">echo</span> <span class="s2">"&lt;td&gt;회원전용&lt;/td&gt;"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">echo</span> <span class="s2">"&lt;td&gt;</span><span class="si">{</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'author'</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/td&gt;"</span><span class="p">;</span>
        <span class="k">echo</span> <span class="s2">"&lt;td&gt;</span><span class="si">{</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'time'</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/td&gt;"</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>
      <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>
    <span class="cp">?&gt;</span>
  <span class="nt">&lt;/table&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>prepared_statement를 활용하여 board.php를 생성하였다. 그 과정에서 DB에 대한 모듈화 코드 또한 추가하였다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
  <span class="nv">$conn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mysqli</span><span class="p">(</span><span class="s2">"db"</span><span class="p">,</span> <span class="s2">"wizley"</span><span class="p">,</span> <span class="s2">"alpine"</span><span class="p">,</span> <span class="s2">"Board"</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$conn</span><span class="p">){</span>
    <span class="k">die</span><span class="p">(</span><span class="s2">"Connection Error!"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<p>이제 정상적으로 조회하여 값을 가져올 수 있는지를 확인할 차례이다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">mysql&gt;</span><span class="w"> </span>INSERT INTO FreeBoard<span class="o">(</span>title, author, <span class="nb">time</span>, content, secret, permission<span class="o">)</span> VALUES<span class="o">(</span><span class="s1">'HelloWorld'</span>, <span class="s1">'Admin'</span>, <span class="s1">'2020-02-20'</span>, <span class="s1">'ABCDEF'</span>, <span class="s1">'0'</span>, <span class="s1">'1'</span><span class="o">)</span><span class="p">;</span>
<span class="go">Query OK, 1 row affected (0.00 sec)

</span><span class="gp">mysql&gt;</span><span class="w"> </span><span class="k">select</span> <span class="k">*</span> from FreeBoard<span class="p">;</span>
<span class="go">+---------+------------+--------+---------------------+---------+--------+----------------+------------+
| boardNo | title      | author | time                | content | secret | secretPassword | permission |
+---------+------------+--------+---------------------+---------+--------+----------------+------------+
|       1 | HelloWorld | Admin  | 2020-02-20 00:00:00 | ABCDEF  |      0 | NULL           |          1 |
+---------+------------+--------+---------------------+---------+--------+----------------+------------+
1 row in set (0.00 sec)

</span><span class="gp">mysql&gt;</span><span class="w"> </span>INSERT INTO FreeBoard<span class="o">(</span>title, author, <span class="nb">time</span>, content, secret, permission<span class="o">)</span> VALUES<span class="o">(</span><span class="s1">'HelloWorld2'</span>, <span class="s1">'Admin'</span>, <span class="s1">'2020-02-20'</span>, <span class="s1">'ABCDEF'</span>, <span class="s1">'0'</span>, <span class="s1">'1'</span><span class="o">)</span><span class="p">;</span>
<span class="go">Query OK, 1 row affected (0.00 sec)

</span><span class="gp">mysql&gt;</span><span class="w"> </span><span class="k">select</span> <span class="k">*</span> from FreeBoard<span class="p">;</span>                                                                                                     +---------+-------------+--------+---------------------+---------+--------+----------------+------------+
<span class="go">| boardNo | title       | author | time                | content | secret | secretPassword | permission |
+---------+-------------+--------+---------------------+---------+--------+----------------+------------+
|       1 | HelloWorld  | Admin  | 2020-02-20 00:00:00 | ABCDEF  |      0 | NULL           |          1 |
|       2 | HelloWorld2 | Admin  | 2020-02-20 00:00:00 | ABCDEF  |      0 | NULL           |          1 |
+---------+-------------+--------+---------------------+---------+--------+----------------+------------+
2 rows in set (0.00 sec)

</span></code></pre></div></div>

<p>테스트를 위해서 임의로 글 데이터 2개를 넣어주었다. 이제 board.php에 접속하여 확인을 해보면 다음과 같은 결과를 확인할 수 있다.</p>

<p><img src="https://raw.githubusercontent.com/wizleysw/wizleysw.github.io/master/_posts/img/php_board/board.png" alt="board" /></p>

<h3 id="게시판-글-내용-조회-구현">게시판 글 내용 조회 구현</h3>

<p>이제 게시판의 목록을 토대로 세부 내용을 조회하는 루틴의 구현이 필요하다. 여기서 고려해야될 사항은 다음과 같다.</p>

<ol>
  <li>게시판 번호에 대한 검증</li>
  <li>게시판 권한 검증</li>
  <li>게시판 비밀글 여부 확인</li>
</ol>

<p>1번같은 경우 no는 PRIMARY_KEY로 1부터 증가한다. 하지만 GET으로 넘어오는 파라미터의 값에 대한 검증이 없다면 no=0과 같이 존재하지 않는 게시물에 대한 조회요청이 들어올 것이다. 두 번째로는 게시판 권한 검증인데 로그인한 유저만 확인이 가능한 경우에는 SESSION 검증이 필요하다. 비밀글 같은 경우에는 당연히 패스워드를 입력받는 루틴이 추가되어야 한다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
  <span class="nb">session_start</span><span class="p">();</span>
  <span class="nv">$title</span> <span class="o">=</span> <span class="s2">"글 보기"</span><span class="p">;</span>
  <span class="k">require_once</span><span class="p">(</span><span class="s1">'head.php'</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'USERSESSION'</span><span class="p">])){</span>
  <span class="k">echo</span> <span class="s1">'로그인 정보 '</span> <span class="o">.</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'NICKNAME'</span><span class="p">]</span> <span class="o">.</span> <span class="s1">'&lt;br&gt;'</span><span class="p">;</span>
  <span class="k">echo</span> <span class="s1">'&lt;a href="/logout.php"&gt;로그아웃&lt;/a&gt;'</span><span class="p">;</span>
  <span class="p">}</span>
<span class="cp">?&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>

<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"view_board"</span><span class="nt">&gt;</span>

  <span class="cp">&lt;?php</span>
    <span class="k">function</span> <span class="nf">fix_string</span><span class="p">(</span><span class="nv">$string</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="nb">get_magic_quotes_gpc</span><span class="p">())</span> <span class="nv">$string</span><span class="o">=</span><span class="nb">stripslashes</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
      <span class="k">return</span> <span class="nb">htmlentities</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nv">$no</span><span class="o">=</span><span class="s2">""</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'no'</span><span class="p">]))</span>
      <span class="nv">$no</span><span class="o">=</span><span class="nx">fix_string</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'no'</span><span class="p">]);</span>

    <span class="k">if</span><span class="p">(</span><span class="nv">$no</span><span class="o">&lt;=</span><span class="mi">0</span> <span class="k">or</span> <span class="o">!</span><span class="nv">$no</span><span class="p">){</span>
      <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("잘못된 접근입니다!");'</span><span class="p">;</span>
      <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
      <span class="k">exit</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">require_once</span><span class="p">(</span><span class="s1">'BoardDBConnect.php'</span><span class="p">);</span>
    <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT * FROM FreeBoard WHERE boardNo LIKE ?"</span><span class="p">;</span>
    <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">stmt_init</span><span class="p">();</span>
    <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
    <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bind_param</span><span class="p">(</span><span class="s2">"i"</span><span class="p">,</span> <span class="nv">$no</span><span class="p">);</span>
    <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">get_result</span><span class="p">();</span>
    <span class="nv">$row</span> <span class="o">=</span> <span class="nx">mysqli_fetch_array</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$row</span><span class="p">){</span>
      <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("잘못된 접근입니다!");'</span><span class="p">;</span>
      <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
      <span class="k">exit</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'permission'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'USERSESSION'</span><span class="p">])){</span>
        <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("로그인이 필요합니다.");'</span><span class="p">;</span>
        <span class="k">echo</span> <span class="s1">'location.href="/loginForm.php";&lt;/script&gt;'</span><span class="p">;</span>
        <span class="k">exit</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'permission'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">){</span>
      <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("제한된 게시물입니다.");'</span><span class="p">;</span>
      <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
      <span class="k">exit</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'secret'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">){</span>
      <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("비밀글입니다.");'</span><span class="p">;</span>
      <span class="k">echo</span> <span class="s1">'location.href="/secretBoard.php";&lt;/script&gt;'</span><span class="p">;</span>
      <span class="k">exit</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">echo</span> <span class="s2">"&lt;table&gt;"</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">"&lt;tr&gt;"</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">"&lt;th&gt;번호&lt;/th&gt;"</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">"&lt;td&gt;</span><span class="si">{</span><span class="nv">$no</span><span class="si">}</span><span class="s2">&lt;/td&gt;"</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">"&lt;/tr&gt;"</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">"&lt;tr&gt;"</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">"&lt;th&gt;제목&lt;/th&gt;"</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">"&lt;td&gt;</span><span class="si">{</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'title'</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/td&gt;"</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">"&lt;/tr&gt;"</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">"&lt;tr&gt;"</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">"&lt;th&gt;열람여부&lt;/th&gt;"</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'secret'</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">){</span>
      <span class="k">echo</span> <span class="s2">"&lt;td&gt;비밀글&lt;/td&gt;"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'permission'</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">){</span>
      <span class="k">echo</span> <span class="s2">"&lt;td&gt;전체공개&lt;/td&gt;"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
      <span class="k">echo</span> <span class="s2">"&lt;td&gt;회원전용&lt;/td&gt;"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">echo</span> <span class="s2">"&lt;/tr&gt;"</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">"&lt;tr&gt;"</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">"&lt;th&gt;닉네임&lt;/th&gt;"</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">"&lt;td&gt;</span><span class="si">{</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'author'</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/td&gt;"</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">"&lt;/tr&gt;"</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">"&lt;tr&gt;"</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">"&lt;th&gt;작성일&lt;/th&gt;"</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">"&lt;td&gt;</span><span class="si">{</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'time'</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/td&gt;"</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">"&lt;/tr&gt;"</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">"&lt;th&gt;내용&lt;/th&gt;"</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">"&lt;td&gt;</span><span class="si">{</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/td&gt;"</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">"&lt;/table&gt;"</span><span class="p">;</span>

    <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>
    <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>
  <span class="cp">?&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">onclick=</span><span class="s">"location.href='javascript:history.back();'"</span><span class="nt">&gt;</span>뒤로가<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>

</code></pre></div></div>

<p>파라미터는 view.php?no=1과 같은 형식으로 넘어오게 된다. 맨처음 no에 대한 검증을 진행하고 쿼리를 조회하여 권한에 대한 부분을 확인한다. 그 후 권한에 맞게 조건문을 탄 뒤, 조건 값에 맞는 경우 결과를 출력해준다. 결과를 확인해보면 다음과 같이 조회가 되는 것을 확인가능하다.</p>

<p><img src="https://raw.githubusercontent.com/wizleysw/wizleysw.github.io/master/_posts/img/php_board/view.png" alt="view" /></p>

<p>이제 view 부분에서 제목을 클릭하면 해당 게시물로 이동하도록 설계를 마무리하면 된다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"board"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;table&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
      <span class="nt">&lt;th&gt;</span>번호<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>제목<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>열람여부<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>닉네임<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>작성일<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>

    <span class="cp">&lt;?php</span>
      <span class="k">require_once</span><span class="p">(</span><span class="s1">'BoardDBConnect.php'</span><span class="p">);</span>
      <span class="nv">$count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT* FROM FreeBoard"</span><span class="p">;</span>
      <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">stmt_init</span><span class="p">();</span>
      <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
      <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
      <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">get_result</span><span class="p">();</span>
      <span class="k">while</span><span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nx">mysqli_fetch_array</span><span class="p">(</span><span class="nv">$result</span><span class="p">)){</span>
        <span class="nv">$count</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">echo</span> <span class="s2">"&lt;tr&gt;"</span><span class="p">;</span>
        <span class="k">echo</span> <span class="s2">"&lt;td&gt;</span><span class="si">{</span><span class="nv">$count</span><span class="si">}</span><span class="s2">&lt;/td&gt;"</span><span class="p">;</span>
        <span class="k">echo</span> <span class="s2">"&lt;td&gt;&lt;a href='/view.php?no=</span><span class="si">{</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'boardNo'</span><span class="p">]</span><span class="si">}</span><span class="s2">'&gt;</span><span class="si">{</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'title'</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/a&gt;&lt;/td&gt;"</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'secret'</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">){</span>
          <span class="k">echo</span> <span class="s2">"&lt;td&gt;비밀글&lt;/td&gt;"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'permission'</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">){</span>
          <span class="k">echo</span> <span class="s2">"&lt;td&gt;전체공개&lt;/td&gt;"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span><span class="p">{</span>
          <span class="k">echo</span> <span class="s2">"&lt;td&gt;회원전용&lt;/td&gt;"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">echo</span> <span class="s2">"&lt;td&gt;</span><span class="si">{</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'author'</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/td&gt;"</span><span class="p">;</span>
        <span class="k">echo</span> <span class="s2">"&lt;td&gt;</span><span class="si">{</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'time'</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/td&gt;"</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>
      <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>
    <span class="cp">?&gt;</span>
  <span class="nt">&lt;/table&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>이제 비밀글 부분을 해결할 차례이다. 기존 게시판과는 또 다르게 비밀글에 대한 패스워드를 입력하는 루틴이 추가적으로 필요하다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
  <span class="nb">session_start</span><span class="p">();</span>
  <span class="nv">$title</span> <span class="o">=</span> <span class="s2">"글 보기"</span><span class="p">;</span>
  <span class="k">require_once</span><span class="p">(</span><span class="s1">'head.php'</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'USERSESSION'</span><span class="p">])){</span>
  <span class="k">echo</span> <span class="s1">'로그인 정보 '</span> <span class="o">.</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'NICKNAME'</span><span class="p">]</span> <span class="o">.</span> <span class="s1">'&lt;br&gt;'</span><span class="p">;</span>
  <span class="k">echo</span> <span class="s1">'&lt;a href="/logout.php"&gt;로그아웃&lt;/a&gt;'</span><span class="p">;</span>
  <span class="p">}</span>
<span class="cp">?&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="cp">&lt;?php</span>
    <span class="k">function</span> <span class="nf">fix_string</span><span class="p">(</span><span class="nv">$string</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="nb">get_magic_quotes_gpc</span><span class="p">())</span> <span class="nv">$string</span><span class="o">=</span><span class="nb">stripslashes</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
      <span class="k">return</span> <span class="nb">htmlentities</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nv">$no</span><span class="o">=</span><span class="s2">""</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'no'</span><span class="p">]))</span>
      <span class="nv">$no</span><span class="o">=</span><span class="nx">fix_string</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'no'</span><span class="p">]);</span>

    <span class="k">if</span><span class="p">(</span><span class="nv">$no</span><span class="o">&lt;=</span><span class="mi">0</span> <span class="k">or</span> <span class="o">!</span><span class="nv">$no</span><span class="p">){</span>
      <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("잘못된 접근입니다!");'</span><span class="p">;</span>
      <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
      <span class="k">exit</span><span class="p">;</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span>
  <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/view.php"</span> <span class="na">method=</span><span class="s">"POST"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">id=</span><span class="s">"no"</span> <span class="na">name=</span><span class="s">"no"</span> <span class="na">value=</span><span class="s">"</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$no</span><span class="cp">?&gt;</span><span class="s">"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"secretPassword"</span> <span class="na">id=</span><span class="s">"secretPassword"</span> <span class="na">name=</span><span class="s">"secretPassword"</span> <span class="na">placeholder=</span><span class="s">"패스워드"</span> <span class="na">required</span><span class="nt">&gt;&lt;br&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>확인<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/board.php"</span><span class="nt">&gt;</span>돌아가기<span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>패스워드를 입력받는 secretBoard.php를 생성하였다. 해당 부분에서는 패스워드를 입력받는데 no에 대한 정보의 유치를 위해서 hidden 타입으로 추가하였다. 이제 POST데이터로 secretPassword를 받은 내용을 처리해주는 코드를 view에 추가하면 된다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'no'</span><span class="p">])){</span>
      <span class="nv">$no</span><span class="o">=</span><span class="nx">fix_string</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'no'</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'secretPassword'</span><span class="p">])){</span>
      <span class="nv">$secretKey</span><span class="o">=</span><span class="nx">fix_string</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'secretPassword'</span><span class="p">]);</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>기존의 GET파라미터 형식의 no를 REQUEST로 바꿈으로써 get과 post형식을 동시에 지원하게 된다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">if</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'secret'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$secretKey</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">){</span>
        <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("비밀글입니다.");'</span><span class="p">;</span>
        <span class="k">echo</span> <span class="s2">"location.href='/secretBoard.php?no=</span><span class="si">{</span><span class="nv">$no</span><span class="si">}</span><span class="s2">';&lt;/script&gt;"</span><span class="p">;</span>
        <span class="k">exit</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">if</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'secretPassword'</span><span class="p">]</span> <span class="o">==</span> <span class="nv">$secretKey</span><span class="p">){</span>
        <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("right!"");&lt;/script&gt;'</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">else</span><span class="p">{</span>
        <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("패스워드를 잘못 입력하셨습니다.");'</span><span class="p">;</span>
        <span class="k">echo</span> <span class="s2">"location.href='/secretBoard.php?no=</span><span class="si">{</span><span class="nv">$no</span><span class="si">}</span><span class="s2">';&lt;/script&gt;"</span><span class="p">;</span>
        <span class="k">exit</span><span class="p">;</span> 
      <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>그리고 비밀글 부분의 루틴에서 password를 입력받았는지를 판단한 뒤 쿼리 조회결과와 비교하여 같은 경우에는 밑의 루틴을 실행하며 다른 경우에는 다시 secretBoard.php로 리다이렉트를 하도록 하였다. 이제 해당 부분에서 password와 같이 평문형식으로 오가는 값에 대한 조건 변경을 아래와 같이 진행하면 대략적인 구현이 마무리된다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">if</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'secret'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$secretKey</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">){</span>
        <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("비밀글입니다.");'</span><span class="p">;</span>
        <span class="k">echo</span> <span class="s2">"location.href='/secretBoard.php?no=</span><span class="si">{</span><span class="nv">$no</span><span class="si">}</span><span class="s2">';&lt;/script&gt;"</span><span class="p">;</span>
        <span class="k">exit</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">password_verify</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'secretPassword'</span><span class="p">],</span> <span class="nv">$secretKey</span><span class="p">)){</span>
        <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("패스워드를 잘못 입력하셨습니다.");'</span><span class="p">;</span>
        <span class="k">echo</span> <span class="s2">"location.href='/secretBoard.php?no=</span><span class="si">{</span><span class="nv">$no</span><span class="si">}</span><span class="s2">';&lt;/script&gt;"</span><span class="p">;</span>
        <span class="k">exit</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<h3 id="게시판-글-수정-구현">게시판 글 수정 구현</h3>

<p>글에 대해 수정하는 루틴을 작성하고자 하는데 가장 좋은건 view 페이지 내부에서 리다이렉션을 하는 방법이다. 그러기 위해서는 작성자가 맞는지 검증이 필요하다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">onclick=</span><span class="s">"location.href='javascript:history.back();'"</span><span class="nt">&gt;</span>뒤로가기<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">onclick=</span><span class="s">"location.href='/modifyPage.php?no=</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$no</span><span class="cp">?&gt;</span><span class="s">'"</span><span class="nt">&gt;</span>수정하기<span class="nt">&lt;/button&gt;</span>
</code></pre></div></div>

<p>view.php에서 modifyPage.php로의 링크를 추가해준다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
  <span class="nb">session_start</span><span class="p">();</span>
  <span class="nv">$title</span> <span class="o">=</span> <span class="s2">"글 수정"</span><span class="p">;</span>
  <span class="k">require_once</span><span class="p">(</span><span class="s1">'head.php'</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'USERSESSION'</span><span class="p">])){</span>
  <span class="k">echo</span> <span class="s1">'로그인 정보 '</span> <span class="o">.</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'NICKNAME'</span><span class="p">]</span> <span class="o">.</span> <span class="s1">'&lt;br&gt;'</span><span class="p">;</span>
  <span class="k">echo</span> <span class="s1">'&lt;a href="/logout.php"&gt;로그아웃&lt;/a&gt;'</span><span class="p">;</span>
  <span class="p">}</span>
<span class="cp">?&gt;</span>

<span class="cp">&lt;?php</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'USERSESSION'</span><span class="p">])){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("로그인이 필요합니다.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'location.href="/loginForm.php";&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="nf">fix_string</span><span class="p">(</span><span class="nv">$string</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">get_magic_quotes_gpc</span><span class="p">())</span> <span class="nv">$string</span><span class="o">=</span><span class="nb">stripslashes</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">htmlentities</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
  <span class="p">}</span>
  
  <span class="nv">$no</span><span class="o">=</span><span class="s2">""</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'no'</span><span class="p">])){</span>
    <span class="nv">$no</span><span class="o">=</span><span class="nx">fix_string</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'no'</span><span class="p">]);</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="nv">$no</span><span class="o">&lt;=</span><span class="mi">0</span> <span class="k">or</span> <span class="o">!</span><span class="nv">$no</span><span class="p">){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("잘못된 접근입니다!");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">require_once</span><span class="p">(</span><span class="s1">'BoardDBConnect.php'</span><span class="p">);</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT * FROM FreeBoard WHERE boardNo LIKE ?"</span><span class="p">;</span>
  <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">stmt_init</span><span class="p">();</span>
  <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bind_param</span><span class="p">(</span><span class="s2">"i"</span><span class="p">,</span> <span class="nv">$no</span><span class="p">);</span>
  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">get_result</span><span class="p">();</span>
  <span class="nv">$row</span> <span class="o">=</span> <span class="nx">mysqli_fetch_array</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$row</span><span class="p">){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("잘못된 접근입니다!");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'author'</span><span class="p">]</span> <span class="o">==</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'nickname'</span><span class="p">])){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("글 작성자만 수정이 가능합니다.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

<span class="cp">?&gt;</span>

<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"modify.php"</span> <span class="na">method=</span><span class="s">"POST"</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">id=</span><span class="s">"no"</span> <span class="na">name=</span><span class="s">"no"</span> <span class="na">value=</span><span class="s">"</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$no</span><span class="cp">?&gt;</span><span class="s">"</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"title"</span> <span class="na">value=</span><span class="s">"</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'title'</span><span class="p">]</span> <span class="cp">?&gt;</span><span class="s">"</span> <span class="na">style=</span><span class="s">"width:300px;"</span><span class="nt">&gt;&lt;br&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"content"</span> <span class="na">value=</span><span class="s">"</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span> <span class="cp">?&gt;</span><span class="s">"</span> <span class="na">style=</span><span class="s">"width:300px;height:200px;"</span><span class="nt">&gt;&lt;br&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">placeholder=</span><span class="s">"패스워드"</span> <span class="na">required</span><span class="nt">&gt;&lt;br&gt;</span>
<span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>수정<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">onclick=</span><span class="s">"location.href='javascript:history.back();'"</span><span class="nt">&gt;</span>뒤로가기<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre></div></div>

<p>로직은 no를 넘겨준 뒤 쿼리를 조회한다. 그리고 정보가 존재하는 경우 author와 userID가 동일한지를 판단한 뒤 동일한 경우 내용을 form의 형태로 보여주게 된다. 그리고 password를 포함한 수정된 정보를 modify.php로 전송하면 해당 부분에서 검증 후에 업데이트가 진행되도록 할 것이다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">mysql&gt;</span><span class="w"> </span><span class="k">select</span> <span class="k">*</span> from FreeBoard<span class="p">;</span>
<span class="go">+---------+-------------+--------+---------------------+---------+--------+----------------+------------+
| boardNo | title       | author | time                | content | secret | secretPassword | permission |
+---------+-------------+--------+---------------------+---------+--------+----------------+------------+
|       1 | HelloWorld  | Admin  | 2020-02-20 00:00:00 | ABCDEF  |      0 | NULL           |          1 |
|       2 | HelloWorld2 | Admin  | 2020-02-20 00:00:00 | ABCDEF  |      0 | NULL           |          1 |
|       3 | HelloWorld2 | Admin  | 2020-02-20 00:00:00 | ABCDEF  |      0 | NULL           |          2 |
|       4 | HelloWorld2 | Admin  | 2020-02-20 00:00:00 | ABCDEF  |      0 | NULL           |          3 |
|       5 | HelloWorld2 | Admin  | 2020-02-20 00:00:00 | ABCDEF  |      1 | abcdqwer       |          2 |
+---------+-------------+--------+---------------------+---------+--------+----------------+------------+
</span></code></pre></div></div>

<p>다음과 같이 게시판이 있는데 UPDATE를 사용하여 수정할 것이다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">mysql&gt;</span><span class="w"> </span>UPDATE FreeBoard SET <span class="nv">permission</span><span class="o">=</span><span class="s1">'2'</span>, <span class="nv">author</span><span class="o">=</span><span class="s1">'abcd'</span> WHERE <span class="nv">boardNo</span><span class="o">=</span><span class="s1">'5'</span><span class="p">;</span>
<span class="go">Query OK, 1 row affected (0.00 sec)
</span><span class="gp">mysql&gt;</span><span class="w"> </span><span class="k">select</span> <span class="k">*</span> from FreeBoard<span class="p">;</span>
<span class="go">+---------+-------------+--------+---------------------+---------+--------+----------------+------------+
| boardNo | title       | author | time                | content | secret | secretPassword | permission |
+---------+-------------+--------+---------------------+---------+--------+----------------+------------+
|       1 | HelloWorld  | Admin  | 2020-02-20 00:00:00 | ABCDEF  |      0 | NULL           |          1 |
|       2 | HelloWorld2 | Admin  | 2020-02-20 00:00:00 | ABCDEF  |      0 | NULL           |          1 |
|       3 | HelloWorld2 | Admin  | 2020-02-20 00:00:00 | ABCDEF  |      0 | NULL           |          2 |
|       4 | HelloWorld2 | Admin  | 2020-02-20 00:00:00 | ABCDEF  |      0 | NULL           |          3 |
|       5 | HelloWorld2 | abcd   | 2020-02-20 00:00:00 | ABCDEF  |      1 | abcdqwer       |          2 |
+---------+-------------+--------+---------------------+---------+--------+----------------+------------+
5 rows in set (0.00 sec)
</span></code></pre></div></div>

<p>UPDATE 명령어로 Table을 선택한 뒤 SET을 통해 변경하고자 하는 필드를, WHERE를 통해 조건을 주면 된다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
  <span class="nb">session_start</span><span class="p">();</span>
  <span class="nv">$title</span> <span class="o">=</span> <span class="s2">"글 수정"</span><span class="p">;</span>
  <span class="k">require_once</span><span class="p">(</span><span class="s1">'head.php'</span><span class="p">);</span>

  <span class="k">function</span> <span class="nf">fix_string</span><span class="p">(</span><span class="nv">$string</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">get_magic_quotes_gpc</span><span class="p">())</span> <span class="nv">$string</span><span class="o">=</span><span class="nb">stripslashes</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">htmlentities</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nv">$id</span><span class="o">=</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'USERSESSION'</span><span class="p">];</span>
  <span class="nv">$no</span><span class="o">=</span><span class="nv">$pw</span><span class="o">=</span><span class="nv">$title</span><span class="o">=</span><span class="nv">$content</span><span class="o">=</span><span class="s2">""</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'password'</span><span class="p">]))</span>
    <span class="nv">$pw</span><span class="o">=</span><span class="nx">fix_string</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'password'</span><span class="p">]);</span>

  <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'title'</span><span class="p">]))</span>
    <span class="nv">$title</span><span class="o">=</span><span class="nx">fix_string</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'title'</span><span class="p">]);</span>

  <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]))</span>
    <span class="nv">$content</span><span class="o">=</span><span class="nx">fix_string</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]);</span>

  <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'no'</span><span class="p">])){</span>
    <span class="nv">$no</span><span class="o">=</span><span class="nx">fix_string</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'no'</span><span class="p">]);</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="nv">$no</span><span class="o">&lt;=</span><span class="mi">0</span> <span class="k">or</span> <span class="o">!</span><span class="nv">$no</span><span class="p">){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("잘못된 접근입니다!");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$pw</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("패스워드를 다시 입력해주세요.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">require_once</span><span class="p">(</span><span class="s1">'UserDBconnect.php'</span><span class="p">);</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT * FROM Account WHERE userID LIKE ?"</span><span class="p">;</span>
  <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">stmt_init</span><span class="p">();</span>
  <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bind_param</span><span class="p">(</span><span class="s2">"s"</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">get_result</span><span class="p">();</span>
  <span class="nv">$row</span> <span class="o">=</span> <span class="nx">mysqli_fetch_array</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$row</span><span class="p">){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("잘못된 정보입니다.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'userID'</span><span class="p">]</span><span class="o">==</span><span class="nv">$id</span><span class="p">)){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("잘못된 정보입니다.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">password_verify</span><span class="p">(</span><span class="nv">$pw</span><span class="p">,</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'password'</span><span class="p">])){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("패스워드가 잘못되었습니다.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nv">$conn2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mysqli</span><span class="p">(</span><span class="s2">"db"</span><span class="p">,</span> <span class="s2">"wizley"</span><span class="p">,</span> <span class="s2">"alpine"</span><span class="p">,</span> <span class="s2">"Board"</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$conn2</span><span class="p">){</span>
    <span class="k">die</span><span class="p">(</span><span class="s2">"Connection Error!"</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT * FROM FreeBoard WHERE boardNo LIKE ?"</span><span class="p">;</span>
  <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn2</span><span class="o">-&gt;</span><span class="na">stmt_init</span><span class="p">();</span>
  <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn2</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bind_param</span><span class="p">(</span><span class="s2">"i"</span><span class="p">,</span> <span class="nv">$no</span><span class="p">);</span>
  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">get_result</span><span class="p">();</span>
  <span class="nv">$row</span> <span class="o">=</span> <span class="nx">mysqli_fetch_array</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$row</span><span class="p">){</span>
  <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("잘못된 접근입니다!");'</span><span class="p">;</span>
  <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
  <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'author'</span><span class="p">]</span> <span class="o">==</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'nickname'</span><span class="p">])){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;history.back();&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"UPDATE FreeBoard SET title=?, content=? WHERE boardNo=?"</span><span class="p">;</span>
  <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn2</span><span class="o">-&gt;</span><span class="na">stmt_init</span><span class="p">();</span>
  <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn2</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bind_param</span><span class="p">(</span><span class="s2">"ssi"</span><span class="p">,</span> <span class="nv">$title</span><span class="p">,</span> <span class="nv">$content</span><span class="p">,</span> <span class="nv">$no</span><span class="p">);</span>
  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>

  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>
  <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>
  <span class="nv">$conn2</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>

  <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("수정이 완료되었습니다.");'</span><span class="p">;</span>
  <span class="k">echo</span> <span class="s1">'location.href="/board.php";&lt;/script&gt;'</span><span class="p">;</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<p>들어온 정보를 수정하는 modify에서는 각각의 POST 필드에 대한 값 검사를 진행한 뒤, 넘어온 패스워드를 쿼리 조회를 통해 비교한다. 그 후 쿼리 조회를 통해 변경하고자 하는 게시물의 값을 가져와 author의 정보가 SESSION의 닉네임 정보와 일치하는지 한번 더 검사를 진행한 뒤에 UPDATE를 통해 수정을 하게 된다. 그 후 2페이지 전으로 go를 통해 돌아가는 루틴을 가지게 된다.</p>

<h3 id="게시판-글-작성-구현">게시판 글 작성 구현</h3>

<p>사실상 사람에 따라 이부분을 가장 먼저 구현하기도 할 것 같은데 어쩌다보니 우선순위에서 밀렸다. 방법은 Register와 비슷하다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
  <span class="nb">session_start</span><span class="p">();</span>
  <span class="nv">$title</span> <span class="o">=</span> <span class="s2">"글 작성하기"</span><span class="p">;</span>
  <span class="k">require_once</span><span class="p">(</span><span class="s1">'head.php'</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'USERSESSION'</span><span class="p">])){</span>
  <span class="k">echo</span> <span class="s1">'로그인 정보 '</span> <span class="o">.</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'NICKNAME'</span><span class="p">]</span> <span class="o">.</span> <span class="s1">'&lt;br&gt;'</span><span class="p">;</span>
  <span class="k">echo</span> <span class="s1">'&lt;a href="/logout.php"&gt;로그아웃&lt;/a&gt;'</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'USERSESSION'</span><span class="p">])){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("로그인이 필요합니다.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'location.href="/loginForm.php";&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

<span class="cp">?&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>

<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/add.php"</span> <span class="na">method=</span><span class="s">"POST"</span><span class="nt">&gt;</span>
제목 : <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"title"</span> <span class="na">placeholder=</span><span class="s">"제목"</span> <span class="na">style=</span><span class="s">"width:300px;"</span> <span class="na">required</span><span class="nt">&gt;&lt;br&gt;</span>
내용 : <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"content"</span> <span class="na">placeholder=</span><span class="s">"내용"</span> <span class="na">style=</span><span class="s">"width:300px;height:200px;"</span> <span class="na">required</span><span class="nt">&gt;&lt;br&gt;</span>
비밀글 여부 : <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">name=</span><span class="s">"secret"</span> <span class="na">placeholder=</span><span class="s">"비밀"</span><span class="nt">&gt;</span>
전체공개 여부 : <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">name=</span><span class="s">"permission"</span> <span class="na">placeholder=</span><span class="s">"공개여부"</span><span class="nt">&gt;&lt;br&gt;</span>
패스워드 : <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">placeholder=</span><span class="s">"패스워드"</span> <span class="na">required</span><span class="nt">&gt;&lt;br&gt;</span>
<span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>작<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">onclick=</span><span class="s">"location.href='javascript:history.back();'"</span><span class="nt">&gt;</span>뒤로가기<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre></div></div>

<p>글 작성에 대해서는 로그인한 사용자만 허용할 것이므로 위와 같이 조건식을 맞춘 뒤에 폼을 작성하였다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
  <span class="nb">session_start</span><span class="p">();</span>
  <span class="nv">$title</span> <span class="o">=</span> <span class="s2">"글 등록"</span><span class="p">;</span>
  <span class="k">require_once</span><span class="p">(</span><span class="s1">'head.php'</span><span class="p">);</span>

  <span class="k">function</span> <span class="nf">fix_string</span><span class="p">(</span><span class="nv">$string</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">get_magic_quotes_gpc</span><span class="p">())</span> <span class="nv">$string</span><span class="o">=</span><span class="nb">stripslashes</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">htmlentities</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nv">$id</span><span class="o">=</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'USERSESSION'</span><span class="p">];</span>
  <span class="nv">$pw</span><span class="o">=</span><span class="nv">$title</span><span class="o">=</span><span class="nv">$content</span><span class="o">=</span><span class="s2">""</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'password'</span><span class="p">]))</span>
    <span class="nv">$pw</span><span class="o">=</span><span class="nx">fix_string</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'password'</span><span class="p">]);</span>

  <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'title'</span><span class="p">]))</span>
    <span class="nv">$title</span><span class="o">=</span><span class="nx">fix_string</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'title'</span><span class="p">]);</span>

  <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]))</span>
    <span class="nv">$content</span><span class="o">=</span><span class="nx">fix_string</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]);</span>

  <span class="k">if</span><span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$pw</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("패스워드를 다시 입력해주세요.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$title</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">){</span>
    <span class="nv">$title</span><span class="o">=</span><span class="s1">'제목없음'</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$content</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">){</span>
    <span class="nv">$content</span><span class="o">=</span><span class="s1">'내용없음'</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">require_once</span><span class="p">(</span><span class="s1">'UserDBconnect.php'</span><span class="p">);</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT * FROM Account WHERE userID LIKE ?"</span><span class="p">;</span>
  <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">stmt_init</span><span class="p">();</span>
  <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bind_param</span><span class="p">(</span><span class="s2">"s"</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">get_result</span><span class="p">();</span>
  <span class="nv">$row</span> <span class="o">=</span> <span class="nx">mysqli_fetch_array</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$row</span><span class="p">){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("잘못된 정보입니다.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'userID'</span><span class="p">]</span><span class="o">==</span><span class="nv">$id</span><span class="p">)){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("잘못된 정보입니다.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">password_verify</span><span class="p">(</span><span class="nv">$pw</span><span class="p">,</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'password'</span><span class="p">])){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("패스워드가 잘못되었습니다.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nv">$secret</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
  <span class="nv">$secretPassword</span> <span class="o">=</span> <span class="nb">password_hash</span><span class="p">(</span><span class="nv">$pw</span><span class="p">,</span> <span class="nx">PASSWORD_DEFAULT</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'secret'</span><span class="p">])){</span>
    <span class="nv">$secret</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nv">$permission</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'permission'</span><span class="p">])){</span>
    <span class="nv">$permission</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nv">$dateNow</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s2">"Y-m-d H:i:s"</span><span class="p">);</span>

  <span class="nv">$conn2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mysqli</span><span class="p">(</span><span class="s2">"db"</span><span class="p">,</span> <span class="s2">"wizley"</span><span class="p">,</span> <span class="s2">"alpine"</span><span class="p">,</span> <span class="s2">"Board"</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$conn2</span><span class="p">){</span>
    <span class="k">die</span><span class="p">(</span><span class="s2">"Connection Error!"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"
    INSERT INTO FreeBoard(title, author, time, content, secret, secretPassword, permission)
    VALUES(?,?,'</span><span class="nv">$dateNow</span><span class="s2">',?,?,?,?)
  "</span><span class="p">;</span>

  <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn2</span><span class="o">-&gt;</span><span class="na">stmt_init</span><span class="p">();</span>
  <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn2</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bind_param</span><span class="p">(</span><span class="s2">"sssisi"</span><span class="p">,</span> <span class="nv">$title</span><span class="p">,</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'NICKNAME'</span><span class="p">],</span> <span class="nv">$content</span><span class="p">,</span> <span class="nv">$secret</span><span class="p">,</span> <span class="nv">$secretPassword</span><span class="p">,</span> <span class="nv">$permission</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">()){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("정보를 다시 확인해주세요.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>
  <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>
  <span class="nv">$conn2</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>

  <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("작성이 완료되었습니다.");'</span><span class="p">;</span>
  <span class="k">echo</span> <span class="s1">'history.go(-2);&lt;/script&gt;'</span><span class="p">;</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<p>secretPassword의 값은 사용자의 패스워드를 해쉬한 값을 사용하였고, 그 여부는 checkbox의 결과에 따라 다르게 처리된다. 그리고 해당 부분을 작성하고 난 뒤 secret 부분에 대한 점검을 진행하던 중 패스워드가 올바르지 않다는 결과가 계속 출력이 되었다. 알고봤더니 password_verfiy의 인자 순서가 중요했다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">password_verify</span><span class="p">(</span><span class="nv">$secretKey</span><span class="p">,</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'secretPassword'</span><span class="p">])){</span>
        <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("패스워드를 잘못 입력하셨습니다.");'</span><span class="p">;</span>
        <span class="k">echo</span> <span class="s2">"location.href='/secretBoard.php?no=</span><span class="si">{</span><span class="nv">$no</span><span class="si">}</span><span class="s2">';&lt;/script&gt;"</span><span class="p">;</span>
        <span class="k">exit</span><span class="p">;</span>
      <span class="p">}</span>
</code></pre></div></div>

<p>view.php에서 해당 부분의 변수의 위치를 변경하자 정상적으로 작동하는 것을 확인할 수 있었다. 마이너한 로직 버그를 곳곳에 수정을 해주고 나면 작성하는 기능도 완료된다!</p>

<h3 id="게시판-글-삭제-구현">게시판 글 삭제 구현</h3>

<p>드디어 대망의 삭제 부분까지 도달하였다. 이 부분을 끝으로 생각했던 게시판의 간단한 기능들에 대한 구현은 마무리 될 것 같다. 해당 기능도 마찬가지로 조회를 들어간 상태에서 수정옆에 존재하면 좋을 기능이기에 끼워넣는 방식으로 구현하도록 하겠다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">onclick=</span><span class="s">"location.href='javascript:history.back();'"</span><span class="nt">&gt;</span>뒤로가기<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">onclick=</span><span class="s">"location.href='/modifyPage.php?no=</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$no</span><span class="cp">?&gt;</span><span class="s">'"</span><span class="nt">&gt;</span>수정하기<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">onclick=</span><span class="s">"location.href='/deletePage.php?no=</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$no</span><span class="cp">?&gt;</span><span class="s">'"</span><span class="nt">&gt;</span>삭제하기<span class="nt">&lt;/button&gt;</span>
</code></pre></div></div>

<p>view 부분에 버튼을 추가해준다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
  <span class="nb">session_start</span><span class="p">();</span>
  <span class="nv">$title</span> <span class="o">=</span> <span class="s2">"글 삭제"</span><span class="p">;</span>
  <span class="k">require_once</span><span class="p">(</span><span class="s1">'head.php'</span><span class="p">);</span>
  
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'USERSESSION'</span><span class="p">])){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("로그인이 필요합니다.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'location.href="/loginForm.php";&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="nf">fix_string</span><span class="p">(</span><span class="nv">$string</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">get_magic_quotes_gpc</span><span class="p">())</span> <span class="nv">$string</span><span class="o">=</span><span class="nb">stripslashes</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">htmlentities</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
  <span class="p">}</span>
  
  <span class="nv">$no</span><span class="o">=</span><span class="s2">""</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'no'</span><span class="p">])){</span>
    <span class="nv">$no</span><span class="o">=</span><span class="nx">fix_string</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'no'</span><span class="p">]);</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="nv">$no</span><span class="o">&lt;=</span><span class="mi">0</span> <span class="k">or</span> <span class="o">!</span><span class="nv">$no</span><span class="p">){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("잘못된 접근입니다!");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">require_once</span><span class="p">(</span><span class="s1">'BoardDBConnect.php'</span><span class="p">);</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT * FROM FreeBoard WHERE boardNo LIKE ?"</span><span class="p">;</span>
  <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">stmt_init</span><span class="p">();</span>
  <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bind_param</span><span class="p">(</span><span class="s2">"i"</span><span class="p">,</span> <span class="nv">$no</span><span class="p">);</span>
  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">get_result</span><span class="p">();</span>
  <span class="nv">$row</span> <span class="o">=</span> <span class="nx">mysqli_fetch_array</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$row</span><span class="p">){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("잘못된 접근입니다!");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'author'</span><span class="p">]</span> <span class="o">==</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'NICKNAME'</span><span class="p">])){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("글 작성자만 삭제 가능합니다.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

<span class="cp">?&gt;</span>

<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/delete.php"</span> <span class="na">method=</span><span class="s">"POST"</span><span class="nt">&gt;</span>
한번 삭제된 글은 복구가 되지 않습니다. 그래도 삭제하시겠습니까?<span class="nt">&lt;br&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">id=</span><span class="s">"no"</span> <span class="na">name=</span><span class="s">"no"</span> <span class="na">value=</span><span class="s">"</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$no</span><span class="cp">?&gt;</span><span class="s">"</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">placeholder=</span><span class="s">"패스워드"</span> <span class="na">required</span><span class="nt">&gt;&lt;br&gt;</span>
<span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>글 삭제<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">onclick=</span><span class="s">"location.href='/board.php'"</span><span class="nt">&gt;</span>취소<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/form&gt;</span>

</code></pre></div></div>

<p>먼저 겁을 주는 페이지를 작성한다. 그리고 낭낭히 패스워드도 입력을 받는다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
  <span class="nb">session_start</span><span class="p">();</span>
  <span class="nv">$title</span> <span class="o">=</span> <span class="s2">"글 삭제"</span><span class="p">;</span>
  <span class="k">require_once</span><span class="p">(</span><span class="s1">'head.php'</span><span class="p">);</span>

  <span class="k">function</span> <span class="nf">fix_string</span><span class="p">(</span><span class="nv">$string</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">get_magic_quotes_gpc</span><span class="p">())</span> <span class="nv">$string</span><span class="o">=</span><span class="nb">stripslashes</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">htmlentities</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nv">$id</span><span class="o">=</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'USERSESSION'</span><span class="p">];</span>
  <span class="nv">$no</span><span class="o">=</span><span class="nv">$pw</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'password'</span><span class="p">]))</span>
    <span class="nv">$pw</span><span class="o">=</span><span class="nx">fix_string</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'password'</span><span class="p">]);</span>

  <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'no'</span><span class="p">])){</span>
    <span class="nv">$no</span><span class="o">=</span><span class="nx">fix_string</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'no'</span><span class="p">]);</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="nv">$no</span><span class="o">&lt;=</span><span class="mi">0</span> <span class="k">or</span> <span class="o">!</span><span class="nv">$no</span><span class="p">){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("잘못된 접근입니다!");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$pw</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("패스워드를 다시 입력해주세요.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">require_once</span><span class="p">(</span><span class="s1">'UserDBconnect.php'</span><span class="p">);</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT * FROM Account WHERE userID LIKE ?"</span><span class="p">;</span>
  <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">stmt_init</span><span class="p">();</span>
  <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bind_param</span><span class="p">(</span><span class="s2">"s"</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">get_result</span><span class="p">();</span>
  <span class="nv">$row</span> <span class="o">=</span> <span class="nx">mysqli_fetch_array</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$row</span><span class="p">){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("잘못된 정보입니다.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'userID'</span><span class="p">]</span><span class="o">==</span><span class="nv">$id</span><span class="p">)){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("잘못된 정보입니다.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">password_verify</span><span class="p">(</span><span class="nv">$pw</span><span class="p">,</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'password'</span><span class="p">])){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("패스워드가 잘못되었습니다.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nv">$conn2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mysqli</span><span class="p">(</span><span class="s2">"db"</span><span class="p">,</span> <span class="s2">"wizley"</span><span class="p">,</span> <span class="s2">"alpine"</span><span class="p">,</span> <span class="s2">"Board"</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$conn2</span><span class="p">){</span>
    <span class="k">die</span><span class="p">(</span><span class="s2">"Connection Error!"</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT * FROM FreeBoard WHERE boardNo LIKE ?"</span><span class="p">;</span>
  <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn2</span><span class="o">-&gt;</span><span class="na">stmt_init</span><span class="p">();</span>
  <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn2</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bind_param</span><span class="p">(</span><span class="s2">"i"</span><span class="p">,</span> <span class="nv">$no</span><span class="p">);</span>
  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">get_result</span><span class="p">();</span>
  <span class="nv">$row</span> <span class="o">=</span> <span class="nx">mysqli_fetch_array</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$row</span><span class="p">){</span>
  <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("잘못된 접근입니다!");'</span><span class="p">;</span>
  <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
  <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'author'</span><span class="p">]</span> <span class="o">==</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'NICKNAME'</span><span class="p">])){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;history.back();&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"DELETE FROM FreeBoard WHERE boardNo=?"</span><span class="p">;</span>
  <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn2</span><span class="o">-&gt;</span><span class="na">stmt_init</span><span class="p">();</span>
  <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn2</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bind_param</span><span class="p">(</span><span class="s2">"i"</span><span class="p">,</span> <span class="nv">$no</span><span class="p">);</span>
  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>

  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>
  <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>
  <span class="nv">$conn2</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>

  <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("삭제 완료되었습니다.");'</span><span class="p">;</span>
  <span class="k">echo</span> <span class="s1">'location.href="/board.php";&lt;/script&gt;'</span><span class="p">;</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<p>남은건 위와 같이 검증과정을 걸친 뒤 DELETE를 사용해서 boardNo로 삭제를 진행하면 된다. 테스트를 통해 정상적으로 글이 삭제되는 것을 확인할 수 있었다.</p>

<h3 id="키워드-검색-기능-구현">키워드 검색 기능 구현</h3>

<p>다 끝난것 같았는데 먼가 허전한 기분이어서 생각을 해보니 게시판에 대해서 특정 게시물을 검색하는 기능에 대한 구현이 없었다. 이것까지 구현하면 진짜 간단한 기능을 수행하는 게시판이라고 불릴만한다고 생각을 한다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"GET"</span> <span class="na">action=</span><span class="s">"/board.php"</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"keyword"</span><span class="nt">&gt;</span>
<span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>검색<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre></div></div>

<p>board.php에 다음과 같은 form을 생성하였다. 이제 form의 결과를 토대로 게시물을 검색하도록 쿼리문을 수정하면 된다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="nv">$keyword</span><span class="o">=</span><span class="s2">""</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'keyword'</span><span class="p">])){</span>
        <span class="nv">$keyword</span><span class="o">=</span><span class="nx">fix_string</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'keyword'</span><span class="p">]);</span>
        <span class="nv">$keyword</span><span class="o">=</span><span class="s1">'%'</span><span class="o">.</span><span class="nv">$keyword</span><span class="o">.</span><span class="s1">'%'</span><span class="p">;</span>
        <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT * FROM FreeBoard WHERE title LIKE ?"</span><span class="p">;</span>
        <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">stmt_init</span><span class="p">();</span>
        <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
        <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bind_param</span><span class="p">(</span><span class="s2">"s"</span><span class="p">,</span> <span class="nv">$keyword</span><span class="p">);</span>
        <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">get_result</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">else</span><span class="p">{</span>
        <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT * FROM FreeBoard"</span><span class="p">;</span>
        <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">stmt_init</span><span class="p">();</span>
        <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
        <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">get_result</span><span class="p">();</span>
      <span class="p">}</span>
</code></pre></div></div>

<p>윗 부분에서 keyword가 존재하면 LIKE문을 통해 해당 keyword가 존재하는 값들을 출력하도록 한다.</p>

<p><img src="https://raw.githubusercontent.com/wizleysw/wizleysw.github.io/master/_posts/img/php_board/keyword.png" alt="keyword" /></p>

<p>hello라는 검색에 대하여 쿼리 조회를 통해 게시물들을 출력하는 것을 확인할 수 있다!. 이제 기본적인 게시판 관련 구현은 마무리가 되었다. 혹시나 더 진도를 나가고 싶은 분들은 게시물의 개수에 따른 페이지 구현 및 댓글 기능등을 추가로 구현해보는 것도 좋을 것 같다.</p>

<h3 id="회원탈퇴-구현">회원탈퇴 구현</h3>

<p>회원탈퇴 구현의 방법은 2가지로 나눌 수 있을 것이다. 게시물을 다 함께 삭제하는 것과 계정만 삭제하는 것이다. 나의 경우에는 계정은 삭제하되 게시물들은 permission 3번으로 업데이트하는 방식으로 진행할 것이다. 탈퇴의 경우 그냥 정보를 날리면 되서 간단한 편이다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
  <span class="nb">session_start</span><span class="p">();</span>
  <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'USERSESSION'</span><span class="p">])){</span>
  <span class="k">echo</span> <span class="s1">'로그인 정보 '</span> <span class="o">.</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'NICKNAME'</span><span class="p">]</span> <span class="o">.</span> <span class="s1">'&lt;br&gt;'</span><span class="p">;</span>
  <span class="k">echo</span> <span class="s1">'&lt;button type="button" onclick="location.href=\'/logout.php\'"&gt;로그아웃&lt;/button&gt;'</span><span class="p">;</span>
  <span class="k">echo</span> <span class="s1">'&lt;button type="button" onclick="location.href=\'/deactivate.php\'"&gt;회원탈퇴&lt;/button&gt;'</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">else</span><span class="p">{</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("로그인 페이지로 이동합니다.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'location.href="/loginForm.php";&lt;/script&gt;'</span><span class="p">;</span>
  <span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<p>index.php에 버튼하나를 추가해준다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
  <span class="nb">session_start</span><span class="p">();</span>
  <span class="nv">$title</span> <span class="o">=</span> <span class="s2">"회원탈퇴"</span><span class="p">;</span>
  <span class="k">require_once</span><span class="p">(</span><span class="s1">'head.php'</span><span class="p">);</span>
  
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'USERSESSION'</span><span class="p">])){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("로그인이 필요합니다.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'location.href="/loginForm.php";&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="nf">fix_string</span><span class="p">(</span><span class="nv">$string</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">get_magic_quotes_gpc</span><span class="p">())</span> <span class="nv">$string</span><span class="o">=</span><span class="nb">stripslashes</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">htmlentities</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
  <span class="p">}</span>
<span class="cp">?&gt;</span>

<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/leaveAccount.php"</span> <span class="na">method=</span><span class="s">"POST"</span><span class="nt">&gt;</span>
계정 삭제 시 복구가 불가능합니다. 계속 진행하시려면 패스워드를 입력해주세요.<span class="nt">&lt;br&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">id=</span><span class="s">"no"</span> <span class="na">name=</span><span class="s">"no"</span> <span class="na">value=</span><span class="s">"</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$no</span><span class="cp">?&gt;</span><span class="s">"</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">placeholder=</span><span class="s">"패스워드"</span> <span class="na">required</span><span class="nt">&gt;&lt;br&gt;</span>
<span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>회원탈퇴<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">onclick=</span><span class="s">"location.href='/board.php'"</span><span class="nt">&gt;</span>취소<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre></div></div>

<p>이동 페이지 부분에 password를 입력하는 창을 만들어 준다.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
  <span class="nb">session_start</span><span class="p">();</span>
  <span class="nv">$title</span> <span class="o">=</span> <span class="s2">"회원탈퇴"</span><span class="p">;</span>
  <span class="k">require_once</span><span class="p">(</span><span class="s1">'head.php'</span><span class="p">);</span>

  <span class="k">function</span> <span class="nf">fix_string</span><span class="p">(</span><span class="nv">$string</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">get_magic_quotes_gpc</span><span class="p">())</span> <span class="nv">$string</span><span class="o">=</span><span class="nb">stripslashes</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">htmlentities</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nv">$id</span><span class="o">=</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'USERSESSION'</span><span class="p">];</span>
  <span class="nv">$no</span><span class="o">=</span><span class="nv">$pw</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'password'</span><span class="p">]))</span>
    <span class="nv">$pw</span><span class="o">=</span><span class="nx">fix_string</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'password'</span><span class="p">]);</span>

  <span class="k">if</span><span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$pw</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("패스워드를 다시 입력해주세요.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">require_once</span><span class="p">(</span><span class="s1">'UserDBconnect.php'</span><span class="p">);</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"SELECT * FROM Account WHERE userID LIKE ?"</span><span class="p">;</span>
  <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">stmt_init</span><span class="p">();</span>
  <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bind_param</span><span class="p">(</span><span class="s2">"s"</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">get_result</span><span class="p">();</span>
  <span class="nv">$row</span> <span class="o">=</span> <span class="nx">mysqli_fetch_array</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$row</span><span class="p">){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("잘못된 정보입니다.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'userID'</span><span class="p">]</span><span class="o">==</span><span class="nv">$id</span><span class="p">)){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("잘못된 정보입니다.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">password_verify</span><span class="p">(</span><span class="nv">$pw</span><span class="p">,</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'password'</span><span class="p">])){</span>
    <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("패스워드가 잘못되었습니다.");'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'history.back();&lt;/script&gt;'</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nv">$conn2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mysqli</span><span class="p">(</span><span class="s2">"db"</span><span class="p">,</span> <span class="s2">"wizley"</span><span class="p">,</span> <span class="s2">"alpine"</span><span class="p">,</span> <span class="s2">"Board"</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$conn2</span><span class="p">){</span>
    <span class="k">die</span><span class="p">(</span><span class="s2">"Connection Error!"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nv">$permission</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"UPDATE FreeBoard SET permission=? WHERE author=?"</span><span class="p">;</span>
  <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn2</span><span class="o">-&gt;</span><span class="na">stmt_init</span><span class="p">();</span>
  <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn2</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bind_param</span><span class="p">(</span><span class="s2">"is"</span><span class="p">,</span> <span class="nv">$permission</span> <span class="p">,</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'NICKNAME'</span><span class="p">]);</span>
  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>

  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"DELETE FROM Account WHERE userID=?"</span><span class="p">;</span>
  <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">stmt_init</span><span class="p">();</span>
  <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bind_param</span><span class="p">(</span><span class="s2">"s"</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>

  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>
  <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>
  <span class="nv">$conn2</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>

  <span class="k">echo</span> <span class="s1">'&lt;script&gt;alert("회원탈퇴가 완되었습니다.");'</span><span class="p">;</span>
  <span class="k">echo</span> <span class="s1">'location.href="/logout.php";&lt;/script&gt;'</span><span class="p">;</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<p>내부적으로 처리하는 루틴은 다른 루틴과 비슷하게 password에 대한 검증을 진행한 뒤에 UPDATE를 통해 해당 사용자의 게시글의 permission을 3으로 변경한다. 그 뒤 DELETE를 통해 Account에서 userID로 검색하여 삭제하는 루틴이 실행된다. 이를 통해 회원탈퇴까지 구현이 모두 완료되었다!!</p>

<h2 id="template">Template</h2>

<p>너무 못생긴 사이트에 템플릿을 약간 입혀볼까 한다. 프론트를 전혀 할 줄 모르기에 이뻐보이는 테마를 하나 골랐다.</p>

<p>https://html5up.net/astral</p>

<p>동적으로 렌더링되는데 사용되는 HTML 템플릿같은데 잘 모르기때문에 스태틱으로 대충 넣어서 바꿔보았다.</p>

<p><img src="https://raw.githubusercontent.com/wizleysw/wizleysw.github.io/master/_posts/img/php_board/login.png" alt="login" /></p>

<p>로그인을 하게 되면 다음과 같은 페이지를 만날 수 있다.</p>

<p><img src="https://raw.githubusercontent.com/wizleysw/wizleysw.github.io/master/_posts/img/php_board/login_board.png" alt="login_board" /></p>

<p>그리고 게시판을 보면 그 전과 달리 조금은 예뻐진 것을 확인할 수 있다. 이렇게 대략 5일정도 2020년도의 첫 번째 프로젝트의 개발을 완료하였다!.</p>

<h2 id="github-link">GITHUB link</h2>

<p><a href="https://github.com/wizleysw/php_board">php_board 결과물</a></p>


        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> 태그: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#docker" class="page__taxonomy-item" rel="tag">docker</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#nginx" class="page__taxonomy-item" rel="tag">nginx</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#php" class="page__taxonomy-item" rel="tag">PHP</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> 카테고리: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#dev" class="page__taxonomy-item" rel="tag">dev</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> 게시일:</strong> <time datetime="2020-02-25T00:00:00+09:00">February 25, 2020</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">공유하기</h4>
  

  <a href="https://twitter.com/intent/tweet?text=PHP+%2B+nginx+%2B+mysql+%40+docker%EB%A1%9C+%EA%B2%8C%EC%8B%9C%ED%8C%90+%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0%20http%3A%2F%2Flocalhost%3A4000%2Fdev%2FPHP-%2B-nginx-%2B-mysql-%40-docker%25EB%25A1%259C-%25EA%25B2%258C%25EC%258B%259C%25ED%258C%2590-%25EA%25B5%25AC%25ED%2598%2584%25ED%2595%2598%25EA%25B8%25B0%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="공유하기 Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fdev%2FPHP-%2B-nginx-%2B-mysql-%40-docker%25EB%25A1%259C-%25EA%25B2%258C%25EC%258B%259C%25ED%258C%2590-%25EA%25B5%25AC%25ED%2598%2584%25ED%2595%2598%25EA%25B8%25B0%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="공유하기 Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fdev%2FPHP-%2B-nginx-%2B-mysql-%40-docker%25EB%25A1%259C-%25EA%25B2%258C%25EC%258B%259C%25ED%258C%2590-%25EA%25B5%25AC%25ED%2598%2584%25ED%2595%2598%25EA%25B8%25B0%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="공유하기 LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/dev/Hello-Design-Pattern/" class="pagination--pager" title="Hello Design Pattern!
">이전</a>
    
    
      <a href="/dev/Django-+-REST-+-SQLite-@-docker%EB%A1%9C-Eaten_Away-%EC%84%9C%EB%B9%84%EC%8A%A4-%EA%B0%9C%EB%B0%9C%ED%95%98%EA%B8%B0/" class="pagination--pager" title="Django + REST + SQLite @ docker로 Eaten_Away 서비스 개발하기
">다음</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">참고</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/dev/%EB%84%88%EC%9D%98-%EC%9D%B4%EB%A6%84%EC%9D%80-%EC%98%81%ED%99%94%EC%97%90-%EB%82%98%EC%98%A8-MyDiary%EB%A5%BC-%EA%B5%AC%ED%98%84%ED%95%9C-%EC%98%A4%ED%94%88%EC%86%8C%EC%8A%A4-%EC%95%B1-%EB%98%91%EA%B0%99%EC%9D%B4-%EB%94%B0%EB%9D%BC-%EC%BD%94%EB%94%A9%ED%95%B4%EB%B3%B4%EA%B8%B0/" rel="permalink">너의 이름은 영화에 나온 MyDiary를 구현한 오픈소스 앱 똑같이 따라 코딩해보기
</a>
      
    </h2>
    <!--
      comments:
        아카이브 싱글 페이지 각 포스트 제목 하단에 Updated 시간 표기
        기존에는 read_time이 표기됨
    
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  18 분 소요

</p>
    
    -->
    
    <p class="page__meta"><i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> June 02 2020</p>
    

    <p class="archive__item-excerpt" itemprop="description">Overview
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/dev/JAVA-+-graphQL%EB%A1%9C-%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C-%EC%96%B4%ED%94%8C-%ED%81%B4%EB%A1%A0%EC%BD%94%EB%94%A9%ED%95%98%EA%B8%B0/" rel="permalink">JAVA + graphQL로 안드로이드 어플 클론코딩하기
</a>
      
    </h2>
    <!--
      comments:
        아카이브 싱글 페이지 각 포스트 제목 하단에 Updated 시간 표기
        기존에는 read_time이 표기됨
    
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  38 분 소요

</p>
    
    -->
    
    <p class="page__meta"><i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> April 03 2020</p>
    

    <p class="archive__item-excerpt" itemprop="description">Overview
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/dev/Django-+-REST-+-SQLite-@-docker%EB%A1%9C-Eaten_Away-%EC%84%9C%EB%B9%84%EC%8A%A4-%EA%B0%9C%EB%B0%9C%ED%95%98%EA%B8%B0/" rel="permalink">Django + REST + SQLite @ docker로 Eaten_Away 서비스 개발하기
</a>
      
    </h2>
    <!--
      comments:
        아카이브 싱글 페이지 각 포스트 제목 하단에 Updated 시간 표기
        기존에는 read_time이 표기됨
    
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  46 분 소요

</p>
    
    -->
    
    <p class="page__meta"><i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> March 02 2020</p>
    

    <p class="archive__item-excerpt" itemprop="description">Overview
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/dev/Hello-Design-Pattern/" rel="permalink">Hello Design Pattern!
</a>
      
    </h2>
    <!--
      comments:
        아카이브 싱글 페이지 각 포스트 제목 하단에 Updated 시간 표기
        기존에는 read_time이 표기됨
    
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  6 분 소요

</p>
    
    -->
    
    <p class="page__meta"><i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> February 19 2020</p>
    

    <p class="archive__item-excerpt" itemprop="description">HelloWorld!
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>팔로우:</strong></li>
    

    
      
        
          <li><a href="https://github.com/wizleysw" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> 피드</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2020 Wizley. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>










  </body>
</html>
