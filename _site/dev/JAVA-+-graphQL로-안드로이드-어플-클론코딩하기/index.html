<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.17.2 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="ko" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>JAVA + graphQL로 안드로이드 어플 클론코딩하기 - 위즐리 블로그</title>
<meta name="description" content="Overview ">


  <meta name="author" content="Wizley">


<meta property="og:type" content="article">
<meta property="og:locale" content="ko_KR">
<meta property="og:site_name" content="위즐리 블로그">
<meta property="og:title" content="JAVA + graphQL로 안드로이드 어플 클론코딩하기">
<meta property="og:url" content="http://localhost:4000/dev/JAVA-+-graphQL%EB%A1%9C-%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C-%EC%96%B4%ED%94%8C-%ED%81%B4%EB%A1%A0%EC%BD%94%EB%94%A9%ED%95%98%EA%B8%B0/">


  <meta property="og:description" content="Overview ">







  <meta property="article:published_time" content="2020-04-03T00:00:00+09:00">





  

  


<link rel="canonical" href="http://localhost:4000/dev/JAVA-+-graphQL%EB%A1%9C-%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C-%EC%96%B4%ED%94%8C-%ED%81%B4%EB%A1%A0%EC%BD%94%EB%94%A9%ED%95%98%EA%B8%B0/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Wizley",
      "url": "http://localhost:4000/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="위즐리 블로그 Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

    
  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          위즐리 블로그
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/dev/" >dev</a>
            </li><li class="masthead__menu-item">
              <a href="/android/" >android</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">토글 메뉴</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="https://avatars1.githubusercontent.com/u/32321029?s=460&v=4" alt="Wizley" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Wizley</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>I think I wanna become Android developer for now</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">팔로우</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">KR</span>
        </li>
      

      
        
          
        
          
        
          
        
      

      

      
        <li>
          <a href="mailto:wizley@kakao.com">
            <meta itemprop="email" content="wizley@kakao.com" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> 이메일
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      
        <li>
          <a href="https://github.com/wizleysw" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="JAVA + graphQL로 안드로이드 어플 클론코딩하기">
    <meta itemprop="description" content="Overview">
    <meta itemprop="datePublished" content="2020-04-03T00:00:00+09:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">JAVA + graphQL로 안드로이드 어플 클론코딩하기
</h1>
          
          <!--
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  53 분 소요

</p>
          -->
          <p class="page_data"><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> 게시일: <time datetime="2020-04-03T00:00:00+09:00">April 03, 2020</time></p>
            
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On This Page</h4></header>
              <ul class="toc__menu">
  <li><a href="#overview">Overview</a>
    <ul>
      <li><a href="#appname">AppName</a></li>
    </ul>
  </li>
  <li><a href="#java-핵심-정리">JAVA 핵심 정리</a>
    <ul>
      <li><a href="#제어자modifier">제어자(Modifier)</a></li>
      <li><a href="#static">static</a></li>
      <li><a href="#final">final</a></li>
      <li><a href="#abstract">abstract</a></li>
      <li><a href="#public">public</a></li>
      <li><a href="#default">default</a></li>
      <li><a href="#protected">protected</a></li>
      <li><a href="#private">private</a></li>
      <li><a href="#인터페이스interface">인터페이스(Interface)</a></li>
    </ul>
  </li>
  <li><a href="#settings">Settings</a>
    <ul>
      <li><a href="#androidstudio">AndroidStudio</a></li>
      <li><a href="#docker로-graphql-django-생성하기">Docker로 graphql-django 생성하기</a></li>
      <li><a href="#layout-만들기">Layout 만들기</a></li>
    </ul>
  </li>
  <li><a href="#본격-기능-구현-시작">본격 기능 구현 시작</a>
    <ul>
      <li><a href="#introactivity">IntroActivity</a></li>
      <li><a href="#런처-아이콘-변경">런처 아이콘 변경</a></li>
      <li><a href="#액션바-숨기기">액션바 숨기기</a></li>
      <li><a href="#카메라-인텐트-구현하기">카메라 인텐트 구현하기</a></li>
      <li><a href="#갤러리-인텐트-구현하기">갤러리 인텐트 구현하기</a></li>
      <li><a href="#카카오-로그인-구현">카카오 로그인 구현</a></li>
      <li><a href="#카카오-로그인-정보로-계정-생성하기">카카오 로그인 정보로 계정 생성하기</a></li>
      <li><a href="#apollo-graphql-적용하기">Apollo graphql 적용하기</a></li>
      <li><a href="#api-서버로-쿼리-요청-및-응답받아오기">api 서버로 쿼리 요청 및 응답받아오기</a></li>
      <li><a href="#db-구성하기">DB 구성하기</a></li>
      <li><a href="#graphql-query문-변형">graphql Query문 변형</a></li>
      <li><a href="#django-media-url-설정">Django MEDIA URL 설정</a></li>
      <li><a href="#circleimageview-추가">CircleImageView 추가</a></li>
      <li><a href="#카메라로-찍은-사진을-public-directory에-저장하기">카메라로 찍은 사진을 Public Directory에 저장하기</a></li>
      <li><a href="#django-request-logging">django-request-logging</a></li>
      <li><a href="#graphql-file-upload-구현하기">graphql file upload 구현하기</a></li>
      <li><a href="#fragment로-사용자-이미지-recyclerview-처리하기">Fragment로 사용자 이미지 RecyclerView 처리하기</a></li>
      <li><a href="#검색기능-구현하기">검색기능 구현하기</a></li>
      <li><a href="#recyclerview에-onclick-인터페이스-구현하기">RecyclerView에 OnClick 인터페이스 구현하기</a></li>
      <li><a href="#constraint-layout-동적으로-visibility-설정하기">Constraint Layout 동적으로 VISIBILITY 설정하기</a></li>
      <li><a href="#팔로우언팔로우-기능-구현하기">팔로우/언팔로우 기능 구현하기</a></li>
      <li><a href="#filterable-인터페이스-recyclerview에-적용하기">Filterable 인터페이스 Recyclerview에 적용하기</a></li>
      <li><a href="#post의-정보-업데이트-하기">Post의 정보 업데이트 하기</a></li>
      <li><a href="#recyclerview-특정-위치로-이동시키기">RecyclerView 특정 위치로 이동시키기</a></li>
      <li><a href="#commentactivity-구현하기">CommentActivity 구현하기</a></li>
      <li><a href="#history-서비스-구현하기">History 서비스 구현하기</a></li>
      <li><a href="#sms-최신화">SMS 최신화</a></li>
      <li><a href="#github-link">GITHUB LINK</a></li>
    </ul>
  </li>
</ul>

            </nav>
          </aside>
        
        <h2 id="overview">Overview</h2>

<p>장고로 프로젝트가 마무리되자 말자 선택한 프로젝트는 안드로이드 클론 코딩이다. 개발자들이 많이 쓰는 JAVA라는 언어에 대해서 전혀 몰랐기 때문에 나중에 Spring으로 개발을 진행하는 상황을 대비할겸, 가장 핫한 주제인 모바일에 관련된 어플을 만들어보고싶기도했다. 사실 안드로이드를 개발해본적은 없지만 해킹 및 안드로이드 어플을 리버싱하는 과정을 통해서 대략적으로 어떻게 생겼는지에 대한 정보는 알고 있지만 정확히 어떤 식으로 안드로이드가 동작하는지에 대한 개념은 머리에 정립되어 있지 않았다. 이번 기회에 해킹이 아닌 개발의 관점에서 안드로이드 어플을 개발해보고 싶었다. 최근 코틀린으로 앱이 많이 개발되고 있기는 하지만 자바로도 짜보지 않은 앱을 코틀린으로 짜보기보다는 자바로 먼저 짠 뒤에 코틀린으로 포팅하는 방식이 더 효율적이라고 생각이 들었다. 그래서 요 근래 며칠간 자바의 정석이라는 책을 속독하였는데 내용이 너무 좋았다. 아무래도 low단에서 분석을 많이 진행하였다보니 책에서 저자가 설명한 메모리 그림들이 쏙쏙 이해가 잘 되었다.</p>

<p>이번에는 어떤 것들을 공부해볼까라는 생각을 하다보니 크게 4가지 정도가 머리속에서 떠올랐다. 매번 새로운 것들을 시도한다는 것은 여간 고통스러운것이 아니지만 하고나서 결과물을 볼 때의 그 성취감이 매번 도전을 하도록 만든다.</p>

<ol>
  <li>graphQL로 API 구현하기</li>
  <li>JAVA로 안드로이드 개발</li>
  <li>네이버/카카오 계정 로그인 구현</li>
  <li>redis 사용해보기</li>
</ol>

<p>이 전 프로젝트의 주제였던 eaten-Away 서비스를 만드는 과정에서 REST로 api 서버를 설계하였었다. GET, POST 등의 HTTP 메소드와 연동하는 부분이 편리하고 좋았지만 비슷한 기능을 가진 여러 기능들이 각각 매칭이 되어야한다는 불편함이 있었다. 이런 몇가지 불편함을 해소하기 위해서 facebook에서 graphQL을 고안하였다고 하는데 직접 사용을 해보면서 어떤 점이 개선이 되었는지를 비교해보고 싶었다. JAVA의 경우 앞서 말했듯이 Spring으로 개발을 할 프로젝트가 준비되어 있기 때문에 이를 위해서 미리 JAVA를 숙달한다는 의미가 있는 것 같다. (여담이지만 알고리즘에 대한 다른 사람의 풀이를 보면 C++ 뿐만 아니라 JAVA로 작성된 코드들이 많은데 책 한권 봤다고 이해가 되더라.) redis 같은 경우는 캐시 서버?? 관련 개념으로 자주 등장하는 것 같은데 아무래도 개발초보다 보니 멀티 쓰레드/DB/캐시 관련 지식이 부족하다보니 왜 저런 애들이 추가로 쓰이는지가 궁금하였다. 그래서 만약 안드로이드 개발에 사용될 수 있다면 한 번 같이 사용해보는 것도 괜찮다고 생각이 들었다. 마지막으로 네이버/카카오 계정 로그인 구현의 경우 요즘 대부분의 앱들이 따로 회원가입을 처리하지 않고 해당 api를 사용하기도 하고, 회원가입 및 개인정보와 관련된 부분을 덜 신경쓸 수 있다는 점에서 사용을 해보기로 마음먹었다. 어차피 클론코딩이고 어플에서도 api로 구현하긴 하였다.</p>

<h3 id="appname">AppName</h3>

<p><a href="https://play.google.com/store/apps/details?id=com.instagram.android&amp;hl=ko">인스타그램</a></p>

<p>원래 하고자 하는 다른 어플이 있었는데, 메일로 문의한 내용에 대한 답변이 오지 않아 부득이하게 변경을 하게 되었다. 많은 사람들이 클론 코딩 주제로 인스타그램을 선정하였는데 nodejs, react가 아닌 JAVA를 토대로 비슷하게 흉내내보는 토이 프로젝트로 진행하기로 하였다.</p>

<h2 id="java-핵심-정리">JAVA 핵심 정리</h2>

<p>자바를 공부하는 처음 접하거나 헷갈리는 개념들이 몇 있었다. 그 개념들에 대해서 간략하게 이해한대로 정리를 해놓고자 한다.</p>

<h3 id="제어자modifier">제어자(Modifier)</h3>

<p>제어자는 클래스나 변수 등의 선언부에 함께 사용하여 의미를 나타내는데 하나의 대상에 여러 조합을 사용하는 것이 가능하다. 하지만 public, protected, default, private을 의미하는 접근 제어자는 한 가지 종류만 사용이 가능하다.</p>

<h3 id="static">static</h3>

<p>static은 클래스 내에 생성이 될 경우 인스턴스에 관계없이 같은 값을 가지게 된다. 이는 static 클래스 변수를 모든 인스턴스가 공유함을 의미한다. 그 외에 static이 붙은 변수나 메서드 등은 인스턴스를 생성하지 않고 사용이 가능하다. 이 경우에 만약 메소드를 static으로 생성하였다면 인스턴스 멤버를 직접 사용하는 것이 불가능하다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Student</span><span class="o">{</span>
	<span class="kd">static</span> <span class="kt">int</span> <span class="n">grade</span> <span class="o">=</span> <span class="mi">90</span><span class="o">;</span>

	<span class="kd">static</span> <span class="o">{</span>
		<span class="c1">// 스태틱 변수의 초기화 수행</span>
	<span class="o">}</span>

	<span class="kd">static</span> <span class="kt">int</span> <span class="nf">is_bigger</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">){</span>
		<span class="k">return</span> <span class="n">a</span><span class="o">&gt;</span><span class="n">b</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="final">final</h3>

<p>final은 용어에서 예상이 가듯, 변경할 수 없다는 의미를 주기 위해 사용한다. 변수에 final을 붙히게 되면 상수가 되며 메서드에 붙히면 오버라이딩을 지원하지 않음을 의미한다. final은 클래스, 메서드, 멤버변수, 지역변수 모두에 사용이 가능하다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">final</span> <span class="kd">class</span> <span class="nc">Wizley</span><span class="o">{</span>
	<span class="kd">final</span> <span class="kt">int</span> <span class="n">grade</span> <span class="o">=</span> <span class="mi">100</span><span class="o">;</span>

	<span class="kd">final</span> <span class="kt">void</span> <span class="nf">getGrade</span><span class="o">(</span><span class="kt">int</span> <span class="n">grade</span><span class="o">){</span>
		<span class="k">return</span> <span class="n">grade</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>위와 같이 Wizley라는 클래스를 final로 선언을 하면 다른 클래스의 조상 클래스가 될 수 없으며 내부 값인 grade의 값 변경이 불가능하며 getGrade의 경우 오버라이딩이 불가능하게 된다.</p>

<p>만약 인스턴스의 변수가 final일 경우 생성자에서 초기화를 수행한다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Student</span><span class="o">{</span>
	<span class="kd">final</span> <span class="kt">int</span> <span class="n">grade</span><span class="o">;</span>

	<span class="nc">Student</span><span class="o">(</span><span class="kt">int</span> <span class="n">gradeinfo</span><span class="o">){</span>
		<span class="n">grade</span> <span class="o">=</span> <span class="n">gradeinfo</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nc">Student</span><span class="o">(){</span>
		<span class="k">this</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="n">args</span><span class="o">[]){</span>
		<span class="nc">Student</span> <span class="no">A</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Student</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>이렇게 클래스 내부에서 값을 설정하지 않은 경우 생성자를 통해 초기화가 가능하며 그 후에는 값에 대한 변경이 불가능하다.</p>

<h3 id="abstract">abstract</h3>

<p>abstract는 추상적인 형태를 표현하기 위해 클래스 또는 메소드에 사용된다. 선언부만 작성을 한 뒤에 구현을 나중에 작성할 시에 사용된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">AbstractStudent</span> <span class="o">{</span>
	<span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">getGrade</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="public">public</h3>

<p>public은 접근 제어자 중 하나이며 멤버 또는 클래스에 사용된다. 이런 접근 제어자들은 멤버 또는 클래스에 대한 정보를 외부에서 접근하지 못하도록 범위를 제한하는 경우에 주로 사용하며 default가 기본적으로 설정되어 있다. 이런 접근 제어자들 중 public은 제한이 전혀 없는 경우를 의미한다. 이는 즉 어디에서는 접근이 가능하다는 것을 의미한다.</p>

<h3 id="default">default</h3>

<p>기본 옵션으로 설정되는 default는 같은 패키지 내에서만 접근이 가능하다.</p>

<h3 id="protected">protected</h3>

<p>default보다 조금 더 넓은 범위로 같은 패지기 뿐만 아니라 다른 패키지의 자손클래스에서도 접근이 가능하다.</p>

<h3 id="private">private</h3>

<p>같은 클래스 내부에서만 접근이 가능하다. 또 private이 생성자에 추가된 경우 인스턴스의 생성을 제한할 수 있으며 생성을 위해서는 내부에서 생성에 사용할 static 메소드를 선언하여 호출하면 된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Student</span><span class="o">{</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="nc">Student</span> <span class="no">A</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Student</span><span class="o">();</span>

	<span class="kd">private</span> <span class="nf">Student</span><span class="o">(){</span>

	<span class="o">}</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="nc">Student</span> <span class="nf">getStudent</span><span class="o">(){</span>
		<span class="k">return</span> <span class="no">A</span><span class="o">;</span>
	<span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>지금까지의 접근 제어자의 접근 권한을 범위로 표현하면 다음과 같다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public &gt; protected &gt; default &gt; private
</code></pre></div></div>

<p>이런 특징에 의해 클래스는 보통 public 또는 default 중 하나로 생성이 되며 메서드 또는 멤버변수의 경우 4가지 옵션이 다 사용된다. 궁극적으로 이런 범위 제한은 클래스 내의 특정 정보를 외부에서 접근하지 못하도록 하기 위함이며 이는 캡슐화를 위함이다. 즉, 외부로부터 데이터를 보호하기 위해서 사용된다.</p>

<h3 id="인터페이스interface">인터페이스(Interface)</h3>

<p>추상 클래스와 거의 비슷한데 추상 메소드 또는 상수가 아닌 값을 가질 수 없다는 특징이 있다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">Movable</span><span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">A</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
	<span class="kd">public</span> <span class="kd">abstract</span> <span class="nf">move</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>이런 특징으로 인해 멤버변수의 경우 무조건 public static final 이어야 하며 메소드는 public abstract이여야 한다. 만약 생략할 경우 자동으로 설정이 된다.</p>

<p>자바는 클래스에 대한 다중상속이 불가능하지만 인터페이스는 가능하다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">Foodeatable</span> <span class="n">extend</span> <span class="nc">Drinkable</span><span class="o">,</span> <span class="nc">Eatable</span><span class="o">,</span> <span class="nc">Movable</span> <span class="o">{}</span>

<span class="kd">class</span> <span class="nc">Student</span> <span class="kd">implements</span> <span class="nc">Foodeatable</span><span class="o">{</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">move</span><span class="o">(){</span>

	<span class="o">};</span>
	<span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>인터페이스로부터 상속받은 메소드들에 대하여 클래스 내부에서 그에 맞게 구현을 해주어야 된다. 이런 점을 활용하여 다중상속을 구현하는 것이 가능하고 구현 부분이 인터페이스 내부에 존재하지 않기 때문에 그로 인하여 문제가 발생할 확률이 적다. 자바의 특성상 클래스를 구현하는 과정에서 다중 상속을 위해서는 다른 클래스를 클래스 멤버로 생성하여야 되는데 인터페이스로 이런 부분에 대한 효율적인 해결이 가능하다. 또한 서로 관계가 없는 클래스가 여러개 존재할 경우 인터페이스를 통해 상속관계가 아님에도 공통적인 구현이 가능하다는 특징이 있다.</p>

<p>이 점은 자바의 정석에 좋은 예제가 있는데 Unit이라는 클래스의 하위 클래스로 GroundUnit과 AirUnit이 있다고 가정해보자. 만약 SCV라는 Unit이 GroundUnit의 Tank와 AirUnit의 Dropship에 대해서 Repair가 가능한 경우 어떻게 구현을 해야될까?</p>

<p>만약 클래스 내부에 구현을 한다면 Repairable한 Unit의 개수만큼 오버로딩된 메소드가 구현되어야 할 것이다. 조상 또한 다르기 떄문에 최대한 공통적으로 묶는다 한들 결국 2개 이상의 메소드에 대한 구현이 불가피한 것이다.</p>

<p>이런 경우 Repairable 인터페이스를 연결해줌으로써 해결이 가능하다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
		<span class="nc">Tank</span> <span class="n">tank</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Tank</span><span class="o">();</span>
		<span class="no">SCV</span> <span class="n">scv</span> <span class="o">=</span> <span class="k">new</span> <span class="no">SCV</span><span class="o">();</span>
		<span class="n">scv</span><span class="o">.</span><span class="na">repair</span><span class="o">(</span><span class="n">tank</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">SCV</span> <span class="kd">extends</span> <span class="nc">GroundUnit</span> <span class="kd">implements</span> <span class="nc">Repairable</span><span class="o">{</span>
	<span class="no">SCV</span><span class="o">(){</span>
		<span class="c1">// aa</span>
	<span class="o">}</span>

	<span class="kt">void</span> <span class="nf">repair</span><span class="o">(</span><span class="nc">Repairable</span> <span class="n">r</span><span class="o">){</span>
		<span class="k">if</span><span class="o">(</span><span class="n">r</span> <span class="k">instanceof</span> <span class="nc">Unit</span><span class="o">){</span>
			<span class="c1">// aa</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>r이 Repairable 타입이기 때문에 인터페이스에 정의된 멤버만이 사용가능하다. 이 점을 활용하여 instanceof로 r이 Unit 중의 하나인지를 검증한 후에 구현코드를 작성하면 된다.</p>

<p>또 다른 점에서 인터페이스가 편리한것이 클래스 A와 B가 A-&gt;B의 형태를 가지고 있을 경우에 한 쪽에 대한 내용을 수정할 경우 두 클래스 내부의 관련된 코드를 모두 수정해야 된다는 특징이 있다. 이런 부분에서 인터페이스를 통해 접근을 하게 되면 둘 중 하나에서 변경이 필요한 경우 나머지 하나를 변경하지 않고 인터페이스 내부의 코드만을 변경하면 된다는 장점이 있다. 즉 A-&gt;I-&gt;B의 형태가 되는 것이다.</p>

<h2 id="settings">Settings</h2>

<p>개발을 진행하기 전에 안드로이드 관련 기초적인 내용들에 대한 많은 공부를 하였다. 안드로이드 역시 Django와 비슷하게 꽤 자세한 document가 있다.</p>

<p><a href="https://developer.android.com/guide/components/intents-filters?hl=ko">안드로이드 개발자 문서</a></p>

<p>공부한 내용들에 대한 키워드를 간략히 남겨보자면 안드로이드 레이아웃에 대한 개념, 라이프 사이클, 4가지 구성 요소, 액티비티 스택, 프레그먼트 등이 있었다.</p>

<p>개발의 순서에 대한 설명은 아래의 링크를 참고하기로 하였다.</p>

<p><a href="https://devcompass.co.kr/%EC%95%B1-%EC%A0%9C%EC%9E%91/">어플리케이션 제작 순서</a></p>

<h3 id="androidstudio">AndroidStudio</h3>

<p>안드로이드 개발은 안드로이드 스튜디오를 사용하는 것이 가장 편리해보인다. qemu 에뮬레이터도 있을 뿐 아니라 pycharm과 거의 동일한 IDE 기능을 가지고 있다. 거기다가 layout을 쉽게 그릴 수 있도록 도와주니 더욱 좋다.</p>

<p>안드로이드 개발을 위해서는 먼저 java를 사용하기 위한 jdk를 설치해야 되며 그 후 안드로이드 스튜디오를 설치하면 dependency가 대부분 설치가 된다. 그리고 이는 brew를 사용하면 편리하게 설치가 가능하다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">brew cask install android-studio
</span></code></pre></div></div>

<h3 id="docker로-graphql-django-생성하기">Docker로 graphql-django 생성하기</h3>

<p>이번에는 Django를 graphql과 엮어보기로 했다. 이를 위해서 Dockerfile을 아래와 같이 작성하였다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">FROM python:3

</span><span class="gp">MAINTAINER Wizley &lt;wizley@kakao.com&gt;</span><span class="w">
</span><span class="go">
WORKDIR /code
COPY ./requirements.txt /code

RUN pip3 install -r ./requirements.txt
</span></code></pre></div></div>

<p>그리고 requirements.txt에는 graphql 관련 라이브러리가 추가되었다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">aniso8601==7.0.0
asgiref==3.2.3
attrs==19.3.0
coverage==5.0.3
Django==3.0.3
django-cors-headers==3.2.1
graphene==2.1.8
graphene-django==2.9.1
graphql-core==2.3.1
graphql-relay==2.0.1
more-itertools==8.2.0
packaging==20.1
pluggy==0.13.1
promise==2.3
py==1.8.1
PyJWT==1.7.1
pyparsing==2.4.6
pytest==5.3.5
pytest-cov==2.8.1
pytz==2019.3
Rx==1.6.1
singledispatch==3.4.0.3
six==1.14.0
sqlparse==0.3.0
wcwidth==0.1.8
</span></code></pre></div></div>

<p>직접 설치를 하게 된다면 아래와 같은 명령어로 설치를 진행하면 된다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">pip install graphene-django
</span></code></pre></div></div>

<p>이제 도커 이미지를 생성할 차례이다. graphql-django라는 이름으로 생성하기로 하였다. 안드로이드를 자바로 짜기 때문에 Spring에 붙히면 어떨까라는 고민을 잠깐 했었지만 이번 프로젝트의 몸통은 안드로이드 개발에 두고 있기 때문에 전에 개발에 사용했던 Django를 사용하기로 했다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">Wizley:~/git/aintstagram/backend_api #</span><span class="w"> </span>docker build <span class="nt">--tag</span> graphql-django:1.0 <span class="nb">.</span>
</code></pre></div></div>

<p>명령어를 통해 확인을 해보니 잘 설치 된 것을 확인 가능하다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">Wizley:~/git/aintstagram/backend_api #</span><span class="w"> </span>docker images
<span class="go">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
graphql-django      1.0                 a5fe92f02b0f        6 seconds ago       984MB
django              1.0                 0472bb664767        6 weeks ago         981MB
ubuntu              latest              72300a873c2c        7 weeks ago         64.2MB
phpmysqli           1.0                 b5cd17f37d99        7 weeks ago         83.9MB
python              3                   efdecc2e377a        2 months ago        933MB
nginx               1.17                2073e0bcb60e        2 months ago        127MB
mysql               8.0.19              791b6e40940c        2 months ago        465MB
</span></code></pre></div></div>

<p>이제 컴포즈를 올려서 실행을 시켜보도록 하겠다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Wizley:~/git/aintstagram/backend_api # cat docker-compose.yml
version: '3'

services:
 graphql:
  container_name: aintstagram
  image: graphql-django:1.0
  environment:
    - DJANGO_DEBUG=true
  volumes:
    - ./code:/code
  ports:
    - "8000:8000"
  tty: true
  command: python3 ./backend_aintstagram/manage.py runserver 0:8000
</code></pre></div></div>

<p>정상적으로 잘 올라간다. Settings.py에서 SECRET_KEY만 슬쩍 빼주면 아주 기본적인 세팅은 끝이 난 것 같다.</p>

<p>이제 graphql이 제대로 작동하는지 테스트를 위해 아래와 같이 좋은 링크 두개를 찾을 수 있었다.</p>

<p><a href="https://medium.com/@zoejoyuliao/django-graphql-react-1-integrate-graphql-into-your-django-project-ff51237bb5d9">Integrate GraphQL into your Django project</a></p>

<p><a href="https://jonnung.dev/graphql/2019/08/05/python-graphql-graphene-tutorial/">Python으로 GraphQL 서버 구현</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">...</span>
    <span class="s">'graphene_django'</span><span class="p">,</span>
    <span class="s">'api'</span><span class="p">,</span>
<span class="p">]</span>
</code></pre></div></div>

<p>api라는 app을 하나 생성하고 INSTALLED_APPS에 추가해주었따. 그 후 메인의 url을 통해 graphql에 접근할 수 있도록 링크를 하나 설정해주었다. 
(이 경우에 csrf_exempt를 설정해주지 않으면 지금 상황에서는 400에러가 뜨게 된다.)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">django.views.decorators.csrf</span> <span class="kn">import</span> <span class="n">csrf_exempt</span>
<span class="kn">from</span> <span class="nn">graphene_django.views</span> <span class="kn">import</span> <span class="n">GraphQLView</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s">'admin/'</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s">'graphql/'</span><span class="p">,</span> <span class="n">csrf_exempt</span><span class="p">(</span><span class="n">GraphQLView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">graphiql</span><span class="o">=</span><span class="bp">True</span><span class="p">))),</span>
<span class="p">]</span>
</code></pre></div></div>

<p>그 후 test에 사용할 UserModel을 api/models.py에 생성한다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>


<span class="k">class</span> <span class="nc">UserModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</code></pre></div></div>

<p>그리고 통신을 위해 사용할 부분을 api/schema.py에 추가해준다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">graphene</span>
<span class="kn">from</span> <span class="nn">graphene_django</span> <span class="kn">import</span> <span class="n">DjangoObjectType</span>

<span class="kn">from</span> <span class="nn">api.models</span> <span class="kn">import</span> <span class="n">UserModel</span>


<span class="k">class</span> <span class="nc">UserType</span><span class="p">(</span><span class="n">DjangoObjectType</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">UserModel</span>


<span class="k">class</span> <span class="nc">Query</span><span class="p">(</span><span class="n">graphene</span><span class="o">.</span><span class="n">ObjectType</span><span class="p">):</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">UserType</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">resolve_users</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">UserModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>


<span class="n">schema</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">Schema</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">Query</span><span class="p">)</span>
</code></pre></div></div>

<p>마지막으로 schema를 settings.py에 추가해주면 된다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Graphql
</span>
<span class="n">GRAPHENE</span> <span class="o">=</span><span class="p">{</span>
    <span class="s">'SCHEMA'</span><span class="p">:</span> <span class="s">'api.schema.schema'</span>
<span class="p">}</span>
</code></pre></div></div>

<p>이제 localhost:8000/graphql/ 링크로 접속하면 아래와 같은 페이지를 확인할 수 있다.</p>

<p><img src="https://raw.githubusercontent.com/wizleysw/wizleysw.github.io/master/_posts/img/aintstagram/graphql_init.png" alt="graphql_init" /></p>

<p>이렇게 graphql을 사용하기 위한 환경구성을 마무리하였다!</p>

<h3 id="layout-만들기">Layout 만들기</h3>

<p>안드로이드의 구조에서 res 내부의 Layout은 Django의 template과 같은 기능을 한다. xml로 설계된 button, text 등에 대한 요소들을 java 파일에서 가져와 사용하는 방식으로 구현된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="nc">AppCompatActivity</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nc">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>기본 코드의 MainActivity를 보면 onCreate 부분에서 ContentView로 layout을 가져와서 뿌려준다. 이를 통해 activity_main.xml 파일의 내용이 해석되 렌더링 된다.</p>

<p>layout을 만들기 위해 인스타그램 어플이 가지고 있는 여러 페이지들에 대한 디자인을 따오는 작업이 필요하다. 즉 화면 정의서를 만들어야 되는데 이는 화면의 구조와 표시될 내용 및 기능에 대한 설명을 적어놓은 와이어 프레임을 작성해야 된다. 역시나 아주 좋은 프로그램이 존재했다. 바로 카카오에서 만든 Oven이다.</p>

<p><a href="https://ovenapp.io/">Oven</a></p>

<p>웹에서 간단하게 와이어 프레임을 작성가능하다. 이제 해야될 일은 레이아웃을 따보는 것이다. 클론 프로젝트의 장점은 잘 만들어진 어플을 디자인 구현에 대한 적은 고민으로 구현해볼 수 있다는 점이다. 아마 혼자 디자인을 한다면 올해안에 끝을 내지 못할수도 있을 것 같다.</p>

<p><a href="https://ovenapp.io/project/wBMk8RazGBK2TMSnzpL0Ah5MpadQfXWU#1wazS">인스타 메인 페이지 와이어 프레임</a></p>

<p>대충 모양에 대해서 흉내를 내보았다. 이런 식으로 골격과 사이즈를 재서 디자인을 진행하는 것 같다.</p>

<h2 id="본격-기능-구현-시작">본격 기능 구현 시작</h2>

<p>이제 하나씩 시작을 해보도록 하자. 프로그램의 전체적인 흐름을 대략적으로 살펴보았다. 테스트를 위해서는 백엔드쪽 DB에 대한 설계가 좀 필요할 것 같긴한데 프로그램이 시작되면서 흐르는 루틴에 따라 개발을 해보기로 하였다.</p>

<h3 id="introactivity">IntroActivity</h3>

<p>많은 어플리케이션이 실행이 되면 로고를 화면의 중간에 몇초간 띄웠다가 MainActivity를 띄우게 된다. 이를 위한 작업을 IntroActivity로 보통 명명한다.</p>

<p><a href="https://boheeee.tistory.com/4">안드로이드 intro 화면 만들기</a></p>

<p>위의 사이트에 IntroActivity를 구현한 내용이 있다. 위의 저자의 경우 LinearLayout을 사용하여 구현하였는데 나의 경우 ConstraintLayout을 사용하여 구현하였다.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;androidx.constraintlayout.widget.ConstraintLayout</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">xmlns:app=</span><span class="s">"http://schemas.android.com/apk/res-auto"</span>
    <span class="na">xmlns:tools=</span><span class="s">"http://schemas.android.com/tools"</span>
    <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
    <span class="na">android:layout_height=</span><span class="s">"match_parent"</span>
    <span class="na">android:background=</span><span class="s">"#000000"</span>
    <span class="na">tools:context=</span><span class="s">".IntroActivity"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;androidx.constraintlayout.widget.Guideline</span>
        <span class="na">android:id=</span><span class="s">"@+id/guideline_top"</span>
        <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">android:orientation=</span><span class="s">"horizontal"</span>
        <span class="na">app:layout_constraintTop_toTopOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintBottom_toTopOf=</span><span class="s">"@id/logo"</span>
        <span class="na">app:layout_constraintGuide_begin=</span><span class="s">"100dp"</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;androidx.constraintlayout.widget.Guideline</span>
        <span class="na">android:id=</span><span class="s">"@+id/guideline_bottom"</span>
        <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">android:orientation=</span><span class="s">"horizontal"</span>
        <span class="na">app:layout_constraintTop_toBottomOf=</span><span class="s">"@id/logo"</span>
        <span class="na">app:layout_constraintBottom_toBottomOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintGuide_end=</span><span class="s">"100dp"</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;androidx.constraintlayout.widget.Guideline</span>
        <span class="na">android:id=</span><span class="s">"@+id/guideline_left"</span>
        <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">android:orientation=</span><span class="s">"vertical"</span>
        <span class="na">app:layout_constraintTop_toBottomOf=</span><span class="s">"@id/guideline_top"</span>
        <span class="na">app:layout_constraintBottom_toTopOf=</span><span class="s">"@id/guideline_bottom"</span>
        <span class="na">app:layout_constraintLeft_toLeftOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintRight_toLeftOf=</span><span class="s">"@id/logo"</span>
        <span class="na">app:layout_constraintGuide_begin=</span><span class="s">"30dp"</span><span class="nt">/&gt;</span>


    <span class="nt">&lt;androidx.constraintlayout.widget.Guideline</span>
        <span class="na">android:id=</span><span class="s">"@+id/guideline_right"</span>
        <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">android:orientation=</span><span class="s">"vertical"</span>
        <span class="na">app:layout_constraintTop_toBottomOf=</span><span class="s">"@id/guideline_top"</span>
        <span class="na">app:layout_constraintBottom_toTopOf=</span><span class="s">"@id/guideline_bottom"</span>
        <span class="na">app:layout_constraintRight_toRightOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintLeft_toRightOf=</span><span class="s">"@id/logo"</span>
        <span class="na">app:layout_constraintGuide_end=</span><span class="s">"30dp"</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;ImageView</span>
        <span class="na">android:id=</span><span class="s">"@+id/logo"</span>
        <span class="na">android:layout_width=</span><span class="s">"200dp"</span>
        <span class="na">android:layout_height=</span><span class="s">"200dp"</span>
        <span class="na">android:src=</span><span class="s">"@drawable/aintstagram"</span>
        <span class="na">app:layout_constraintBottom_toTopOf=</span><span class="s">"@id/guideline_bottom"</span>
        <span class="na">app:layout_constraintTop_toBottomOf=</span><span class="s">"@id/guideline_top"</span>
        <span class="na">app:layout_constraintLeft_toRightOf=</span><span class="s">"@id/guideline_left"</span>
        <span class="na">app:layout_constraintRight_toLeftOf=</span><span class="s">"@id/guideline_right"</span><span class="nt">/&gt;</span>


<span class="nt">&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</span>
</code></pre></div></div>

<p>Guideline을 활용하여 레이아웃을 짜보았는데 위, 아래, 왼쪽, 오른쪽에 해당하는 가이드라인을 통해 중간부분에 위치하도록 하였다. 그리고 비율에 따라 같은 위치에 존재하도록 dp로 width와 height를 주었다.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;activity</span> <span class="na">android:name=</span><span class="s">".IntroActivity"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;intent-filter&gt;</span>
        <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"android.intent.action.MAIN"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">"android.intent.category.LAUNCHER"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/intent-filter&gt;</span>
<span class="nt">&lt;/activity&gt;</span>
<span class="nt">&lt;activity</span> <span class="na">android:name=</span><span class="s">".MainActivity"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/activity&gt;</span>
</code></pre></div></div>

<p>manifest 부분에서 MainActivity가 가지고 있던 intent filter를 IntroActivity로 옮겨주었고 나머지 내용은 블로그와 동일하게 작성하였다. 이를 통해 어플이 실행되면 IntroActivity가 호출이 되고 쓰레드가 호출되어 handler의 결과에 따라 MainActivity로 이동하도록 하였다.</p>

<p>아, 참! 어플의 이름은 aintstagram인데 aint + instagram의 합성어이다. 말 그대로 가짜 인스타그램이라는 의미를 지니고 있다. 그래서 로고는 살짝 모양을 변형하여 대충 쓱 그려보았다. 이를 통해 실행되는 IntroActivity의 모습은 다음과 같다.</p>

<p><img src="https://raw.githubusercontent.com/wizleysw/wizleysw.github.io/master/_posts/img/aintstagram/introactivity.png" alt="introactivity" /></p>

<h3 id="런처-아이콘-변경">런처 아이콘 변경</h3>

<p>기본 어플리케이션의 아이콘이 설정되어 있지 않은 상태이기 때문에 이를 설정하기 위해 아래의 블로그를 참고하였다.</p>

<p><a href="https://webnautes.tistory.com/1306">Android 런처 아이콘 변경하기</a></p>

<p>Image Asset을 추가한 뒤 manifest를 수정해주면 된다.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;application</span>
    <span class="na">android:allowBackup=</span><span class="s">"true"</span>
    <span class="na">android:icon=</span><span class="s">"@mipmap/ic_launcher_aintstagram"</span>
    <span class="na">android:label=</span><span class="s">"@string/app_name"</span>
    <span class="na">android:roundIcon=</span><span class="s">"@mipmap/ic_launcher_aintstagram_round"</span>
    <span class="na">android:supportsRtl=</span><span class="s">"true"</span>
    <span class="na">android:theme=</span><span class="s">"@style/AppTheme"</span><span class="nt">&gt;</span>
</code></pre></div></div>

<p>xml파일이 ic_launcher_aintstagram이기 때문에 icon과 roundIcon을 다음과 같이 변경해주면 아래와 같이 변경되는 것을 확인할 수 있다.</p>

<p><img src="https://raw.githubusercontent.com/wizleysw/wizleysw.github.io/master/_posts/img/aintstagram/icon.png" alt="icon" /></p>

<h3 id="액션바-숨기기">액션바 숨기기</h3>

<p>Empty Activity를 생성해도 윗 부분에 액션바가 존재한다. 실제 어플에서는 해당 부분이 존재하지 않기 때문에 이를 지워주고 싶었다. 방법은 간단했다. manifest에서 theme을 다음과 같이 변경해주면 된다.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>android:theme="@style/Theme.AppCompat.Light.NoActionBar"&gt;
</code></pre></div></div>

<h3 id="카메라-인텐트-구현하기">카메라 인텐트 구현하기</h3>

<p>메인 엑티비티로 칭하는 페이지는 인스타그램의 로딩이 완료되면 나오는 창이다. 레이아웃을 짜야했는데 어떤 식으로 짜야될지에 대해서 정말 많은 고민을 하였다. 일단은 직관적인 방식으로 진행하기로 하였고 constraint layout을 활용하여 버튼에 대한 뷰를 만들었다. 그리고 대충 그린 이미지로 ImageButton을 채워서 뷰를 이렇게 구성해주었다.</p>

<p><img src="https://raw.githubusercontent.com/wizleysw/wizleysw.github.io/master/_posts/img/aintstagram/main_1.png" alt="main_1" /></p>

<p>이제 버튼이 동작을 하도록 구현할 것인데 Intent를 활용하여 좌측 상단의 카메라 버튼을 클릭하면 카메라 창이 뜨도록 할 것이다. 이를 위해서는 여러가지 설정이 필요하다. 일단 만든 레이아웃은 다음과 같다.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;androidx.constraintlayout.widget.ConstraintLayout</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">xmlns:app=</span><span class="s">"http://schemas.android.com/apk/res-auto"</span>
    <span class="na">xmlns:tools=</span><span class="s">"http://schemas.android.com/tools"</span>
    <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
    <span class="na">android:layout_height=</span><span class="s">"match_parent"</span>
    <span class="na">tools:context=</span><span class="s">".MainActivity"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;androidx.constraintlayout.widget.Guideline</span>
        <span class="na">android:id=</span><span class="s">"@+id/guideline_top_menu"</span>
        <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">android:orientation=</span><span class="s">"horizontal"</span>
        <span class="na">app:layout_constraintTop_toTopOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintLeft_toLeftOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintRight_toRightOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintGuide_begin=</span><span class="s">"60dp"</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;androidx.constraintlayout.widget.Guideline</span>
        <span class="na">android:id=</span><span class="s">"@+id/guideline_bottom_menu"</span>
        <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">android:orientation=</span><span class="s">"horizontal"</span>
        <span class="na">app:layout_constraintBottom_toBottomOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintLeft_toLeftOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintRight_toRightOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintGuide_end=</span><span class="s">"60dp"</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;ImageButton</span>
        <span class="na">android:id=</span><span class="s">"@+id/button_to_camera"</span>
        <span class="na">android:layout_width=</span><span class="s">"0dp"</span>
        <span class="na">android:layout_height=</span><span class="s">"0dp"</span>
        <span class="na">app:layout_constraintVertical_weight=</span><span class="s">"1"</span>
        <span class="na">app:layout_constraintHorizontal_weight=</span><span class="s">"1"</span>
        <span class="na">app:layout_constraintTop_toTopOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintBottom_toTopOf=</span><span class="s">"@id/guideline_top_menu"</span>
        <span class="na">app:layout_constraintLeft_toLeftOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintRight_toLeftOf=</span><span class="s">"@id/button_logo"</span>
        <span class="na">android:src=</span><span class="s">"@drawable/camera"</span>
        <span class="na">android:scaleType=</span><span class="s">"fitCenter"</span>
        <span class="na">android:background=</span><span class="s">"@android:color/background_dark"</span>
        <span class="na">tools:ignore=</span><span class="s">"MissingConstraints"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;Button</span>
        <span class="na">android:id=</span><span class="s">"@+id/button_logo"</span>
        <span class="na">android:layout_width=</span><span class="s">"0dp"</span>
        <span class="na">android:layout_height=</span><span class="s">"0dp"</span>
        <span class="na">app:layout_constraintVertical_weight=</span><span class="s">"3"</span>
        <span class="na">app:layout_constraintHorizontal_weight=</span><span class="s">"3"</span>
        <span class="na">app:layout_constraintTop_toTopOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintBottom_toTopOf=</span><span class="s">"@id/guideline_top_menu"</span>
        <span class="na">app:layout_constraintLeft_toRightOf=</span><span class="s">"@id/button_to_camera"</span>
        <span class="na">app:layout_constraintRight_toLeftOf=</span><span class="s">"@id/button_to_chat"</span>
        <span class="na">android:text=</span><span class="s">"Aintstagram"</span>
        <span class="na">android:textColor=</span><span class="s">"@android:color/white"</span>
        <span class="na">android:textStyle=</span><span class="s">"italic"</span>
        <span class="na">android:background=</span><span class="s">"@android:color/background_dark"</span>
        <span class="na">tools:ignore=</span><span class="s">"MissingConstraints"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;ImageButton</span>
        <span class="na">android:id=</span><span class="s">"@+id/button_to_chat"</span>
        <span class="na">android:layout_width=</span><span class="s">"0dp"</span>
        <span class="na">android:layout_height=</span><span class="s">"0dp"</span>
        <span class="na">app:layout_constraintVertical_weight=</span><span class="s">"1"</span>
        <span class="na">app:layout_constraintHorizontal_weight=</span><span class="s">"1"</span>
        <span class="na">app:layout_constraintTop_toTopOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintBottom_toTopOf=</span><span class="s">"@id/guideline_top_menu"</span>
        <span class="na">app:layout_constraintLeft_toRightOf=</span><span class="s">"@id/button_logo"</span>
        <span class="na">app:layout_constraintRight_toRightOf=</span><span class="s">"parent"</span>
        <span class="na">android:src=</span><span class="s">"@drawable/sms"</span>
        <span class="na">android:scaleType=</span><span class="s">"fitCenter"</span>
        <span class="na">android:background=</span><span class="s">"@android:color/background_dark"</span>
        <span class="na">tools:ignore=</span><span class="s">"MissingConstraints"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;androidx.recyclerview.widget.RecyclerView</span>
        <span class="na">android:id=</span><span class="s">"@+id/story"</span>
        <span class="na">android:layout_height=</span><span class="s">"100dp"</span>
        <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
        <span class="na">app:layout_constraintTop_toTopOf=</span><span class="s">"@id/guideline_top_menu"</span>
        <span class="na">app:layout_constraintBottom_toTopOf=</span><span class="s">"@id/scroll"</span>
        <span class="na">app:layout_constraintLeft_toLeftOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintRight_toRightOf=</span><span class="s">"parent"</span>
        <span class="na">android:scrollbars=</span><span class="s">"horizontal"</span>
        <span class="na">tools:ignore=</span><span class="s">"MissingConstraints"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;ImageButton</span>
        <span class="na">android:id=</span><span class="s">"@+id/button_to_home"</span>
        <span class="na">android:layout_width=</span><span class="s">"0dp"</span>
        <span class="na">android:layout_height=</span><span class="s">"0dp"</span>
        <span class="na">app:layout_constraintVertical_weight=</span><span class="s">"1"</span>
        <span class="na">app:layout_constraintHorizontal_weight=</span><span class="s">"1"</span>
        <span class="na">app:layout_constraintTop_toBottomOf=</span><span class="s">"@id/guideline_bottom_menu"</span>
        <span class="na">app:layout_constraintBottom_toBottomOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintLeft_toLeftOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintRight_toLeftOf=</span><span class="s">"@id/button_to_search"</span>
        <span class="na">android:src=</span><span class="s">"@drawable/home"</span>
        <span class="na">android:scaleType=</span><span class="s">"fitCenter"</span>
        <span class="na">android:background=</span><span class="s">"@android:color/background_dark"</span>
        <span class="na">tools:ignore=</span><span class="s">"MissingConstraints"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;ImageButton</span>
        <span class="na">android:id=</span><span class="s">"@+id/button_to_search"</span>
        <span class="na">android:layout_width=</span><span class="s">"0dp"</span>
        <span class="na">android:layout_height=</span><span class="s">"0dp"</span>
        <span class="na">app:layout_constraintVertical_weight=</span><span class="s">"1"</span>
        <span class="na">app:layout_constraintHorizontal_weight=</span><span class="s">"1"</span>
        <span class="na">app:layout_constraintTop_toBottomOf=</span><span class="s">"@id/guideline_bottom_menu"</span>
        <span class="na">app:layout_constraintBottom_toBottomOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintLeft_toRightOf=</span><span class="s">"@id/button_to_home"</span>
        <span class="na">app:layout_constraintRight_toLeftOf=</span><span class="s">"@id/button_to_add"</span>
        <span class="na">android:src=</span><span class="s">"@drawable/search"</span>
        <span class="na">android:scaleType=</span><span class="s">"fitCenter"</span>
        <span class="na">android:background=</span><span class="s">"@android:color/background_dark"</span>
        <span class="na">tools:ignore=</span><span class="s">"MissingConstraints"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;ImageButton</span>
        <span class="na">android:id=</span><span class="s">"@+id/button_to_add"</span>
        <span class="na">android:layout_width=</span><span class="s">"0dp"</span>
        <span class="na">android:layout_height=</span><span class="s">"0dp"</span>
        <span class="na">app:layout_constraintVertical_weight=</span><span class="s">"1"</span>
        <span class="na">app:layout_constraintHorizontal_weight=</span><span class="s">"1"</span>
        <span class="na">app:layout_constraintTop_toBottomOf=</span><span class="s">"@id/guideline_bottom_menu"</span>
        <span class="na">app:layout_constraintBottom_toBottomOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintLeft_toRightOf=</span><span class="s">"@id/button_to_search"</span>
        <span class="na">app:layout_constraintRight_toLeftOf=</span><span class="s">"@id/button_to_history"</span>
        <span class="na">android:src=</span><span class="s">"@drawable/add"</span>
        <span class="na">android:scaleType=</span><span class="s">"fitCenter"</span>
        <span class="na">android:background=</span><span class="s">"@android:color/background_dark"</span>
        <span class="na">tools:ignore=</span><span class="s">"MissingConstraints"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;ImageButton</span>
        <span class="na">android:id=</span><span class="s">"@+id/button_to_history"</span>
        <span class="na">android:layout_width=</span><span class="s">"0dp"</span>
        <span class="na">android:layout_height=</span><span class="s">"0dp"</span>
        <span class="na">app:layout_constraintVertical_weight=</span><span class="s">"1"</span>
        <span class="na">app:layout_constraintHorizontal_weight=</span><span class="s">"1"</span>
        <span class="na">app:layout_constraintTop_toBottomOf=</span><span class="s">"@id/guideline_bottom_menu"</span>
        <span class="na">app:layout_constraintBottom_toBottomOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintLeft_toRightOf=</span><span class="s">"@id/button_to_add"</span>
        <span class="na">app:layout_constraintRight_toLeftOf=</span><span class="s">"@id/button_to_info"</span>
        <span class="na">android:src=</span><span class="s">"@drawable/heart"</span>
        <span class="na">android:scaleType=</span><span class="s">"fitCenter"</span>
        <span class="na">android:background=</span><span class="s">"@android:color/background_dark"</span>
        <span class="na">tools:ignore=</span><span class="s">"MissingConstraints"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;ImageButton</span>
        <span class="na">android:id=</span><span class="s">"@+id/button_to_info"</span>
        <span class="na">android:layout_width=</span><span class="s">"0dp"</span>
        <span class="na">android:layout_height=</span><span class="s">"0dp"</span>
        <span class="na">app:layout_constraintVertical_weight=</span><span class="s">"1"</span>
        <span class="na">app:layout_constraintHorizontal_weight=</span><span class="s">"1"</span>
        <span class="na">app:layout_constraintTop_toBottomOf=</span><span class="s">"@id/guideline_bottom_menu"</span>
        <span class="na">app:layout_constraintBottom_toBottomOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintLeft_toRightOf=</span><span class="s">"@id/button_to_history"</span>
        <span class="na">app:layout_constraintRight_toRightOf=</span><span class="s">"parent"</span>
        <span class="na">android:src=</span><span class="s">"@drawable/userinfo"</span>
        <span class="na">android:scaleType=</span><span class="s">"fitCenter"</span>
        <span class="na">android:background=</span><span class="s">"@android:color/background_dark"</span>
        <span class="na">tools:ignore=</span><span class="s">"MissingConstraints"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;androidx.recyclerview.widget.RecyclerView</span>
        <span class="na">android:id=</span><span class="s">"@+id/scroll"</span>
        <span class="na">android:layout_width=</span><span class="s">"0dp"</span>
        <span class="na">android:layout_height=</span><span class="s">"0dp"</span>
        <span class="na">app:layout_constraintTop_toBottomOf=</span><span class="s">"@id/story"</span>
        <span class="na">app:layout_constraintBottom_toBottomOf=</span><span class="s">"@id/guideline_bottom_menu"</span>
        <span class="na">app:layout_constraintRight_toRightOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintLeft_toLeftOf=</span><span class="s">"parent"</span>
        <span class="na">android:scrollbars=</span><span class="s">"vertical"</span><span class="nt">/&gt;</span>

<span class="nt">&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</span>
</code></pre></div></div>

<p>아직 수정의 필요성이 보이긴 하지만 ImageButton과 RecyclerView를 활용하여 constraint Layout을 짜보았다. 카메라 기능을 활용하기 위해서는 Manifest에 아래의 조건을 추가해주어야 된다.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.CAMERA"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;uses-feature</span> <span class="na">android:name=</span><span class="s">"android.hardware.camera"</span> <span class="na">android:required=</span><span class="s">"true"</span> <span class="nt">/&gt;</span>
</code></pre></div></div>

<p>이제 MainActivity에서 버튼에 대한 부분을 처리해주어야 되는데 OnCreate부분에 이를 작성할 것이다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="nc">AppCompatActivity</span><span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">REQUEST_IMAGE_CAPTRUE</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">ImageButton</span> <span class="n">btn_camera</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nc">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>

        <span class="k">this</span><span class="o">.</span><span class="na">setBtn</span><span class="o">();</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setBtn</span><span class="o">(){</span>
        <span class="n">btn_camera</span> <span class="o">=</span> <span class="o">(</span><span class="nc">ImageButton</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button_to_camera</span><span class="o">);</span>

        <span class="nc">View</span><span class="o">.</span><span class="na">OnClickListener</span> <span class="nc">Listener</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">(){</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="nc">View</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">switch</span> <span class="o">(</span><span class="n">v</span><span class="o">.</span><span class="na">getId</span><span class="o">())</span> <span class="o">{</span>
                    <span class="k">case</span> <span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button_to_camera</span><span class="o">:</span>
                        <span class="kt">int</span> <span class="n">permissionCheck</span> <span class="o">=</span> <span class="nc">ContextCompat</span><span class="o">.</span><span class="na">checkSelfPermission</span><span class="o">(</span><span class="nc">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="nc">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">CAMERA</span><span class="o">);</span>
                        <span class="k">if</span><span class="o">(</span><span class="n">permissionCheck</span> <span class="o">==</span> <span class="nc">PackageManager</span><span class="o">.</span><span class="na">PERMISSION_DENIED</span><span class="o">){</span>
                            <span class="nc">ActivityCompat</span><span class="o">.</span><span class="na">requestPermissions</span><span class="o">(</span><span class="nc">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="k">new</span> <span class="nc">String</span><span class="o">[]{</span><span class="nc">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">CAMERA</span><span class="o">},</span><span class="mi">0</span><span class="o">);</span>
                        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                            <span class="nc">Intent</span> <span class="n">takePictureIntent</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Intent</span><span class="o">(</span><span class="nc">MediaStore</span><span class="o">.</span><span class="na">ACTION_IMAGE_CAPTURE</span><span class="o">);</span>
                            <span class="k">if</span> <span class="o">(</span><span class="n">takePictureIntent</span><span class="o">.</span><span class="na">resolveActivity</span><span class="o">(</span><span class="n">getPackageManager</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                                <span class="n">startActivityForResult</span><span class="o">(</span><span class="n">takePictureIntent</span><span class="o">,</span> <span class="no">REQUEST_IMAGE_CAPTRUE</span><span class="o">);</span>
                            <span class="o">}</span>
                        <span class="o">}</span>
                        <span class="k">break</span><span class="o">;</span>
                    <span class="k">case</span> <span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button_to_home</span><span class="o">:</span>
                        <span class="k">break</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">};</span>

        <span class="n">btn_camera</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="nc">Listener</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>setBtn이라는 함수를 생성하였는데 이 함수는 버튼들에 대한 초기화를 진행할 것이다. 함수가 호출이 되면 btn_camera라는 ImageButton이 생성되는데 이 버튼에 OnClickListener를 달아줄 것이다. OnclickListener를 정의해줄 Listener라는 변수를 생성하는데 이 변수는 내부에서 onClick을 오버라이딩해서 해당 이벤트 발생시의 동작을 재정의해준다. getId를 통해 어떤 버튼이 클릭 되었는지를 판별한 뒤 해당 버튼에 따라 case문을 수행해주는 것이다. button_to_camera가 onClick되면 takePictureIntent를 실행시켜줄 것인데 해당 인텐트는 카메라 작업을 위한 사전정의된 인텐트이다. 하지만 안드로이드 특정 버전 이상부터는 해당 기능에 대한 퍼미션 검사를 해주지 않으면 Permission 관련 에러가 발생하다. 그래서 이를 체크하기 위해서 requestPermission을 위와같이 진행해주어야 된다. 이렇게 코드를 작성하면 처음 카메라 버튼이 클릭되면 권한에 대한 요청이 수행되고 그 후에는 카메라 기능이 정상적으로 작동하게 된다.</p>

<p>자 이번에는 받아서 처리하는 부분을 설계해야되는데 Intent에 대한 결과를 받아오는 onActivityResult을 오버라이딩 해서 구현해 주어야 된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onActivityResult</span><span class="o">(</span><span class="kt">int</span> <span class="n">requestCode</span><span class="o">,</span> <span class="kt">int</span> <span class="n">resultCode</span><span class="o">,</span> <span class="nc">Intent</span> <span class="n">data</span><span class="o">){</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onActivityResult</span><span class="o">(</span><span class="n">requestCode</span><span class="o">,</span> <span class="n">resultCode</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
    <span class="k">if</span><span class="o">(</span><span class="n">requestCode</span> <span class="o">==</span> <span class="no">REQUEST_IMAGE_CAPTRUE</span> <span class="o">&amp;&amp;</span> <span class="n">resultCode</span> <span class="o">==</span> <span class="no">RESULT_OK</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="o">.</span><span class="na">hasExtra</span><span class="o">(</span><span class="s">"data"</span><span class="o">))</span> <span class="o">{</span>
        <span class="nc">Bitmap</span> <span class="n">bitmap</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Bitmap</span><span class="o">)</span> <span class="n">data</span><span class="o">.</span><span class="na">getExtras</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">"data"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>여기서 엄청난 시간을 낭비하였는데 startActivityForResult로 넘겨주는 인터넷 상의 많은 코드들이 bitmap을 가져오는 getExtras()에서 null 문제가 발생하였다. 삽질한 결과 activity를 넘겨주기 전에 putExtra로 URI 정보를 넘겨줄 경우에 이런 문제가 발생하였다. 후.. 어쨌든 지금 결과를 받아오는 곳에서 bitmap으로 찍은 사진에 대한 정보를 가져오는 것 까지 확인할 수 있었다. 또 그 과정에서 adb를 통해서 qemu내부에 접속을 시도하였는데 root권한을 획득하는 것이 안되었다. 이것도 qemu 안드 에뮬레이터 중에서 Google Play와 연관된 이미지를 사용하면 안되는 것이었다. 이를 위해서 다른 버전의 에뮬레이터를 추가로 설치하고서야 adb로 접속하여 내부 구조를 확인할 수 있었다. adb의 경우 android-studio의 sdk가 설치된 파일로 가서 platform-tools 폴더 내부에 설치되어있어서 따로 설치를 할 필요가 없다.</p>

<h3 id="갤러리-인텐트-구현하기">갤러리 인텐트 구현하기</h3>

<p>카메라와 비슷한 방식으로 구현이 가능하다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">View</span><span class="o">.</span><span class="na">OnClickListener</span> <span class="nc">Listener</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="nc">View</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">permissionCheck</span><span class="o">;</span>
        <span class="k">switch</span> <span class="o">(</span><span class="n">v</span><span class="o">.</span><span class="na">getId</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">case</span> <span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button_to_camera</span><span class="o">:</span>
                <span class="n">permissionCheck</span> <span class="o">=</span> <span class="nc">ContextCompat</span><span class="o">.</span><span class="na">checkSelfPermission</span><span class="o">(</span><span class="nc">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="nc">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">CAMERA</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">permissionCheck</span> <span class="o">==</span> <span class="nc">PackageManager</span><span class="o">.</span><span class="na">PERMISSION_DENIED</span><span class="o">)</span> <span class="o">{</span>
                    <span class="nc">ActivityCompat</span><span class="o">.</span><span class="na">requestPermissions</span><span class="o">(</span><span class="nc">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="no">PERMISSIONS</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    <span class="nc">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Intent</span><span class="o">(</span><span class="nc">MediaStore</span><span class="o">.</span><span class="na">ACTION_IMAGE_CAPTURE</span><span class="o">);</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">intent</span><span class="o">.</span><span class="na">resolveActivity</span><span class="o">(</span><span class="n">getPackageManager</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">startActivityForResult</span><span class="o">(</span><span class="n">intent</span><span class="o">,</span> <span class="no">REQUEST_IMAGE_CAPTRUE</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">}</span>
                <span class="k">break</span><span class="o">;</span>

            <span class="k">case</span> <span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button_to_add</span><span class="o">:</span>
                <span class="n">permissionCheck</span> <span class="o">=</span> <span class="nc">ContextCompat</span><span class="o">.</span><span class="na">checkSelfPermission</span><span class="o">(</span><span class="nc">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="nc">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">READ_EXTERNAL_STORAGE</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">permissionCheck</span> <span class="o">==</span> <span class="nc">PackageManager</span><span class="o">.</span><span class="na">PERMISSION_DENIED</span><span class="o">)</span> <span class="o">{</span>
                    <span class="nc">ActivityCompat</span><span class="o">.</span><span class="na">requestPermissions</span><span class="o">(</span><span class="nc">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="no">PERMISSIONS</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    <span class="nc">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Intent</span><span class="o">();</span>
                    <span class="n">intent</span><span class="o">.</span><span class="na">setAction</span><span class="o">(</span><span class="nc">Intent</span><span class="o">.</span><span class="na">ACTION_GET_CONTENT</span><span class="o">);</span>
                    <span class="n">intent</span><span class="o">.</span><span class="na">setData</span><span class="o">(</span><span class="nc">MediaStore</span><span class="o">.</span><span class="na">Images</span><span class="o">.</span><span class="na">Media</span><span class="o">.</span><span class="na">EXTERNAL_CONTENT_URI</span><span class="o">);</span>
                    <span class="n">intent</span><span class="o">.</span><span class="na">setType</span><span class="o">(</span><span class="s">"image/*"</span><span class="o">);</span>
                    <span class="n">startActivityForResult</span><span class="o">(</span><span class="n">intent</span><span class="o">,</span> <span class="no">REQUEST_TAKE_ALBUM</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">};</span>

</code></pre></div></div>

<p>마찬가지로 정보를 가져오는 것이기 때문에 그에 상응하는 권한을 Manifest에 정의를 해주어야 되며 User로 부터 동의를 구해야 된다.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.WRITE_EXTERNAL_STORAGE"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.READ_EXTERNAL_STORAGE"</span><span class="nt">/&gt;</span>
</code></pre></div></div>

<p>이렇게 해주면 갤러리로 부터 사진을 가져오는 것이 가능하다.</p>

<p><img src="https://raw.githubusercontent.com/wizleysw/wizleysw.github.io/master/_posts/img/aintstagram/gallery.png" alt="gallery" /></p>

<h3 id="카카오-로그인-구현">카카오 로그인 구현</h3>

<p><a href="https://re-build.tistory.com/9">카카오 계정으로 로그인하기</a></p>

<p>사실 가장 기본적인 로직상 IntroActivity가 실행되고 나서 login여부에 따라 MainActivity로 메인 페이지로 이동시킬지 LoginActivity로 로그인 관련 로직을 처리할지를 결정지어야 된다. 현재의 흐름은 IntroActivity가 LoginActivity가 아닌 MainActivity로 바로 이동하기 때문에 이 부분에 대한 구현이 진행되어야 한다.</p>

<p>이번에는 카카오 api를 사용해서 로그인을 구현해보기로 하였다. 카카오 로그인을 사용하면 좋은 점이 여러가지 정보들에 대한 처리를 나의 서버가 아닌 카카오쪽에 전담할 수 있다. 계정에 대한 유출에 대한 고민을 줄일 수 있고 관련 DB에 처리를 부담하지 않을 수 있기 때문에 익숙해진다면 개발의 속도를 늘릴 수 있다.</p>

<p>이제 API를 사용해볼건데 이를 위해서는 Android용 SDK를 설치하여야 한다. 카카오 디벨로퍼에서 해당 sdk를 다운받거나 Gradle에 추가하는 방향으로 진행할 수 있다. Gradle은 프로젝트의 빌드에 사용되며 Maven을 통해 써드파티 라이브러리를 추가할 수 있다.</p>

<p><a href="https://developers.kakao.com/docs/latest/ko/getting-started/sdk-android-v1">카카오 SDK 적용 공식문서</a></p>

<p>aintstagram/build/build.gradle 내부에 아래와 같이 라이브러리를 추가해준다.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">subprojects</span> <span class="p">{</span>
    <span class="nx">repositories</span> <span class="p">{</span>
        <span class="nx">google</span><span class="p">()</span>
        <span class="nx">jcenter</span><span class="p">()</span>
        <span class="nx">maven</span> <span class="p">{</span> <span class="nx">url</span> <span class="dl">'</span><span class="s1">https://devrepo.kakao.com/nexus/content/groups/public/</span><span class="dl">'</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>그리고 app 아래의 build gradle에 implementation을 추가해준다.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">dependencies</span> <span class="p">{</span>
    <span class="nx">implementation</span> <span class="nx">fileTree</span><span class="p">(</span><span class="nx">dir</span><span class="p">:</span> <span class="dl">'</span><span class="s1">libs</span><span class="dl">'</span><span class="p">,</span> <span class="nx">include</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">*.jar</span><span class="dl">'</span><span class="p">])</span>

    <span class="nx">implementation</span> <span class="dl">'</span><span class="s1">androidx.appcompat:appcompat:1.1.0</span><span class="dl">'</span>
    <span class="nx">implementation</span> <span class="dl">'</span><span class="s1">androidx.constraintlayout:constraintlayout:1.1.3</span><span class="dl">'</span>
    <span class="nx">implementation</span> <span class="dl">'</span><span class="s1">androidx.recyclerview:recyclerview:1.1.0</span><span class="dl">'</span>
    <span class="nx">testImplementation</span> <span class="dl">'</span><span class="s1">junit:junit:4.12</span><span class="dl">'</span>
    <span class="nx">androidTestImplementation</span> <span class="dl">'</span><span class="s1">androidx.test.ext:junit:1.1.1</span><span class="dl">'</span>
    <span class="nx">androidTestImplementation</span> <span class="dl">'</span><span class="s1">androidx.test.espresso:espresso-core:3.2.0</span><span class="dl">'</span>

    <span class="nx">implementation</span> <span class="nx">group</span><span class="p">:</span> <span class="dl">'</span><span class="s1">com.kakao.sdk</span><span class="dl">'</span><span class="p">,</span> <span class="nx">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">usermgmt</span><span class="dl">'</span><span class="p">,</span> <span class="nx">version</span><span class="p">:</span> <span class="dl">'</span><span class="s1">1.27.0</span><span class="dl">'</span>
    <span class="c1">// 카카오톡</span>
    <span class="nx">implementation</span> <span class="nx">group</span><span class="p">:</span> <span class="dl">'</span><span class="s1">com.kakao.sdk</span><span class="dl">'</span><span class="p">,</span> <span class="nx">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">kakaotalk</span><span class="dl">'</span><span class="p">,</span> <span class="nx">version</span><span class="p">:</span> <span class="dl">'</span><span class="s1">1.27.0</span><span class="dl">'</span>
    <span class="c1">// 카카오링크</span>
    <span class="nx">implementation</span> <span class="nx">group</span><span class="p">:</span> <span class="dl">'</span><span class="s1">com.kakao.sdk</span><span class="dl">'</span><span class="p">,</span> <span class="nx">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">kakaolink</span><span class="dl">'</span><span class="p">,</span> <span class="nx">version</span><span class="p">:</span> <span class="dl">'</span><span class="s1">1.27.0</span><span class="dl">'</span>
<span class="p">}</span>
</code></pre></div></div>

<p>이제 Manifest에서 API에 대한 네이티브 키를 등록해주면 된다.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;meta-data</span>
    <span class="na">android:name=</span><span class="s">"com.kakao.sdk.AppKey"</span>
    <span class="na">android:value=</span><span class="s">"{NATIVE_APP_KEY}"</span> <span class="nt">/&gt;</span>
</code></pre></div></div>

<p>해시에 대한 정보를 아래의 명령어를 입력하여 생성 후에 kakao.developer.com에 등록해준다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">Wizley:~/git/aintstagram #</span><span class="w"> </span>keytool <span class="nt">-exportcert</span> <span class="nt">-alias</span> androiddebugkey <span class="nt">-keystore</span> ~/.android/debug.keystore <span class="nt">-storepass</span> android <span class="nt">-keypass</span> android | openssl sha1 <span class="nt">-binary</span> | openssl <span class="nb">base64</span>
</code></pre></div></div>

<p>그리고 테스트를 위해서 빌드를 시키면 정상적으로 완료되는 것을 확인할 수 있다.</p>

<p><a href="https://developers.kakao.com/docs/latest/ko/kakaologin/common">카카오 로그인 가이드</a></p>

<p>카카오의 로그인 서비스는 REST api를 통해 구현되며 토큰을 주고 받는 방식으로 진행된다고 한다. 로직을 보면 사용자가 정보를 요청하면 토큰을 발급해서 넘겨주는 방식인 것 같다. LoginActivity를 위한 레이아웃을 설계하였다.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;androidx.constraintlayout.widget.ConstraintLayout</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
    <span class="na">android:layout_height=</span><span class="s">"match_parent"</span>
    <span class="na">xmlns:app=</span><span class="s">"http://schemas.android.com/apk/res-auto"</span>
    <span class="na">xmlns:tools=</span><span class="s">"http://schemas.android.com/tools"</span>
    <span class="na">android:background=</span><span class="s">"#000000"</span>
    <span class="na">tools:context=</span><span class="s">".LoginActivity"</span><span class="nt">&gt;</span>&gt;

    <span class="nt">&lt;androidx.constraintlayout.widget.Guideline</span>
        <span class="na">android:id=</span><span class="s">"@+id/guideline_top"</span>
        <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">android:orientation=</span><span class="s">"horizontal"</span>
        <span class="na">app:layout_constraintTop_toTopOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintBottom_toTopOf=</span><span class="s">"@id/logo"</span>
        <span class="na">app:layout_constraintGuide_begin=</span><span class="s">"100dp"</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;androidx.constraintlayout.widget.Guideline</span>
        <span class="na">android:id=</span><span class="s">"@+id/guideline_bottom"</span>
        <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">android:orientation=</span><span class="s">"horizontal"</span>
        <span class="na">app:layout_constraintTop_toBottomOf=</span><span class="s">"@id/logo"</span>
        <span class="na">app:layout_constraintBottom_toBottomOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintGuide_end=</span><span class="s">"100dp"</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;androidx.constraintlayout.widget.Guideline</span>
        <span class="na">android:id=</span><span class="s">"@+id/guideline_left"</span>
        <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">android:orientation=</span><span class="s">"vertical"</span>
        <span class="na">app:layout_constraintTop_toBottomOf=</span><span class="s">"@id/guideline_top"</span>
        <span class="na">app:layout_constraintBottom_toTopOf=</span><span class="s">"@id/guideline_bottom"</span>
        <span class="na">app:layout_constraintLeft_toLeftOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintRight_toLeftOf=</span><span class="s">"@id/logo"</span>
        <span class="na">app:layout_constraintGuide_begin=</span><span class="s">"30dp"</span><span class="nt">/&gt;</span>


    <span class="nt">&lt;androidx.constraintlayout.widget.Guideline</span>
        <span class="na">android:id=</span><span class="s">"@+id/guideline_right"</span>
        <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">android:orientation=</span><span class="s">"vertical"</span>
        <span class="na">app:layout_constraintTop_toBottomOf=</span><span class="s">"@id/guideline_top"</span>
        <span class="na">app:layout_constraintBottom_toTopOf=</span><span class="s">"@id/guideline_bottom"</span>
        <span class="na">app:layout_constraintRight_toRightOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintLeft_toRightOf=</span><span class="s">"@id/logo"</span>
        <span class="na">app:layout_constraintGuide_end=</span><span class="s">"30dp"</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;ImageView</span>
        <span class="na">android:id=</span><span class="s">"@+id/logo"</span>
        <span class="na">android:layout_width=</span><span class="s">"200dp"</span>
        <span class="na">android:layout_height=</span><span class="s">"200dp"</span>
        <span class="na">android:src=</span><span class="s">"@drawable/aintstagram"</span>
        <span class="na">app:layout_constraintBottom_toTopOf=</span><span class="s">"@id/guideline_bottom"</span>
        <span class="na">app:layout_constraintTop_toBottomOf=</span><span class="s">"@id/guideline_top"</span>
        <span class="na">app:layout_constraintLeft_toRightOf=</span><span class="s">"@id/guideline_left"</span>
        <span class="na">app:layout_constraintRight_toLeftOf=</span><span class="s">"@id/guideline_right"</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;com.kakao.usermgmt.LoginButton</span>
        <span class="na">android:id=</span><span class="s">"@+id/login_button"</span>
        <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_marginLeft=</span><span class="s">"20dp"</span>
        <span class="na">android:layout_marginRight=</span><span class="s">"20dp"</span>
        <span class="na">android:layout_marginBottom=</span><span class="s">"30dp"</span>
        <span class="na">app:layout_constraintLeft_toLeftOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintRight_toRightOf=</span><span class="s">"parent"</span>
        <span class="na">app:layout_constraintBottom_toBottomOf=</span><span class="s">"parent"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</span>
</code></pre></div></div>

<p>기존의 introActivity에 카카오에서 제공하는 LoginButton을 추가하였다.</p>

<p><img src="https://raw.githubusercontent.com/wizleysw/wizleysw.github.io/master/_posts/img/aintstagram/loginactivity.png" alt="login" /></p>

<p>이를 핸들링하기 위한 LoginActivity.java 파일은 아래와 같다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.ssg.aintstagram</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.app.Activity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.util.Log</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">androidx.annotation.Nullable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.kakao.auth.ISessionCallback</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.kakao.auth.Session</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.kakao.util.exception.KakaoException</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginActivity</span> <span class="kd">extends</span> <span class="nc">Activity</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">ISessionCallback</span> <span class="n">sessionCallback</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ISessionCallback</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onSessionOpened</span><span class="o">()</span> <span class="o">{</span>
            <span class="nc">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Intent</span><span class="o">(</span><span class="nc">LoginActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="nc">MainActivity</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
            <span class="n">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onSessionOpenFailed</span><span class="o">(</span><span class="nc">KakaoException</span> <span class="n">exception</span><span class="o">)</span> <span class="o">{</span>
            
        <span class="o">}</span>
    <span class="o">};</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="nc">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_login</span><span class="o">);</span>
        
        <span class="nc">Session</span><span class="o">.</span><span class="na">getCurrentSession</span><span class="o">().</span><span class="na">addCallback</span><span class="o">(</span><span class="n">sessionCallback</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>

        <span class="nc">Session</span><span class="o">.</span><span class="na">getCurrentSession</span><span class="o">().</span><span class="na">removeCallback</span><span class="o">(</span><span class="n">sessionCallback</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onActivityResult</span><span class="o">(</span><span class="kt">int</span> <span class="n">requestCode</span><span class="o">,</span> <span class="kt">int</span> <span class="n">resultCode</span><span class="o">,</span> <span class="nc">Intent</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onActivityResult</span><span class="o">(</span><span class="n">requestCode</span><span class="o">,</span> <span class="n">resultCode</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>

        <span class="k">if</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">getCurrentSession</span><span class="o">().</span><span class="na">handleActivityResult</span><span class="o">(</span><span class="n">requestCode</span><span class="o">,</span> <span class="n">resultCode</span><span class="o">,</span> <span class="n">data</span><span class="o">)){</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">super</span><span class="o">.</span><span class="na">onActivityResult</span><span class="o">(</span><span class="n">requestCode</span><span class="o">,</span> <span class="n">resultCode</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>해당 액티비티가 생성이 되면 activity_login으로 view가 생성이 되고 getCurrentSession()을 통해 세션에 대한 정보를 가져온다. 만약 존재하면 MainActivity를 호출하게 된다. 여기서 이를 처리하기 위한 sdk에 대한 코드를 생성해야 된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.ssg.aintstagram</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.app.Application</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Context</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.kakao.auth.IApplicationConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.kakao.auth.KakaoAdapter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.kakao.auth.KakaoSDK</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyKakaoAdapter</span> <span class="kd">extends</span> <span class="nc">Application</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">();</span>

        <span class="c1">// SDK 초기화</span>
        <span class="nc">KakaoSDK</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="k">new</span> <span class="nc">KakaoAdapter</span><span class="o">()</span> <span class="o">{</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="nc">IApplicationConfig</span> <span class="nf">getApplicationConfig</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">return</span> <span class="k">new</span> <span class="nf">IApplicationConfig</span><span class="o">()</span> <span class="o">{</span>
                    <span class="nd">@Override</span>
                    <span class="kd">public</span> <span class="nc">Context</span> <span class="nf">getApplicationContext</span><span class="o">()</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="nc">MyKakaoAdapter</span><span class="o">.</span><span class="na">this</span><span class="o">;</span>
                    <span class="o">}</span>
                <span class="o">};</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>MyKakaoAdapter라는 KakaoAdapter를 application으로 생성해주면 된다. 이를 위해선 Manifest에 추가해주어야 된다.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;application</span>
    <span class="na">android:name=</span><span class="s">".MyKakaoAdapter"</span>
</code></pre></div></div>

<p>이제 테스트를 해보면 아이디/패스워드로 요청을 보내고 사용자의 동의를 얻으면 MainActivity로 이동하는 것을 확인할 수 있다.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>generic_x86_arm:/data/data/com.ssg.aintstagram/shared_prefs # ls
3f5c6005c0954ba8a11e315b702a5442.xml  WebViewChromiumPrefs.xml
at 3f5c6005c0954ba8a11e315b702a5442.xml                                                                      
<span class="cp">&lt;?xml version='1.0' encoding='utf-8' standalone='yes' ?&gt;</span>
<span class="nt">&lt;map&gt;</span>
    <span class="nt">&lt;string</span> <span class="na">name=</span><span class="s">"com.kakao.token.RefreshToken.ExpiresAt"</span><span class="nt">&gt;</span>{<span class="ni">&amp;quot;</span>value<span class="ni">&amp;quot;</span>:1592044787261,<span class="ni">&amp;quot;</span>valueType<span class="ni">&amp;quot;</span>:<span class="ni">&amp;quot;</span>long<span class="ni">&amp;quot;</span>}<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;string</span> <span class="na">name=</span><span class="s">"com.kakao.token.AccessToken.ExpiresAt"</span><span class="nt">&gt;</span>{<span class="ni">&amp;quot;</span>value<span class="ni">&amp;quot;</span>:1586903987261,<span class="ni">&amp;quot;</span>valueType<span class="ni">&amp;quot;</span>:<span class="ni">&amp;quot;</span>long<span class="ni">&amp;quot;</span>}<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;string</span> <span class="na">name=</span><span class="s">"com.kakao.token.RefreshToken"</span><span class="nt">&gt;</span>{<span class="ni">&amp;quot;</span>value<span class="ni">&amp;quot;</span>:<span class="ni">&amp;quot;</span>something<span class="ni">&amp;quot;</span>,<span class="ni">&amp;quot;</span>valueType<span class="ni">&amp;quot;</span>:<span class="ni">&amp;quot;</span>string<span class="ni">&amp;quot;</span>}<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;string</span> <span class="na">name=</span><span class="s">"com.kakao.token.AccessToken"</span><span class="nt">&gt;</span>{<span class="ni">&amp;quot;</span>value<span class="ni">&amp;quot;</span>:<span class="ni">&amp;quot;</span>something<span class="ni">&amp;quot;</span>,<span class="ni">&amp;quot;</span>valueType<span class="ni">&amp;quot;</span>:<span class="ni">&amp;quot;</span>string<span class="ni">&amp;quot;</span>}<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;/map&gt;</span>
</code></pre></div></div>

<p>adb로 접속해서 확인해보면 Token에 대한 정보가 로컬 저장소에 정상적으로 저장된 것을 확인할 수 있었다. 여기서 조금 더 나아가 수정을 해보자. 현재까지 있던 문제로는 introActivity가 activityStack에 남아있다는 점과 MainActivity로 넘어간다는 점, 또 그리고 LoginActivity를 세션이 유지되어 있는 동안에는 굳이 띄울필요가 없다는 점을 들 수 있겠다. 해당 처리를 위해서 IntroActivity 부분과 IntroThread를 낭낭히 수정해보자.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.ssg.aintstagram</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.os.Message</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Handler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.kakao.auth.Session</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">IntroThread</span> <span class="kd">extends</span> <span class="nc">Thread</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Handler</span> <span class="n">handler</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">IntroThread</span><span class="o">(</span><span class="nc">Handler</span> <span class="n">handler</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">handler</span> <span class="o">=</span> <span class="n">handler</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(){</span>
        <span class="nc">Message</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Message</span><span class="o">();</span>

        <span class="k">try</span><span class="o">{</span>
            <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">2000</span><span class="o">);</span>

            <span class="k">if</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">getCurrentSession</span><span class="o">().</span><span class="na">isOpened</span><span class="o">()){</span>
                <span class="n">msg</span><span class="o">.</span><span class="na">what</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">else</span><span class="o">{</span>
                <span class="n">msg</span><span class="o">.</span><span class="na">what</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="n">handler</span><span class="o">.</span><span class="na">sendEmptyMessage</span><span class="o">(</span><span class="n">msg</span><span class="o">.</span><span class="na">what</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Introthread는 잠시 로고를 띄워주는 역할을 수행했었는데 한 가지 작업을 더 추가하였다.</p>

<p><a href="https://developers.kakao.com/sdk/reference/android-legacy/release/index.html">kakao-api doc</a></p>

<p>위의 사이트의 Session 라이브러리를 보면 isOpened라는 메소드가 있다. 해당 메소드를 호출하여 세션에 대한 정보가 있는지를 확인한 뒤 연결되어 있는 상태이면 1을 아닐 경우 2를 넘겨준다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleMessage</span><span class="o">(</span><span class="nc">Message</span> <span class="n">msg</span><span class="o">){</span>
    <span class="k">if</span><span class="o">(</span><span class="n">msg</span><span class="o">.</span><span class="na">what</span> <span class="o">==</span> <span class="mi">1</span><span class="o">){</span>
        <span class="nc">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Intent</span><span class="o">(</span><span class="nc">IntroActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="nc">MainActivity</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">else</span><span class="o">{</span>
        <span class="nc">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Intent</span><span class="o">(</span><span class="nc">IntroActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="nc">LoginActivity</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">finish</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>IntroActivity는 해당 결과를 받아와 LoginActivity를 호출할지 MainActivity를 호출할지 결정해주기만 하면 된다. 그 후 onDestroy() 호출을 위해 finish를 해주면 된다.</p>

<h3 id="카카오-로그인-정보로-계정-생성하기">카카오 로그인 정보로 계정 생성하기</h3>

<p>카카오 API를 활용하여 로그인을 하기 때문에 그에 해당하는 DB를 설계해줘야 된다. 일단은 간단하게 아래와 같이 모델을 설계하였다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>


<span class="k">class</span> <span class="nc">UserModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"아이디"</span><span class="p">)</span>
    <span class="n">kakaoID</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"카카오"</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"가입날짜"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</code></pre></div></div>

<p>가장 최소한의 정보로는 name으로 사용할 정보와 kakao 계정id 정보, 그리고 가입날짜가 되겠다. 물론 프로필 사진과 같은 정보들이 필요하겠지만 일단은 가장 최소화 형태로 구현하기로 한다.</p>

<p>graphQL을 사용할 것이기 때문에 해당 모델에 대한 정보를 제대로 가져오는지 테스트가 필요했다. 그래서 test라는 name으로 계정을 하나 생성하였다. 이제 graphQL이 제대로 정보를 가져오는지 테스트를 해봐야된다. 이를 위해서 아래와 같이 요청을 해보았다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>query {
    users{
        name
        kakaoID
        date
    }
}
</code></pre></div></div>

<p>해당 요청을 받은 api서버는 아래의 로직을 타게 된다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">UserType</span><span class="p">(</span><span class="n">DjangoObjectType</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">UserModel</span>


<span class="k">class</span> <span class="nc">Query</span><span class="p">(</span><span class="n">graphene</span><span class="o">.</span><span class="n">ObjectType</span><span class="p">):</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">UserType</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">resolve_users</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">UserModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
</code></pre></div></div>

<p>users로 들어온 UserType 즉, UserModel이라는 model에 대한 리스트를 리턴해준다. 결과를 확인해보면 아래와 같이 정상적으로 값을 가져온 것을 확인할 수 있었다.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"users"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"test"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"kakaoID"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="nl">"date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-04-14T14:03:38.309435+00:00"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>생성과 같은 경우에는 mutation을 아래처럼 사용하면 된다. 나의 경우 Output으로 UserType을 넘겨줬더니 여러 문제가 계속 발생해서 일단은 아래와 같이 해결하였다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CreateUser</span><span class="p">(</span><span class="n">graphene</span><span class="o">.</span><span class="n">Mutation</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">String</span><span class="p">()</span>
    <span class="n">kakaoID</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">Int</span><span class="p">()</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">DateTime</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Arguments</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">kakaoID</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">Int</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mutate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">kakaoID</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">UserModel</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">kakaoID</span><span class="o">=</span><span class="n">kakaoID</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">CreateUser</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">kakaoID</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">kakaoID</span><span class="p">,</span>
            <span class="n">date</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">date</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">Mutation</span><span class="p">(</span><span class="n">graphene</span><span class="o">.</span><span class="n">ObjectType</span><span class="p">):</span>
    <span class="n">create_user</span> <span class="o">=</span> <span class="n">CreateUser</span><span class="o">.</span><span class="n">Field</span><span class="p">()</span>


<span class="n">schema</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">Schema</span><span class="p">(</span>
    <span class="n">query</span><span class="o">=</span><span class="n">Query</span><span class="p">,</span>
    <span class="n">mutation</span><span class="o">=</span><span class="n">Mutation</span>
<span class="p">)</span>
</code></pre></div></div>

<p>쿼리를 다음과 같이 날리면,</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mutation {
    createUser (name: "wizley", kakaoID: 1234){
        name
        kakaoID
        date
    }
}
</code></pre></div></div>

<p>save가 되고 나면 다음과 같이 응답이 돌아온다.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"createUser"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"wizley"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"kakaoID"</span><span class="p">:</span><span class="w"> </span><span class="mi">1234</span><span class="p">,</span><span class="w">
            </span><span class="nl">"date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-04-14T15:10:36.012405+00:00"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>하지만 여기에서 아직 진행하지 않은 작업이 있다. 계정이 이미 존재하는지에 대한 검사를 수행하지 않은 것이다. 그래서 try문을 통해 기존 kakaoID 계정이 존재하는지를 확인하는 코드를 추가해주었다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CreateUser</span><span class="p">(</span><span class="n">graphene</span><span class="o">.</span><span class="n">Mutation</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">String</span><span class="p">()</span>
    <span class="n">kakaoID</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">Int</span><span class="p">()</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">DateTime</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Arguments</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">kakaoID</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">Int</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mutate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">kakaoID</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">UserModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kakaoID</span><span class="o">=</span><span class="n">kakaoID</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">UserModel</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">kakaoID</span><span class="o">=</span><span class="n">kakaoID</span><span class="p">)</span>
            <span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">CreateUser</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">kakaoID</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">kakaoID</span><span class="p">,</span>
            <span class="n">date</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">date</span>
        <span class="p">)</span>
</code></pre></div></div>

<h3 id="apollo-graphql-적용하기">Apollo graphql 적용하기</h3>

<p>이제 해당 요청을 안드로이드에서 api서버로 해야되는데 찾아보니 apollo graphql이 있었다.</p>

<p><a href="https://github.com/apollographql/apollo-android">apollo-grapQL</a></p>

<p>순서대로 따라해보면 root의 gradle에 아래를 추가해주어야 된다.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">buildscript</span> <span class="p">{</span>
    <span class="nx">repositories</span> <span class="p">{</span>
        <span class="nx">jcenter</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="nx">dependencies</span> <span class="p">{</span>
        <span class="nx">classpath</span><span class="p">(</span><span class="dl">"</span><span class="s2">com.apollographql.apollo:apollo-gradle-plugin:1.4.4</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>그리고 app의 gradle에 아래와 같이 추가해준다.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">apply</span> <span class="nx">plugin</span><span class="p">:</span> <span class="dl">'</span><span class="s1">com.apollographql.apollo</span><span class="dl">'</span>



<span class="nx">dependencies</span> <span class="p">{</span>
    
    <span class="nx">implementation</span><span class="p">(</span><span class="dl">"</span><span class="s2">com.apollographql.apollo:apollo-runtime:1.4.4</span><span class="dl">"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>성공적으로 프로젝트에 대한 빌드가 진행되는 것을 확인할 수 있었다. 여기서 또 삽질의 시간이 왔다. schema.json을 생성해주어야 되는데 공식 사이트의 커맨드 라인이 정상적으로 작동하지 않았다. 나의 경우 아래와 같이 해결할 수 있었다.</p>

<p><a href="https://www.apollographql.com/docs/android/essentials/get-started/">Apollo graphQL client for Android</a></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew install apollo-cli
</code></pre></div></div>

<p>apollo-cli 패키지를 먼저 설치를 한다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">Wizley:~/git/aintstagram/app/src/main/graphql/com/ssg #</span><span class="w"> </span>apollo schema:download <span class="nt">--endpoint</span><span class="o">=</span>http://localhost:8000/graphql/ schema.json
<span class="go">  ✔ Loading Apollo Project
  ✔ Saving schema to schema.json
</span></code></pre></div></div>

<p>그 후 위와 같이 endpoint로 graphql 주소를 줘서 아래와 같은 schema.json을 만들 수 있었다.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"__schema"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"queryType"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Query"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"mutationType"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Mutation"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"subscriptionType"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nl">"types"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"kind"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OBJECT"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Query"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="nl">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"users"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="nl">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="nl">"kind"</span><span class="p">:</span><span class="w"> </span><span class="s2">"LIST"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
              </span><span class="nl">"ofType"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"kind"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OBJECT"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UserType"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"ofType"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
              </span><span class="p">}</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"isDeprecated"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nl">"deprecationReason"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"inputFields"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="nl">"interfaces"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
        </span><span class="nl">"enumValues"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="nl">"possibleTypes"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
        </span><span class="err">//</span><span class="w"> </span><span class="err">생략</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="err">}</span><span class="w">
</span></code></pre></div></div>

<p>무려 1112줄이나 된다. 이걸 직접 생성할려고 했으면 꽤나 힘들었을 것 같다. (다행히도 삽질을 통해서 자동생성할 수 있었음에 감사한다..) 자 여기서 또 엄청나게 삽질을 했다. 적용을 위해서는 아래와 같이 한번더 gradle에 추가가 필요하다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apollo {
    generateKotlinModels.set(false)
}
</code></pre></div></div>

<p>app아래의 build.gradle에 추가해주면 되는데 false를 하면 java로 적용된다. 그리고 이것 뿐만 아니라 해당 build.gradle에 하나의 옵션을 더 주어야 되는데 이걸 주지 않으면 notNULL과 같은 패키지 오류가 발생한다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>implementation 'org.jetbrains:annotations:13.0'
</code></pre></div></div>

<p>여기까지 작성하면 정상적으로 작동한다.</p>

<div class="language-graphql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">mutation</span><span class="w"> </span><span class="n">create_user</span><span class="p">(</span><span class="nv">$name</span><span class="p">:</span><span class="nb">String</span><span class="p">!,</span><span class="w"> </span><span class="nv">$kakaoID</span><span class="p">:</span><span class="nb">Int</span><span class="p">!){</span><span class="w">
    </span><span class="n">createUser</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="nv">$name</span><span class="p">,</span><span class="w"> </span><span class="n">kakaoID</span><span class="p">:</span><span class="w"> </span><span class="nv">$kakaoID</span><span class="p">){</span><span class="w">
        </span><span class="n">name</span><span class="w">
        </span><span class="n">kakaoID</span><span class="w">
        </span><span class="n">date</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="api-서버로-쿼리-요청-및-응답받아오기">api 서버로 쿼리 요청 및 응답받아오기</h3>

<p>이번에는 graphql아래의 디렉토리에 createUser.graphql을 생성하였다. createUser는 schema.json에 있는 그 이름 그대로 써야되며 mutation 타입아래 서버의 createUser부분을 의미한다. 이제 요청을 보내는 부분을 아래와 같이 작성한다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">getUserInfo</span><span class="o">(){</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">keys</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="n">keys</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"properties.nickname"</span><span class="o">);</span>

        <span class="nc">UserManagement</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">me</span><span class="o">(</span><span class="n">keys</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MeV2ResponseCallback</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onSessionClosed</span><span class="o">(</span><span class="nc">ErrorResult</span> <span class="n">errorResult</span><span class="o">)</span> <span class="o">{</span>

            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onSuccess</span><span class="o">(</span><span class="nc">MeV2Response</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">String</span> <span class="nc">Nickname</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">getNickname</span><span class="o">();</span>
                <span class="kt">int</span> <span class="n">kakaoID</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">result</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
                <span class="nc">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">"LOG HERE"</span><span class="o">,</span> <span class="s">"requestMe onSuccess message : "</span> <span class="o">+</span> <span class="nc">Nickname</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">kakaoID</span><span class="o">);</span>

                <span class="nc">String</span> <span class="n">base_URL</span> <span class="o">=</span> <span class="s">"http://10.0.2.2:8000/graphql/"</span><span class="o">;</span>
                <span class="nc">OkHttpClient</span> <span class="n">okHttpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OkHttpClient</span><span class="o">.</span><span class="na">Builder</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
                <span class="nc">ApolloClient</span> <span class="n">apolloClient</span> <span class="o">=</span> <span class="nc">ApolloClient</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">serverUrl</span><span class="o">(</span><span class="n">base_URL</span><span class="o">).</span><span class="na">okHttpClient</span><span class="o">(</span><span class="n">okHttpClient</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

                <span class="kd">final</span> <span class="n">Create_userMutation</span> <span class="n">userCreation</span> <span class="o">=</span> <span class="n">Create_userMutation</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">name</span><span class="o">(</span><span class="nc">Nickname</span><span class="o">).</span><span class="na">kakaoID</span><span class="o">(</span><span class="n">kakaoID</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

                <span class="n">apolloClient</span><span class="o">.</span><span class="na">mutate</span><span class="o">(</span><span class="n">userCreation</span><span class="o">).</span><span class="na">enqueue</span><span class="o">(</span><span class="k">new</span> <span class="nc">ApolloCall</span><span class="o">.</span><span class="na">Callback</span><span class="o">&lt;</span><span class="n">Create_userMutation</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;()</span> <span class="o">{</span>
                    <span class="nd">@Override</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResponse</span><span class="o">(</span><span class="nc">Response</span><span class="o">&lt;</span><span class="n">Create_userMutation</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
                        <span class="nc">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Intent</span><span class="o">(</span><span class="nc">LoginActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="nc">MainActivity</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
                        <span class="n">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>

                    <span class="o">}</span>

                    <span class="nd">@Override</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFailure</span><span class="o">(</span><span class="nc">ApolloException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="nc">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">"grapql"</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getLocalizedMessage</span><span class="o">());</span>
                    <span class="o">}</span>
                <span class="o">});</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>
</code></pre></div></div>

<p>카카오 api가 정상적으로 값을 가져와서 onSuccess가 호출이 되면 OkHttpClient와 ApolloClient를 통해서 graphql endpoint로 쿼리를 전송한다. apolloClient.query는 쿼리를 위한 요청이고 위의 mutate는 mutation을 위한 요청이다. onResponse를 통해 결과로 Data가 돌아오는데 response.data().createUser.kakaoID 와 같은 형식으로 값을 가져오는게 가능하다. 하지만 해당 기능을 구현하는데 자꾸 onFailure가 호출되었다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2020-04-15 22:10:02.094 15908-16050/com.ssg.aintstagram D/GRAPHQL: Failed to execute http call
</code></pre></div></div>

<p>찾아보니 AVD에서는 10.0.2.2로 localhost와 통신을 한다는데 브라우저를 통해 접속하면 접속이 되도 앱에서 쏘면 작동을 하지 않고 위와 같은 에러가 발생하였다. 많은 고민끝에 해결했는데 아마 아래의 한 줄을 매니패스트에 추가해주면서 해결이 된 것 같다.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;application</span>
    <span class="na">android:usesCleartextTraffic=</span><span class="s">"true"</span>
</code></pre></div></div>

<p>로컬을 https가 아닌 http로 통신을 하도록 설정을 했기 때문에 프로토콜에 의한 접근 제한을 당한것 같다. 이렇게 해결하면 정상적으로 서버로부터 응답이 오는 것을 확인할 수 있었다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">aintstagram | [15/Apr/2020 22:18:10] "POST /graphql/ HTTP/1.1" 200 130
aintstagram | [15/Apr/2020 22:19:00] "POST /graphql/ HTTP/1.1" 200 130
aintstagram | [15/Apr/2020 22:19:30] "POST /graphql/ HTTP/1.1" 200 130
aintstagram | [15/Apr/2020 22:22:13] "POST /graphql/ HTTP/1.1" 200 130
aintstagram | [15/Apr/2020 22:26:08] "POST /graphql/ HTTP/1.1" 200 130
</span></code></pre></div></div>

<p>이렇게 graphql과 통신을 하는 방법에 대해서 익힐 수 있었다.</p>

<h3 id="db-구성하기">DB 구성하기</h3>

<p>백엔드 쪽과 뷰를 짜기 위해서는 모델에 대한 설계가 필요하다. 기능들을 세분화하여서 모델의 구조를 아래의 그림과 같이 만들었다.</p>

<p><img src="https://raw.githubusercontent.com/wizleysw/wizleysw.github.io/master/_posts/img/aintstagram/modelling.png" alt="modelling" /></p>

<p>그리고 이에 따라 models.py를 구성해보면 아래와 같다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>


<span class="k">class</span> <span class="nc">UserModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"아이디"</span><span class="p">)</span>
    <span class="n">kakaoID</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"카카오"</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"가입날짜"</span><span class="p">)</span>
    <span class="n">profile</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="s">"pictures/profile"</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"프로필사진"</span><span class="p">)</span>
    <span class="n">text_comment</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"코멘트"</span><span class="p">)</span>
    <span class="n">post_count</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s">"포스트"</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">follower_count</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s">"팔로워"</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">following_count</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s">"팔로잉"</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">is_open</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s">"공개 여부"</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>


<span class="k">class</span> <span class="nc">HistoryModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">history_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">UserModel</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"사용자"</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">selection</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s">'F'</span><span class="p">,</span> <span class="s">'Follow'</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'L'</span><span class="p">,</span> <span class="s">'Like'</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'C'</span><span class="p">,</span> <span class="s">'Comment'</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"타입"</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">selection</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">'C'</span><span class="p">)</span>
    <span class="n">record_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s">"번호"</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"생성날짜"</span><span class="p">)</span>
    <span class="n">is_active</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s">"노출 여부"</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PictureModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">pic_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">pic</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="s">"pictures/pic"</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"사진"</span><span class="p">)</span>
    <span class="n">record_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s">"번호"</span><span class="p">)</span>
    <span class="n">pic_idx</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s">"인덱스"</span><span class="p">)</span>
    <span class="n">selection</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s">'P'</span><span class="p">,</span> <span class="s">'Post'</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'S'</span><span class="p">,</span> <span class="s">'Story'</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'M'</span><span class="p">,</span> <span class="s">'Message'</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"타입"</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">selection</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">'P'</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">StoryModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">story_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">pic</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">PictureModel</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"사진"</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">UserModel</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"유저"</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"생성날짜"</span><span class="p">)</span>
    <span class="n">is_active</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s">"활성화 여부"</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">FollowModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">follow_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">user_from</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">UserModel</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"요청"</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">"follow_user_from"</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">user_to</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">UserModel</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"응답"</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">"follow_user_to"</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"생성날짜"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MessageModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">message_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">sender</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">UserModel</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"보낸이"</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">chatroom_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s">"번호"</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"생성날짜"</span><span class="p">)</span>
    <span class="n">has_seen</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s">"확인여부"</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">pic</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">PictureModel</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"사진"</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">text_message</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"메시지"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ChatroomModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">chatroom_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">user_from</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">UserModel</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"생성자"</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">"chatroom_user_from"</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">user_to</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">UserModel</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"초대받은자"</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">"chatroom_user_to"</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">HashtagModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">tag_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">tag_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"태그"</span><span class="p">)</span>
    <span class="n">selection</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s">'P'</span><span class="p">,</span> <span class="s">'Post'</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'C'</span><span class="p">,</span> <span class="s">'Comment'</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"타입"</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">selection</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">'P'</span><span class="p">)</span>
    <span class="n">record_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s">"번호"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">LikeModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">like_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">selection</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s">'P'</span><span class="p">,</span> <span class="s">'Post'</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'C'</span><span class="p">,</span> <span class="s">'Comment'</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"타입"</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">selection</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">'P'</span><span class="p">)</span>
    <span class="n">user_from</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">UserModel</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"준 이"</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">"like_user_from"</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">user_to</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">UserModel</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"받은 이"</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">"like_user_to"</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"생성날짜"</span><span class="p">)</span>
    <span class="n">record_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s">"번호"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PostModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">post_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">UserModel</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"유저"</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">allow_comment</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"코멘트 활성화여부"</span><span class="p">)</span>
    <span class="n">place</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"장소"</span><span class="p">)</span>
    <span class="n">like_count</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"좋아요 개수"</span><span class="p">)</span>
    <span class="n">text_comment</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"코멘트"</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"작성일자"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CommentModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">comment_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">UserModel</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"유저"</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"작성일자"</span><span class="p">)</span>
    <span class="n">post_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s">"포스트 번호"</span><span class="p">)</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">like_count</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"좋아요 개수"</span><span class="p">)</span>
    <span class="n">text_comment</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"코멘트"</span><span class="p">)</span>
</code></pre></div></div>

<p>이 과정에서 ImageField를 사용하기 위해서는 Pillow를 설치하여야 되는데 설치가 잘 되지 않아 아래의 명령어로 설치를 하였다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">pip3 install --user git+https://github.com/python-imaging/Pillow
</span></code></pre></div></div>

<p>이제 구성한 다이어그램을 기준으로 코드를 작성하면 될 것 같다.</p>

<h3 id="graphql-query문-변형">graphql Query문 변형</h3>

<p>이번에는 프로필 정보를 가져오기 위해서 정보를 추가하여 보자. 대략적으로 kakaoID를 기반으로 가져오는 것과 user의 이름으로 가져오는 것 두 분류만 있으면 될 것같다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Query</span><span class="p">(</span><span class="n">graphene</span><span class="o">.</span><span class="n">ObjectType</span><span class="p">):</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">UserType</span><span class="p">,</span>
                          <span class="n">kakaoID</span><span class="o">=</span><span class="n">graphene</span><span class="o">.</span><span class="n">Int</span><span class="p">(),</span>
                          <span class="n">username</span><span class="o">=</span><span class="n">graphene</span><span class="o">.</span><span class="n">String</span><span class="p">(),</span>
                          <span class="p">)</span>

    <span class="k">def</span> <span class="nf">resolve_users</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">kakaoID</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">UserModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">kakaoID</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">UserModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">kakaoID</span><span class="o">=</span><span class="n">kakaoID</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">username</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">UserModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">username</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">query</span>
</code></pre></div></div>

<p>방법은 위와 같다. List에 kakaoID와 username이라는 필드를 추가한 뒤 해당 필드가 존재할 경우에 그에 따른 filter 결과를 돌려주면 된다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">query {
    users (username:"Wizley"){
        name
        kakaoID
    }
}
</span></code></pre></div></div>

<p>이제 이렇게 명시적으로 요청을 하면 아래와 같이 정보를 확인하여 돌려주는 것을 확인할 수 있다. 만약 filter의 결과가 존재하지 않으면 []를 리턴해준다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">{
    "data": {
        "users": [
            {
                "name": "Wizley",
                "kakaoID": 1111111111
            }
        ]
    }
}
</span></code></pre></div></div>

<p>이제 해당 부분을 토대로 사용자의 정보를 profile 탭에서 뿌려주는 부분을 구현해 볼 것이다. 이를 위해서는 schema.json의 위와 같이 다시 만들어야 된다. 그리고 아래와 같이 java파일 하나를 추가하였다.</p>

<div class="language-graphql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">query</span><span class="w"> </span><span class="n">userType</span><span class="p">(</span><span class="nv">$name</span><span class="p">:</span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="nv">$kakaoID</span><span class="p">:</span><span class="nb">Int</span><span class="p">){</span><span class="w">
    </span><span class="n">users</span><span class="w"> </span><span class="p">(</span><span class="n">username</span><span class="p">:</span><span class="w"> </span><span class="nv">$name</span><span class="p">,</span><span class="w"> </span><span class="n">kakaoID</span><span class="p">:</span><span class="w"> </span><span class="nv">$kakaoID</span><span class="p">){</span><span class="w">
        </span><span class="n">name</span><span class="w">
        </span><span class="n">kakaoID</span><span class="w">
        </span><span class="n">textComment</span><span class="w">
        </span><span class="n">postCount</span><span class="w">
        </span><span class="n">followerCount</span><span class="w">
        </span><span class="n">followingCount</span><span class="w">
        </span><span class="n">profile</span><span class="w">
        </span><span class="n">isOpen</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre></div></div>

<p>Query문을 위해 사용되며 userType Object에 대하여 users로 username 또는 KakaoID를 기반으로 조회하여 결과를 돌려준다. 위의 요청이 가면 아래의 형태로 응답이 돌아오게된다.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"users"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Wizley"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"kakaoID"</span><span class="p">:</span><span class="w"> </span><span class="mi">11111</span><span class="p">,</span><span class="w">
                </span><span class="nl">"textComment"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hello Wizley!"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"postCount"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="nl">"followerCount"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="nl">"followingCount"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                </span><span class="nl">"profile"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pictures/profile/kiki.png"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>자바에서 해당 부분을 보내는 코드는 다음과 같다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nc">String</span> <span class="n">base_URL</span> <span class="o">=</span> <span class="s">"http://10.0.2.2:8000/graphql/"</span><span class="o">;</span>
                <span class="nc">OkHttpClient</span> <span class="n">okHttpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OkHttpClient</span><span class="o">.</span><span class="na">Builder</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
                <span class="nc">ApolloClient</span> <span class="n">apolloClient</span> <span class="o">=</span> <span class="nc">ApolloClient</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">serverUrl</span><span class="o">(</span><span class="n">base_URL</span><span class="o">).</span><span class="na">okHttpClient</span><span class="o">(</span><span class="n">okHttpClient</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

                <span class="kd">final</span> <span class="nc">UserTypeQuery</span> <span class="n">u</span> <span class="o">=</span> <span class="nc">UserTypeQuery</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">kakaoID</span><span class="o">(</span><span class="n">kakaoID</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

                <span class="n">apolloClient</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">u</span><span class="o">).</span><span class="na">enqueue</span><span class="o">(</span><span class="k">new</span> <span class="nc">ApolloCall</span><span class="o">.</span><span class="na">Callback</span><span class="o">&lt;</span><span class="nc">UserTypeQuery</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;()</span> <span class="o">{</span>
                    <span class="nd">@Override</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResponse</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">Response</span><span class="o">&lt;</span><span class="nc">UserTypeQuery</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">post_cnt</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">users</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">postCount</span><span class="o">;</span>
                        <span class="n">follower_cnt</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">users</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">followerCount</span><span class="o">;</span>
                        <span class="n">following_cnt</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">users</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">followingCount</span><span class="o">;</span>
                        <span class="n">is_open</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">users</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">isOpen</span><span class="o">;</span>
                        <span class="kd">final</span> <span class="nc">String</span> <span class="n">profile_img</span> <span class="o">=</span> <span class="n">getString</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">media_url</span><span class="o">)</span> <span class="o">+</span> <span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">users</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">profile</span><span class="o">;</span>
</code></pre></div></div>

<p>Mutation과 거의 동일한데 UserTypeQuery와 같이 명시된 형태를 사용해야 한다는 점에서 약간의 차이가 있다. 결과에 대해서는 List 형으로 돌아오기 때문에 인덱스를 기반으로 값을 가져와야 된다.</p>

<h3 id="django-media-url-설정">Django MEDIA URL 설정</h3>

<p>이미지에 대한 링크가 response로 돌아오기 때문에 해당 url을 기반으로 이미지를 받아와야 된다. 이를 위해서 다음과 같이 세팅을 해주었다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">MEDIA_URL</span> <span class="o">=</span> <span class="s">'/media/'</span>
<span class="n">MEDIA_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s">'media'</span><span class="p">)</span>
</code></pre></div></div>

<p>settings.py에서 이미지를 저장할 위치를 BASE_DIR를 기준으로 설정을 해주었다. 그리고 url을 통해 접근하기 위해서 main app의 urls.py에 아래와 같이 한줄을 추가하였다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">urlpatterns</span> <span class="o">+=</span> <span class="n">static</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">MEDIA_URL</span><span class="p">,</span> <span class="n">document_root</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">MEDIA_ROOT</span><span class="p">)</span>
</code></pre></div></div>

<p>이렇게 추가를 해주면 url을 통해 해당 정보에 접근이 가능하다. 이제 java에서 이 정보를 토대로 화면에 그려주는 작업을 수행해볼 것이다. 먼저 고정된 주소를 여러 activity에서 사용할 것이기 때문에 res 내부의 strings.xml에 아래와 같이 정보를 추가해준다.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;resources&gt;</span>
    <span class="nt">&lt;string</span> <span class="na">name=</span><span class="s">"app_name"</span><span class="nt">&gt;</span>aintstagram<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;string</span> <span class="na">name=</span><span class="s">"media_url"</span><span class="nt">&gt;</span>http://10.0.2.2:8000/media/<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;/resources&gt;</span>
</code></pre></div></div>

<p>이렇게 등록을 해두게 되면 getString을 통해 아래와 같이 해당 문자열을 가져오는게 가능하다. 물론 윗 부분에 포맷스트링을 사용하여 builder로 생성하는 것 또한 가능하다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">final</span> <span class="nc">String</span> <span class="n">profile_img</span> <span class="o">=</span> <span class="n">getString</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">media_url</span><span class="o">)</span> <span class="o">+</span> <span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">users</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">profile</span><span class="o">;</span>

<span class="nc">Thread</span> <span class="n">mThread</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="no">URL</span> <span class="n">img_url</span> <span class="o">=</span> <span class="k">new</span> <span class="no">URL</span><span class="o">(</span><span class="n">profile_img</span><span class="o">);</span>
            <span class="nc">HttpURLConnection</span> <span class="n">conn</span> <span class="o">=</span> <span class="o">(</span><span class="nc">HttpURLConnection</span><span class="o">)</span> <span class="n">img_url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">();</span>
            <span class="n">conn</span><span class="o">.</span><span class="na">setDoInput</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
            <span class="n">conn</span><span class="o">.</span><span class="na">connect</span><span class="o">();</span>

            <span class="nc">InputStream</span> <span class="n">is</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
            <span class="n">bitmap</span> <span class="o">=</span> <span class="nc">BitmapFactory</span><span class="o">.</span><span class="na">decodeStream</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>

            <span class="n">runOnUiThread</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span><span class="o">(){</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(){</span>
                    <span class="nc">ImageView</span> <span class="n">v_profile</span> <span class="o">=</span> <span class="o">(</span><span class="nc">ImageView</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">user_profile</span><span class="o">);</span>
                    <span class="n">v_profile</span><span class="o">.</span><span class="na">setImageBitmap</span><span class="o">(</span><span class="n">bitmap</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">});</span>
        <span class="o">}</span> <span class="k">catch</span><span class="o">(</span>
        <span class="nc">MalformedURLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>

        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">};</span>

<span class="n">mThread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</code></pre></div></div>

<p>네트워크 작업을 수행하기 위해 Thread를 만들었는데 thread는 실행되면 url로부터 bitmap 형태로 이미지를 가져오게 된다. 이 과정에서 주의해야 될 것이 있는데 view에 대한 설정은 MainThread에서만 수행되기 때문에 원할한 처리를 위해서 runOnUiThread를 사용하여 ImageView의 setImageBitmap을 처리해주어야 된다. 이와 같이 처리를 하고 나면 정상적으로 이미지가 ImageView 화면에 그려진다.</p>

<h3 id="circleimageview-추가">CircleImageView 추가</h3>

<p><a href="https://github.com/hdodenhof/CircleImageView">CircleImageView</a></p>

<p>인스타그램의 프로필 사진이 동그랗게 생겼기 때문에 해당 부분에 대한 구현을 고민해보았는데 역시나 누군가가 이미 만든 라이브러리가 있었다. 해당 라이브러리를 사용해주면 쉽게 그리는 것이 가능하다.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>implementation 'de.hdodenhof:circleimageview:3.1.0'
</code></pre></div></div>

<p>build.gradle에 Implementation을 추가한 뒤 아래와 같이 layout에서 구현을 해주면 된다.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;de.hdodenhof.circleimageview.CircleImageView</span>
    <span class="na">android:id=</span><span class="s">"@+id/user_profile"</span>
    <span class="na">android:layout_height=</span><span class="s">"150dp"</span>
    <span class="na">android:layout_width=</span><span class="s">"0dp"</span>
    <span class="na">app:layout_constraintVertical_weight=</span><span class="s">"1"</span>
    <span class="na">app:layout_constraintHorizontal_weight=</span><span class="s">"1.5"</span>
    <span class="na">app:layout_constraintTop_toTopOf=</span><span class="s">"@id/guideline_top_menu"</span>
    <span class="na">app:layout_constraintBottom_toTopOf=</span><span class="s">"@id/user_comment"</span>
    <span class="na">app:layout_constraintLeft_toLeftOf=</span><span class="s">"parent"</span>
    <span class="na">app:layout_constraintRight_toLeftOf=</span><span class="s">"@id/user_posts"</span>
    <span class="na">app:civ_border_width=</span><span class="s">"2dp"</span>
    <span class="na">app:civ_border_color=</span><span class="s">"@android:color/white"</span>
    <span class="na">tools:ignore=</span><span class="s">"MissingConstraints"</span> <span class="nt">/&gt;</span>
</code></pre></div></div>

<p>이렇게 구현을 한 뒤 확인을 해보면 나름 비슷한 화면이 구현된 것을 확인할 수 있다.</p>

<p><img src="https://raw.githubusercontent.com/wizleysw/wizleysw.github.io/master/_posts/img/aintstagram/profileview_1.png" alt="profileview_1" /></p>

<h3 id="카메라로-찍은-사진을-public-directory에-저장하기">카메라로 찍은 사진을 Public Directory에 저장하기</h3>

<p>안드로이드의 보안 정책이 바뀜에 따라 FileProvider를 사용해서 앱 내부에 저장하는 방식이 권장되도록 변경되었다고 한다. 하지만 내가 만드는 앱이 저장할 이미지는 앱이 삭제된 후에도 남아있길 원하기 때문에 PublicDirectory에 저장을 해야 했다. 하지만 여기서 Uri와 관련해서 문제가 발생했고 아주 많은 시간을 구현에 할당해서 고칠 수 밖에 없었다.</p>

<p>코드는 대략적으로 두 부분으로 나뉜다. 파일을 해당 디렉토리에 생성하는 과정이 첫 번째이고, 그 다음은 CameraIntent를 통해 찍은 사진을 해당 파일로 저장하는 과정이다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nc">String</span> <span class="n">imageFilePath</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">File</span> <span class="n">mFile</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">File</span> <span class="nf">createImageFile</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">timeStamp</span> <span class="o">=</span>
                <span class="k">new</span> <span class="nf">SimpleDateFormat</span><span class="o">(</span><span class="s">"yyyyMMdd_HHmmss"</span><span class="o">,</span>
                        <span class="nc">Locale</span><span class="o">.</span><span class="na">getDefault</span><span class="o">()).</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">());</span>
        <span class="nc">String</span> <span class="n">imageFileName</span> <span class="o">=</span> <span class="s">"IMG_"</span> <span class="o">+</span> <span class="n">timeStamp</span> <span class="o">+</span> <span class="s">"_"</span><span class="o">;</span>
        <span class="c1">// File storageDir = getExternalFilesDir(Environment.DIRECTORY_PICTURES);</span>

        <span class="nc">File</span> <span class="n">storageDir</span>  <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="nc">Environment</span><span class="o">.</span><span class="na">getExternalStoragePublicDirectory</span><span class="o">(</span><span class="nc">Environment</span><span class="o">.</span><span class="na">DIRECTORY_DCIM</span><span class="o">),</span> <span class="s">"aintstagram"</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">storageDir</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="n">storageDir</span><span class="o">.</span><span class="na">mkdirs</span><span class="o">();</span>

        <span class="n">mFile</span> <span class="o">=</span> <span class="nc">File</span><span class="o">.</span><span class="na">createTempFile</span><span class="o">(</span>
                <span class="n">imageFileName</span><span class="o">,</span>  <span class="cm">/* prefix */</span>
                <span class="s">".jpg"</span><span class="o">,</span>         <span class="cm">/* suffix */</span>
                <span class="n">storageDir</span>      <span class="cm">/* directory */</span>
        <span class="o">);</span>

        <span class="n">imageFilePath</span> <span class="o">=</span> <span class="n">mFile</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">();</span>
        <span class="nc">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">"PATH"</span><span class="o">,</span> <span class="n">imageFilePath</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">mFile</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></div></div>

<p>createImageFile은 현재 시간을 기준으로 timestamp를 찍어 IMG_timestamp_의 형식으로 이름을 만들어 준다. 그 후 getExternalStoragePublicDirectory를 통해 DIRECTORY_DCIM에 aintstagram이라는 폴더를 생선한다. 그 뒤 mFile 부분인 createTempFile을 통해 jpg 확장자의 파일 크기 0인 파일을 생성한 뒤 imageFilePath에 해당 절대 경로를 넣어주는 작업을 수행한다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span> <span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button_to_camera</span><span class="o">:</span>
    <span class="n">permissionCheck</span> <span class="o">=</span> <span class="nc">ContextCompat</span><span class="o">.</span><span class="na">checkSelfPermission</span><span class="o">(</span><span class="nc">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="nc">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">CAMERA</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">permissionCheck</span> <span class="o">==</span> <span class="nc">PackageManager</span><span class="o">.</span><span class="na">PERMISSION_DENIED</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">ActivityCompat</span><span class="o">.</span><span class="na">requestPermissions</span><span class="o">(</span><span class="nc">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="no">PERMISSIONS</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="nc">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Intent</span><span class="o">(</span><span class="nc">MediaStore</span><span class="o">.</span><span class="na">ACTION_IMAGE_CAPTURE</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">intent</span><span class="o">.</span><span class="na">resolveActivity</span><span class="o">(</span><span class="n">getPackageManager</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">File</span> <span class="n">photoFile</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">photoFile</span> <span class="o">=</span> <span class="n">createImageFile</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>

            <span class="k">if</span><span class="o">(</span><span class="n">photoFile</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
                <span class="c1">// Uri photoUri = FileProvider.getUriForFile(MainActivity.this, "com.ssg.aintstagram.fileprovider", photoFile);</span>
                <span class="n">intent</span><span class="o">.</span><span class="na">setFlags</span><span class="o">(</span><span class="nc">Intent</span><span class="o">.</span><span class="na">FLAG_GRANT_READ_URI_PERMISSION</span><span class="o">);</span>
                <span class="nc">Uri</span> <span class="n">photoUri</span> <span class="o">=</span> <span class="nc">Uri</span><span class="o">.</span><span class="na">fromFile</span><span class="o">(</span><span class="n">photoFile</span><span class="o">);</span>
                <span class="n">intent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="nc">MediaStore</span><span class="o">.</span><span class="na">EXTRA_OUTPUT</span><span class="o">,</span> <span class="n">photoUri</span><span class="o">);</span>
                <span class="n">startActivityForResult</span><span class="o">(</span><span class="n">intent</span><span class="o">,</span> <span class="no">REQUEST_IMAGE_CAPTURE</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">break</span><span class="o">;</span>
</code></pre></div></div>

<p>처리부분에서는 해당 함수를 호출한 결과를 photoFile로 지정한 뒤 Uri.fromFile을 통해 카메라로 찍은 사진이 해당 값에 저장되도록 설정한다. 그 후 사진을 찍게 되면 해당 폴더에 저장되는 것을 확인 가능하다.</p>

<p>하지만 여기서 문제가 있었다. 위의 코드만 적을 경우 경로에 대한 문제가 발생하여서 exception이 발생했다. 많은 삽질끝에 아래의 두 줄을 onCreate 부분에 넣어서 해결할 수 있었다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">StrictMode</span><span class="o">.</span><span class="na">VmPolicy</span><span class="o">.</span><span class="na">Builder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StrictMode</span><span class="o">.</span><span class="na">VmPolicy</span><span class="o">.</span><span class="na">Builder</span><span class="o">();</span>
<span class="nc">StrictMode</span><span class="o">.</span><span class="na">setVmPolicy</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">build</span><span class="o">());</span>
</code></pre></div></div>

<p>해당 부분은 안드로이드가 여러 상황에 대해 분석을 하는데 Uri 관련된 부분에 대한 문제를 제기하지 않도록 함으로써 해결하는 것이다. 물론 해당 라인이 보안적인 측면에서 문제가 있을 확률이 아주 높지만 일단 지금 시점에서는 구현을 목표로 하기 때문에 위의 코드를 삽입하였다.</p>

<p>기존의 fileProvider를 사용하는 방법은 다음과 같다.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;paths</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;external-path</span> <span class="na">name=</span><span class="s">"aint_image"</span>
        <span class="na">path=</span><span class="s">"Android/data/com.ssg.aintstagram/files/Pictures"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/paths&gt;</span>
</code></pre></div></div>

<p>경로를 담은 xml 파일을 만들어주고 해당 파일을 참조하는 fileProvider를 manifest 부분에 선언해주어야 된다.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;provider</span>
    <span class="na">android:name=</span><span class="s">"androidx.core.content.FileProvider"</span>
    <span class="na">android:authorities=</span><span class="s">"com.ssg.aintstagram.fileprovider"</span>
    <span class="na">android:exported=</span><span class="s">"false"</span>
    <span class="na">android:grantUriPermissions=</span><span class="s">"true"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta-data</span>
        <span class="na">android:name=</span><span class="s">"android.support.FILE_PROVIDER_PATHS"</span>
        <span class="na">android:resource=</span><span class="s">"@xml/filepaths"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/provider&gt;</span>
</code></pre></div></div>

<p>filepaths가 위의 external-path의 정보를 담은 resource파일의 이름이며 FileProvider를 호출함으로써 fileProvider가 파일에 대한 처리를 수행한다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Uri</span> <span class="n">photoUri</span> <span class="o">=</span> <span class="nc">FileProvider</span><span class="o">.</span><span class="na">getUriForFile</span><span class="o">(</span><span class="nc">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="s">"com.ssg.aintstagram.fileprovider"</span><span class="o">,</span> <span class="n">photoFile</span><span class="o">);</span>
</code></pre></div></div>

<p>이 경우 위와 같이 FileProvider를 Uri로 넘겨주는 방식으로 사용하면 된다. 이렇게 저장된 이미지는 해당 앱의 내부에 저장되기 때문에 원칙적인 경우에 다른 앱에서 접근이 불가능하며 앱이 삭제되면 같이 삭제되는 특징이 있다.</p>

<h3 id="django-request-logging">django-request-logging</h3>

<p>graphql 관련 패킷이 400을 리턴하였었는데 이를 해결하기 위해서 내용을 확인하고 싶었다. 하지만 전송을 하는 주체가 httpclient를 사용한 방식이 아니기 때문에 안드로이드 스튜디오를 통해서를 모니터링이 잘 안되었다.</p>

<p><a href="https://pypi.org/project/django-request-logging/">django-request-logging</a></p>

<p>해당 middleware를 추가해주면 아래와 같이 요청에 대한 정보를 확인가능하다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">aintstagram</span> <span class="o">|</span> <span class="p">[</span><span class="mi">24</span><span class="o">/</span><span class="n">Apr</span><span class="o">/</span><span class="mi">2020</span> <span class="mi">03</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">30</span><span class="p">]</span> <span class="s">"POST /graphql/ HTTP/1.1"</span> <span class="mi">200</span> <span class="mi">251</span>
<span class="n">aintstagram</span> <span class="o">|</span> <span class="n">GET</span> <span class="o">/</span><span class="n">media</span><span class="o">/</span><span class="n">pictures</span><span class="o">/</span><span class="n">profile</span><span class="o">/</span><span class="n">IMG_20200424_031302_4311095808617875937</span><span class="o">.</span><span class="n">jpg</span>
<span class="n">aintstagram</span> <span class="o">|</span> <span class="p">{</span><span class="s">'HTTP_USER_AGENT'</span><span class="p">:</span> <span class="s">'Dalvik/2.1.0 (Linux; U; Android R Build/RPP2.200227.014.A1)'</span><span class="p">,</span> <span class="s">'HTTP_HOST'</span><span class="p">:</span> <span class="s">'10.0.2.2:8000'</span><span class="p">,</span> <span class="s">'HTTP_CONNECTION'</span><span class="p">:</span> <span class="s">'Keep-Alive'</span><span class="p">,</span> <span class="s">'HTTP_ACCEPT_ENCODING'</span><span class="p">:</span> <span class="s">'gzip'</span><span class="p">}</span>
<span class="n">aintstagram</span> <span class="o">|</span> <span class="n">GET</span> <span class="o">/</span><span class="n">media</span><span class="o">/</span><span class="n">pictures</span><span class="o">/</span><span class="n">profile</span><span class="o">/</span><span class="n">IMG_20200424_031302_4311095808617875937</span><span class="o">.</span><span class="n">jpg</span> <span class="o">-</span> <span class="mi">200</span>
</code></pre></div></div>

<p>설정 방법도 간단하다. pip을 통해 설치한 뒤 settings.py의 middleware 부분에 추가해주면 된다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">(</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="s">'request_logging.middleware.LoggingMiddleware'</span><span class="p">,</span>
    <span class="o">...</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div></div>

<p>이를 통해 아래에 적을 file upload 기능이 요청이 정상적으로 전달되었음에도 서버쪽에서 문제가 있다는 점을 알게 되었고 수정할 수 있었다.</p>

<h3 id="graphql-file-upload-구현하기">graphql file upload 구현하기</h3>

<p>이미지를 업로드 하기 위해서는 아래의 프레임워크를 하나 더 추가적으로 설치를 해야 한다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">root@f4e2834b513b:/code#</span><span class="w"> </span>pip <span class="nb">install </span>graphene-file-upload
<span class="go">Collecting graphene-file-upload
  Downloading graphene_file_upload-1.2.2-py3-none-any.whl (9.1 kB)
</span><span class="gp">Requirement already satisfied: six&gt;</span><span class="o">=</span>1.11.0 <span class="k">in</span> /usr/local/lib/python3.8/site-packages <span class="o">(</span>from graphene-file-upload<span class="o">)</span> <span class="o">(</span>1.14.0<span class="o">)</span>
<span class="go">Installing collected packages: graphene-file-upload
Successfully installed graphene-file-upload-1.2.2
</span></code></pre></div></div>

<p>그 후 이점이 중요하다 !!! 바로 urls.py 부분을 변경해주어야 된다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s">'admin/'</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="c1"># path('graphql/', csrf_exempt(GraphQLView.as_view(graphiql=True))),
</span>    <span class="n">path</span><span class="p">(</span><span class="s">'graphql/'</span><span class="p">,</span> <span class="n">csrf_exempt</span><span class="p">(</span><span class="n">FileUploadGraphQLView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">graphiql</span><span class="o">=</span><span class="bp">True</span><span class="p">))),</span>
<span class="p">]</span>
</code></pre></div></div>

<p>해당 부분에 FileUploadGraphQLView로 변경을 해주지 않으면 multipart/form을 통해 정상적으로 이미지가 전송이 되었음에도 불구하고 400 Bad Request를 리턴해버린다. (이걸 해결하는데 시간이 엄청 오래 걸렸다..)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">graphene_file_upload.scalars</span> <span class="kn">import</span> <span class="n">Upload</span>

<span class="k">class</span> <span class="nc">UploadProfile</span><span class="p">(</span><span class="n">graphene</span><span class="o">.</span><span class="n">Mutation</span><span class="p">):</span>
    <span class="n">success</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">Boolean</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Arguments</span><span class="p">:</span>
        <span class="n">kakaoID</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">Int</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">Upload</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mutate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">kakaoID</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="n">User</span> <span class="o">=</span> <span class="n">UserModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kakaoID</span><span class="o">=</span><span class="n">kakaoID</span><span class="p">)</span>
        <span class="n">img</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">kakaoID</span><span class="p">)</span> <span class="o">+</span> <span class="s">"_"</span> <span class="o">+</span> <span class="n">img</span><span class="o">.</span><span class="n">name</span>
        <span class="n">User</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="n">User</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">img</span>
        <span class="n">User</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">UploadProfile</span><span class="p">(</span><span class="n">success</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<p>schema.py 부분에는 다음과 같이 mutate를 추가해준다. Upload라는 타입을 통해 img를 받아온 뒤 User를 kakaoID 기반으로 검색하여 기존의 프로필 사진을 삭제한 뒤 업로드 요청 된 img를 저장해준다.</p>

<p>이제 java로 클라이언트 쪽을 짜주면 되는데 이를 위해서는 약간의 세팅이 필요하다.</p>

<div class="language-gradle highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">apollo</span> <span class="o">{</span>
    <span class="n">customTypeMapping</span> <span class="o">=</span> <span class="o">[</span>
            <span class="s2">"Upload"</span> <span class="o">:</span> <span class="s2">"com.apollographql.apollo.api.FileUpload"</span>
    <span class="o">]</span>
    <span class="n">generateKotlinModels</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>gradle 부분에 Upload를 추가해줄건데 이 부분은 schema에 대한 graphql 파일 작성에 사용된다. schema.json을 아래의 명령으로 최신화 해준다.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">apollo schema:download --endpoint=http://localhost:8000/graphql/ schema.json
</span></code></pre></div></div>

<p>이번에는 처리를 위한 mutation을 작성해주는데 방식은 동일하다. 다만 Upload를 사용한다는 점만 차이가 있다.</p>

<div class="language-graphql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">mutation</span><span class="w"> </span><span class="n">upload_profile</span><span class="p">(</span><span class="nv">$img</span><span class="p">:</span><span class="n">Upload</span><span class="p">!,</span><span class="w"> </span><span class="nv">$kakaoID</span><span class="p">:</span><span class="nb">Int</span><span class="p">!){</span><span class="w">
    </span><span class="n">uploadProfile</span><span class="w"> </span><span class="p">(</span><span class="n">img</span><span class="p">:</span><span class="w"> </span><span class="nv">$img</span><span class="p">,</span><span class="w"> </span><span class="n">kakaoID</span><span class="p">:</span><span class="w"> </span><span class="nv">$kakaoID</span><span class="p">){</span><span class="w">
        </span><span class="n">success</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>java코드도 기존과 동일하다. 조금 다른 점이 있다면 FileUpload 타입으로 image를 지정해주어야 된다. 이 때 File에 대한 인자로 imageFilePath가 들어가게 되는데 절대경로를 따서 넣어주면 된다. 이렇게 요청을 보내면 정상적으로 처리가 될 경우 profile에 대한 정보가 최신화 되는 것을 확인할 수 있다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">OkHttpClient</span> <span class="n">okHttpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OkHttpClient</span><span class="o">.</span><span class="na">Builder</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
<span class="nc">ApolloClient</span> <span class="n">apolloClient</span> <span class="o">=</span> <span class="nc">ApolloClient</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">serverUrl</span><span class="o">(</span><span class="n">getString</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">api_url</span><span class="o">)).</span><span class="na">okHttpClient</span><span class="o">(</span><span class="n">okHttpClient</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

<span class="c1">// bitmap 처리 부분</span>
<span class="kd">final</span> <span class="n">Upload_profileMutation</span> <span class="n">uploadProfile</span> <span class="o">=</span> <span class="n">Upload_profileMutation</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">img</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileUpload</span><span class="o">(</span><span class="s">"image/jpg"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">imageFilePath</span><span class="o">))).</span><span class="na">kakaoID</span><span class="o">(</span><span class="mi">1111</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
<span class="nc">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">"FilePath "</span><span class="o">,</span> <span class="n">imageFilePath</span><span class="o">);</span>
<span class="nc">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">"LOG"</span><span class="o">,</span> <span class="n">uploadProfile</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="n">apolloClient</span><span class="o">.</span><span class="na">mutate</span><span class="o">(</span><span class="n">uploadProfile</span><span class="o">).</span><span class="na">enqueue</span><span class="o">(</span><span class="k">new</span> <span class="nc">ApolloCall</span><span class="o">.</span><span class="na">Callback</span><span class="o">&lt;</span><span class="n">Upload_profileMutation</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResponse</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">Response</span><span class="o">&lt;</span><span class="n">Upload_profileMutation</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">"HEY"</span><span class="o">,</span> <span class="s">"WORLD"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFailure</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">ApolloException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="nc">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">"HEY"</span><span class="o">,</span> <span class="s">"WORLD2"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="o">});</span>
</code></pre></div></div>

<p>아무래도 java - graphql 도 드문 조합이고 graphql - django 도 드물기 때문에 레퍼런스가 거의 없어서 어떤 문제가 생기면 처리하는 것이 쉽지가 않았다. 하지만 스트레스를 받으면서도 계속 방법을 찾다보면 언젠가는 답을 찾게 된다. 그리고 결국 기본 구현을 완성을 하였고 다시금 여기서부터 기록을 남기도록 하겠다.</p>

<h3 id="fragment로-사용자-이미지-recyclerview-처리하기">Fragment로 사용자 이미지 RecyclerView 처리하기</h3>

<p>안드로이드에서는 액티비티 내부에 프래그먼트라는 것을 둘 수가 있다. 이를 직관적으로 설명해보자면 렌즈와 같다. 액티비티라는 큰 틀을 가진 하나의 안경틀에 색깔이 다른 프래그먼트를 끼움으로써 다른 기능을 수행하도록 할 수 있는 것이다. 액티비티 내부에 FrameLayout을 설정하고 조건에 따라 프래그먼트를 스위치하면서 다른 역할을 하는 여러 창들을 하나의 Activity에 바인딩하는 것이 가능하다. 그리고 이런 프래그먼트들은 각각 Fragment Life Cycle을 가지며 이는 액티비티와 비슷하게 동작한다.</p>

<p>RecyclerView는 ScrollView와 ListView를 적절하게 섞어놓은 새로운 View 개념인데 기존의 단점을 보완한 형태이다. 사용해본 결과 장점을 2개를 뽑아보자면 기존의 ListView와 달리 Layout을 세로 가로 등의 형태로 구현이 가능하다는 점과 ViewHolder를 의무로 사용해야 되므로 ViewHolder에 대한 재활용을 통하여 많은 양의 데이터를 사용하더라도 ListView보다 성능면에서 우위를 점한다는 점이었다. 처음 개발해본 입장에서 onClick 이벤트등을 처리하는 방법에 대한 메뉴얼이 잘 보이지 않아서 많이 헤매었지만 한 번 성공한 뒤로는 비슷한 디자인 패턴으로 활용을 하다보니 쉽게 활용이 가능했다. 가장 좋았던 것은 아이템 뷰의 방향을 가로뿐만 아니라 세로로도 지정할 수 있다는 점을 들 수 있겠다.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>implementation 'androidx.recyclerview:recyclerview:1.1.0'
</code></pre></div></div>

<p>사용을 위해서는 dependencies에 위와 같이 recyclerview를 추가해주어야 된다. 그리고 recyclerView에서 사용할 adapter는 다음과 같다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProfileRecyclerAdapter</span> <span class="kd">extends</span> <span class="nc">RecyclerView</span><span class="o">.</span><span class="na">Adapter</span><span class="o">&lt;</span><span class="nc">ProfileRecyclerAdapter</span><span class="o">.</span><span class="na">ItemViewHolder</span><span class="o">&gt;</span>  <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Context</span> <span class="n">context</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Album</span><span class="o">&gt;</span> <span class="n">albums</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">OnPostListener</span> <span class="n">onPostListener</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">ProfileRecyclerAdapter</span><span class="o">(</span><span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Album</span><span class="o">&gt;</span> <span class="n">albums</span><span class="o">,</span> <span class="nc">Context</span> <span class="n">context</span><span class="o">,</span> <span class="nc">OnPostListener</span> <span class="n">onPostListener</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">albums</span> <span class="o">=</span> <span class="n">albums</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">context</span> <span class="o">=</span> <span class="n">context</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">onPostListener</span> <span class="o">=</span> <span class="n">onPostListener</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ItemViewHolder</span> <span class="kd">extends</span> <span class="nc">RecyclerView</span><span class="o">.</span><span class="na">ViewHolder</span> <span class="kd">implements</span> <span class="nc">View</span><span class="o">.</span><span class="na">OnClickListener</span> <span class="o">{</span>
        <span class="nc">ImageView</span> <span class="n">imageView</span><span class="o">;</span>

        <span class="nc">OnPostListener</span> <span class="n">onPostListener</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">ItemViewHolder</span><span class="o">(</span><span class="nc">View</span> <span class="n">itemView</span><span class="o">,</span> <span class="nc">OnPostListener</span> <span class="n">onPostListener</span><span class="o">){</span>
            <span class="kd">super</span><span class="o">(</span><span class="n">itemView</span><span class="o">);</span>

            <span class="n">imageView</span> <span class="o">=</span> <span class="o">(</span><span class="nc">ImageView</span><span class="o">)</span> <span class="n">itemView</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">imgview_picture</span><span class="o">);</span>

            <span class="k">this</span><span class="o">.</span><span class="na">onPostListener</span> <span class="o">=</span> <span class="n">onPostListener</span><span class="o">;</span>
            <span class="n">itemView</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>

        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="nc">View</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">onPostListener</span><span class="o">.</span><span class="na">onPostClick</span><span class="o">(</span><span class="n">getAdapterPosition</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">ItemViewHolder</span> <span class="nf">onCreateViewHolder</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="nc">ViewGroup</span> <span class="n">parent</span><span class="o">,</span> <span class="kt">int</span> <span class="n">viewType</span><span class="o">){</span>
        <span class="nc">View</span> <span class="n">view</span> <span class="o">=</span> <span class="nc">LayoutInflater</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">parent</span><span class="o">.</span><span class="na">getContext</span><span class="o">()).</span><span class="na">inflate</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">layout_post_img</span><span class="o">,</span><span class="n">parent</span><span class="o">,</span><span class="kc">false</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">ItemViewHolder</span><span class="o">(</span><span class="n">view</span><span class="o">,</span> <span class="n">onPostListener</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onBindViewHolder</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="nc">ItemViewHolder</span> <span class="n">holder</span><span class="o">,</span> <span class="kt">int</span> <span class="n">position</span><span class="o">){</span>
        <span class="n">holder</span><span class="o">.</span><span class="na">imageView</span><span class="o">.</span><span class="na">setImageBitmap</span><span class="o">(</span><span class="n">albums</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">position</span><span class="o">).</span><span class="na">getImg</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getItemCount</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">albums</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setItems</span><span class="o">(</span><span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Album</span><span class="o">&gt;</span> <span class="n">albums</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">albums</span> <span class="o">=</span> <span class="n">albums</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">OnPostListener</span><span class="o">{</span>
        <span class="kt">void</span> <span class="nf">onPostClick</span><span class="o">(</span><span class="kt">int</span> <span class="n">pos</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p>위의 어댑터는 Profile 정보를 뿌려주기 위해 사용되는데 onCreateViewHolder가 호출이 되면 ItemViewHolder의 생성자가 호출이 되면서 layout_post_img 레이아웃 상에 존재하는 뷰에 대한 할당을 진행한다. 위의 예제에서는 imageView에 대한 정보를 가져온 뒤, itemView 자체에 onClickListener를 추가해준다. 그리고 이 onClick이벤트는 OnPostListener 인터페이스에 정의된 onPostClick 이벤트를 발생시키는데 getAdapterPostion의 결과를 넘김으로써 adapter에서 몇 번째 viewHolder를 가리키는지를 결과로 돌려준다. Bind 될 시 onBindViewHolder가 호출이 되면서 생성시 정의된 imageView의 이미지를 바꿔주는 역할을 수행한다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProfileFragment</span> <span class="kd">extends</span> <span class="nc">Fragment</span> <span class="o">{</span>
    <span class="nc">RecyclerView</span> <span class="n">v_recycle</span><span class="o">;</span>
    <span class="nc">ProfileRecyclerAdapter</span> <span class="n">adapter</span><span class="o">;</span>
    <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Album</span><span class="o">&gt;</span> <span class="n">albums</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
    <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">album_urls</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
    <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">records</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="nc">Token</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">cnt</span><span class="o">;</span>

    <span class="nd">@Nullable</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">View</span> <span class="nf">onCreateView</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="nc">LayoutInflater</span> <span class="n">inflater</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="nc">ViewGroup</span> <span class="n">container</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="nc">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreateView</span><span class="o">(</span><span class="n">inflater</span><span class="o">,</span> <span class="n">container</span><span class="o">,</span> <span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="nc">View</span> <span class="n">view</span> <span class="o">=</span> <span class="n">inflater</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">fragment_profile</span><span class="o">,</span> <span class="n">container</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">view</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onViewCreated</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="nc">View</span> <span class="n">view</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="nc">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onViewCreated</span><span class="o">(</span><span class="n">view</span><span class="o">,</span> <span class="n">savedInstanceState</span><span class="o">);</span>

        <span class="n">v_recycle</span> <span class="o">=</span> <span class="o">(</span><span class="nc">RecyclerView</span><span class="o">)</span> <span class="n">view</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">recycle_pic</span><span class="o">);</span>

        <span class="nc">LinearLayoutManager</span> <span class="n">linearLayoutManager</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GridLayoutManager</span><span class="o">(</span><span class="n">getActivity</span><span class="o">(),</span> <span class="mi">4</span><span class="o">);</span>
        <span class="n">v_recycle</span><span class="o">.</span><span class="na">setLayoutManager</span><span class="o">(</span><span class="n">linearLayoutManager</span><span class="o">);</span>

        <span class="n">album_urls</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

        <span class="kd">final</span> <span class="nc">OkHttpClient</span> <span class="n">okHttpClient2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OkHttpClient</span><span class="o">.</span><span class="na">Builder</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
        <span class="nc">ApolloClient</span> <span class="n">apolloClient2</span> <span class="o">=</span> <span class="nc">ApolloClient</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">serverUrl</span><span class="o">(</span><span class="n">getString</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">api_url</span><span class="o">)).</span><span class="na">okHttpClient</span><span class="o">(</span><span class="n">okHttpClient2</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

        <span class="nc">Token</span> <span class="o">=</span> <span class="nc">Session</span><span class="o">.</span><span class="na">getCurrentSession</span><span class="o">().</span><span class="na">getTokenInfo</span><span class="o">().</span><span class="na">getAccessToken</span><span class="o">();</span>
        <span class="kd">final</span> <span class="nc">PictureTypeQuery</span> <span class="n">p</span> <span class="o">=</span> <span class="nc">PictureTypeQuery</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">accessToken</span><span class="o">(</span><span class="nc">Token</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

        <span class="n">apolloClient2</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">p</span><span class="o">).</span><span class="na">enqueue</span><span class="o">(</span><span class="k">new</span> <span class="nc">ApolloCall</span><span class="o">.</span><span class="na">Callback</span><span class="o">&lt;</span><span class="nc">PictureTypeQuery</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResponse</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">Response</span><span class="o">&lt;</span><span class="nc">PictureTypeQuery</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">cnt</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">pics</span><span class="o">().</span><span class="na">size</span><span class="o">();</span>

                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cnt</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="nc">String</span> <span class="n">album_url</span> <span class="o">=</span> <span class="n">getString</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">media_url</span><span class="o">)</span> <span class="o">+</span> <span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">pics</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">pic</span><span class="o">;</span>
                    <span class="nc">Integer</span> <span class="n">record_idx</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">pics</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">recordId</span><span class="o">;</span>
                    <span class="n">album_urls</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">album_url</span><span class="o">);</span>
                    <span class="n">records</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">record_idx</span><span class="o">);</span>
                <span class="o">}</span>

                <span class="k">try</span> <span class="o">{</span>
                    <span class="n">addAlbum</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">ExecutionException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>

                <span class="nc">Thread</span> <span class="n">mThread</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">()</span> <span class="o">{</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                        <span class="k">try</span> <span class="o">{</span>
                            <span class="n">getActivity</span><span class="o">().</span><span class="na">runOnUiThread</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span><span class="o">()</span> <span class="o">{</span>
                                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                                    <span class="nc">ProfileRecyclerAdapter</span><span class="o">.</span><span class="na">OnPostListener</span> <span class="n">mPostListener</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ProfileRecyclerAdapter</span><span class="o">.</span><span class="na">OnPostListener</span><span class="o">()</span> <span class="o">{</span>
                                        <span class="nd">@Override</span>
                                        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onPostClick</span><span class="o">(</span><span class="kt">int</span> <span class="n">pos</span><span class="o">)</span> <span class="o">{</span>
                                            <span class="kt">int</span> <span class="n">record</span> <span class="o">=</span> <span class="n">albums</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pos</span><span class="o">).</span><span class="na">getRecord</span><span class="o">();</span>
                                            <span class="nc">String</span> <span class="n">username</span> <span class="o">=</span> <span class="o">((</span><span class="nc">ProfileActivity</span><span class="o">)</span><span class="n">getActivity</span><span class="o">()).</span><span class="na">username</span><span class="o">;</span>
                                            <span class="nc">Intent</span> <span class="n">userPostIntent</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Intent</span><span class="o">(</span><span class="n">getActivity</span><span class="o">(),</span> <span class="nc">UserPostActivity</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
                                            <span class="n">userPostIntent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"username"</span><span class="o">,</span> <span class="n">username</span><span class="o">);</span>
                                            <span class="n">userPostIntent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"pos"</span><span class="o">,</span> <span class="n">pos</span><span class="o">);</span>
                                            <span class="n">userPostIntent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"record"</span><span class="o">,</span> <span class="n">record</span><span class="o">);</span>
                                            <span class="n">startActivity</span><span class="o">(</span><span class="n">userPostIntent</span><span class="o">);</span>
                                        <span class="o">}</span>
                                    <span class="o">};</span>

                                    <span class="n">adapter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ProfileRecyclerAdapter</span><span class="o">(</span><span class="n">albums</span><span class="o">,</span> <span class="n">getContext</span><span class="o">(),</span> <span class="n">mPostListener</span><span class="o">);</span>
                                    <span class="n">v_recycle</span><span class="o">.</span><span class="na">setAdapter</span><span class="o">(</span><span class="n">adapter</span><span class="o">);</span>
                                <span class="o">}</span>
                            <span class="o">});</span>
                        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="o">}</span>
                    <span class="o">}</span>
                <span class="o">};</span>

                <span class="n">mThread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
            <span class="o">}</span>


            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFailure</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">ApolloException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>

            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStart</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onStart</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onActivityCreated</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="nc">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onActivityCreated</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">addAlbum</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">ExecutionException</span><span class="o">,</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">cnt</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="nc">String</span> <span class="n">album_url</span> <span class="o">=</span> <span class="n">album_urls</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
            <span class="nc">Bitmap</span> <span class="n">bitmap</span> <span class="o">=</span> <span class="nc">Glide</span>
                    <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">getActivity</span><span class="o">())</span>
                    <span class="o">.</span><span class="na">asBitmap</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">album_url</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">submit</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>
            <span class="n">albums</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Album</span><span class="o">(</span><span class="n">bitmap</span><span class="o">,</span> <span class="n">records</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">)));</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p>위의 Fragment는 ProfileActivity내부에서 동작할 프래그먼트에 대한 정의로 onCreate부터 시작하는 Activity와 다르게 onCreateView부터 라이프 사이클이 시작하게 된다. 마찬가지로 layout을 가져와 inflate를 진행한 뒤 onViewCreated에 생성시 진행할 동작을 정의한다. 이 부분에서 recyclerView에 대한 처리가 이루어지는데 해당 부분이 그에 해당된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">v_recycle</span> <span class="o">=</span> <span class="o">(</span><span class="nc">RecyclerView</span><span class="o">)</span> <span class="n">view</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">recycle_pic</span><span class="o">);</span>

<span class="nc">LinearLayoutManager</span> <span class="n">linearLayoutManager</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GridLayoutManager</span><span class="o">(</span><span class="n">getActivity</span><span class="o">(),</span> <span class="mi">4</span><span class="o">);</span>
<span class="n">v_recycle</span><span class="o">.</span><span class="na">setLayoutManager</span><span class="o">(</span><span class="n">linearLayoutManager</span><span class="o">);</span>
</code></pre></div></div>

<p>v_recycle은 리사이클러뷰를 가져온 것이며 linearLayoutManager로 선언된 해당 부분을 통해 어떤식으로 RecyclerView를 표현할 것인지를 정하게 된다. 해당 예제에서는 Grid 형태로 한 줄에 4개의 아이템만을 가지도록 설정을 한 것이며 다른 조건을 넣게 되면 가로 또는 세로의 형태로 리스트 뷰를 생성할 수 있다. 이렇게 생성된 레이아웃 매니저를 v_recycle에 붙힘으로써 표현하는 방법에 대한 정의가 끝나게 된다. apolloclient 부분에서는 서버로부터 정보를 가져와 처리하는 부분으로 뷰처리를 하는 부분은 다음과 같다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">ProfileRecyclerAdapter</span><span class="o">.</span><span class="na">OnPostListener</span> <span class="n">mPostListener</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ProfileRecyclerAdapter</span><span class="o">.</span><span class="na">OnPostListener</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onPostClick</span><span class="o">(</span><span class="kt">int</span> <span class="n">pos</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">record</span> <span class="o">=</span> <span class="n">albums</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pos</span><span class="o">).</span><span class="na">getRecord</span><span class="o">();</span>
        <span class="nc">String</span> <span class="n">username</span> <span class="o">=</span> <span class="o">((</span><span class="nc">ProfileActivity</span><span class="o">)</span><span class="n">getActivity</span><span class="o">()).</span><span class="na">username</span><span class="o">;</span>
        <span class="nc">Intent</span> <span class="n">userPostIntent</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Intent</span><span class="o">(</span><span class="n">getActivity</span><span class="o">(),</span> <span class="nc">UserPostActivity</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">userPostIntent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"username"</span><span class="o">,</span> <span class="n">username</span><span class="o">);</span>
        <span class="n">userPostIntent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"pos"</span><span class="o">,</span> <span class="n">pos</span><span class="o">);</span>
        <span class="n">userPostIntent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"record"</span><span class="o">,</span> <span class="n">record</span><span class="o">);</span>
        <span class="n">startActivity</span><span class="o">(</span><span class="n">userPostIntent</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">};</span>

<span class="n">adapter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ProfileRecyclerAdapter</span><span class="o">(</span><span class="n">albums</span><span class="o">,</span> <span class="n">getContext</span><span class="o">(),</span> <span class="n">mPostListener</span><span class="o">);</span>
<span class="n">v_recycle</span><span class="o">.</span><span class="na">setAdapter</span><span class="o">(</span><span class="n">adapter</span><span class="o">);</span>
</code></pre></div></div>

<p>onClickEvent를 발생시키기 위해서 OnPostListener 인터페이스를 생성하였었다. onPostClick은 사용자가 RecyclerView의 특정 위치의 아이템을 눌렀을 때 처리할 절차를 정의하기 위해 사용되는데 pos라는 파라미터가 getAdapterPosition의 결과로 몇 번째 인덱스에서 클릭 이벤트가 발생하였는지를 알려준다. 해당 인덱스를 기준으로 처리할 내용을 구현하였는데 record 번호를 가져와 해당 Post 정보를 보여주는 액티비티를 실행하는데 사용된다.</p>

<p>이렇게 mPostListener가 정의가 되면 adapter를 생성하는데 앞서 정의한 adapter를 RecyclerView에 추가하기만 하면 된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProfileActivity</span> <span class="kd">extends</span> <span class="nc">FragmentActivity</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">FragmentManager</span> <span class="n">fragmentManager</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">ProfileFragment</span> <span class="n">fragmentA</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">FragmentTransaction</span> <span class="n">transaction</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">RecyclerView</span> <span class="n">v_recycle</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">ProfileRecyclerAdapter</span> <span class="n">adapter</span><span class="o">;</span>

    <span class="nc">String</span><span class="o">[]</span> <span class="no">PERMISSIONS</span> <span class="o">=</span> <span class="o">{</span>
            <span class="n">android</span><span class="o">.</span><span class="na">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">CAMERA</span><span class="o">,</span>
            <span class="n">android</span><span class="o">.</span><span class="na">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">READ_EXTERNAL_STORAGE</span><span class="o">,</span>
            <span class="n">android</span><span class="o">.</span><span class="na">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">WRITE_EXTERNAL_STORAGE</span>
    <span class="o">};</span>

    <span class="nd">@SuppressLint</span><span class="o">(</span><span class="s">"StringFormatInvalid"</span><span class="o">)</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="nc">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_profile</span><span class="o">);</span>

        <span class="n">setBtn</span><span class="o">();</span>

        <span class="n">fragmentManager</span> <span class="o">=</span> <span class="n">getSupportFragmentManager</span><span class="o">();</span>
        <span class="n">fragmentA</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ProfileFragment</span><span class="o">();</span>
        <span class="n">transaction</span> <span class="o">=</span> <span class="n">fragmentManager</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
        <span class="n">transaction</span><span class="o">.</span><span class="na">replace</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">frame_A</span><span class="o">,</span> <span class="n">fragmentA</span><span class="o">).</span><span class="na">commitAllowingStateLoss</span><span class="o">();</span>

    <span class="o">}</span>
</code></pre></div></div>

<p>Fragment의 경우 Activity에서 FragmentManager를 생성한 뒤 beginTransaction을 통해 화면에 표현할 수 있다. 그리고 replace를 통해 Fragment을 갈아끼우는 것이 가능하다.</p>

<p><img src="https://raw.githubusercontent.com/wizleysw/wizleysw.github.io/master/_posts/img/aintstagram/ProfileActivity.png" alt="profile" /></p>

<h3 id="검색기능-구현하기">검색기능 구현하기</h3>

<p>검색 기능은 다른 사용자의 닉네임을 검색함으로써 존재하는지 여부를 쿼리하여 뿌려주는 부분을 의미하는데 해당 부분을 구현을 위해 SearchResultFrament를 추가하였다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SearchResultFragment</span> <span class="kd">extends</span> <span class="nc">Fragment</span><span class="o">{</span>
    <span class="nc">RecyclerView</span> <span class="n">v_recycle</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">SearchRecyclerAdapter</span> <span class="n">adapter</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">SearchCard</span><span class="o">&gt;</span> <span class="n">cards</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="nc">Token</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">cnt</span><span class="o">;</span>

    <span class="nd">@Nullable</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">View</span> <span class="nf">onCreateView</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="nc">LayoutInflater</span> <span class="n">inflater</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="nc">ViewGroup</span> <span class="n">container</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="nc">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreateView</span><span class="o">(</span><span class="n">inflater</span><span class="o">,</span> <span class="n">container</span><span class="o">,</span> <span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="nc">View</span> <span class="n">view</span> <span class="o">=</span> <span class="n">inflater</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">fragment_search_result</span><span class="o">,</span> <span class="n">container</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">view</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onViewCreated</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="nc">View</span> <span class="n">view</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="nc">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onViewCreated</span><span class="o">(</span><span class="n">view</span><span class="o">,</span> <span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">v_recycle</span> <span class="o">=</span> <span class="o">(</span><span class="nc">RecyclerView</span><span class="o">)</span> <span class="n">view</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">recycle_card</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">RenewView</span><span class="o">(</span><span class="nc">String</span> <span class="n">input</span><span class="o">){</span>
        <span class="nc">LinearLayoutManager</span> <span class="n">linearLayoutManager</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LinearLayoutManager</span><span class="o">(</span><span class="n">getActivity</span><span class="o">(),</span> <span class="nc">LinearLayoutManager</span><span class="o">.</span><span class="na">VERTICAL</span><span class="o">,</span> <span class="kc">false</span><span class="o">);;</span>
        <span class="n">v_recycle</span><span class="o">.</span><span class="na">setLayoutManager</span><span class="o">(</span><span class="n">linearLayoutManager</span><span class="o">);</span>

        <span class="n">cards</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>

        <span class="kd">final</span> <span class="nc">OkHttpClient</span> <span class="n">okHttpClient2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OkHttpClient</span><span class="o">.</span><span class="na">Builder</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
        <span class="nc">ApolloClient</span> <span class="n">apolloClient</span> <span class="o">=</span> <span class="nc">ApolloClient</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">serverUrl</span><span class="o">(</span><span class="n">getString</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">api_url</span><span class="o">)).</span><span class="na">okHttpClient</span><span class="o">(</span><span class="n">okHttpClient2</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
        <span class="nc">Token</span> <span class="o">=</span> <span class="nc">Session</span><span class="o">.</span><span class="na">getCurrentSession</span><span class="o">().</span><span class="na">getTokenInfo</span><span class="o">().</span><span class="na">getAccessToken</span><span class="o">();</span>
        <span class="kd">final</span> <span class="nc">UserTypeQuery</span> <span class="n">p</span> <span class="o">=</span> <span class="nc">UserTypeQuery</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">name</span><span class="o">(</span><span class="n">input</span><span class="o">).</span><span class="na">accessToken</span><span class="o">(</span><span class="nc">Token</span><span class="o">).</span><span class="na">search</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

        <span class="n">apolloClient</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">p</span><span class="o">).</span><span class="na">enqueue</span><span class="o">(</span><span class="k">new</span> <span class="nc">ApolloCall</span><span class="o">.</span><span class="na">Callback</span><span class="o">&lt;</span><span class="nc">UserTypeQuery</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResponse</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">Response</span><span class="o">&lt;</span><span class="nc">UserTypeQuery</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">cnt</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">users</span><span class="o">().</span><span class="na">size</span><span class="o">();</span>

                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cnt</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="nc">String</span> <span class="n">profile_url</span> <span class="o">=</span> <span class="n">getString</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">media_url</span><span class="o">)</span> <span class="o">+</span> <span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">users</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">profile</span><span class="o">;</span>
                    <span class="nc">String</span> <span class="n">name</span> <span class="o">=</span>  <span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">users</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">name</span><span class="o">;</span>
                    <span class="nc">String</span> <span class="n">comment</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">users</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">textComment</span><span class="o">;</span>
                    <span class="nc">Bitmap</span> <span class="n">bitmap</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                    <span class="k">try</span> <span class="o">{</span>
                        <span class="n">bitmap</span> <span class="o">=</span> <span class="nc">Glide</span>
                                <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">getActivity</span><span class="o">())</span>
                                <span class="o">.</span><span class="na">asBitmap</span><span class="o">()</span>
                                <span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">profile_url</span><span class="o">)</span>
                                <span class="o">.</span><span class="na">submit</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">bitmap</span> <span class="o">=</span> <span class="o">((</span><span class="nc">BitmapDrawable</span><span class="o">)</span><span class="n">getResources</span><span class="o">().</span><span class="na">getDrawable</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">userinfo</span><span class="o">)).</span><span class="na">getBitmap</span><span class="o">();</span>
                    <span class="o">}</span>
                    <span class="n">cards</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">SearchCard</span><span class="o">(</span><span class="n">bitmap</span><span class="o">,</span> <span class="n">name</span><span class="o">,</span> <span class="n">comment</span><span class="o">));</span>
                <span class="o">}</span>

                <span class="nc">Thread</span> <span class="n">mThread</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">()</span> <span class="o">{</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                        <span class="k">try</span> <span class="o">{</span>
                            <span class="n">getActivity</span><span class="o">().</span><span class="na">runOnUiThread</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span><span class="o">()</span> <span class="o">{</span>
                                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                                    <span class="nc">SearchRecyclerAdapter</span><span class="o">.</span><span class="na">OnCardListener</span> <span class="n">mCardListener</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SearchRecyclerAdapter</span><span class="o">.</span><span class="na">OnCardListener</span><span class="o">()</span> <span class="o">{</span>
                                        <span class="nd">@Override</span>
                                        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCardClick</span><span class="o">(</span><span class="kt">int</span> <span class="n">pos</span><span class="o">)</span> <span class="o">{</span>
                                            <span class="nc">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">cards</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pos</span><span class="o">).</span><span class="na">getName</span><span class="o">();</span>

                                            <span class="nc">Intent</span> <span class="n">profileIntent</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Intent</span><span class="o">(</span><span class="n">getContext</span><span class="o">().</span><span class="na">getApplicationContext</span><span class="o">(),</span> <span class="nc">SearchResultProfileActivity</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
                                            <span class="n">profileIntent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"username"</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
                                            <span class="n">startActivity</span><span class="o">(</span><span class="n">profileIntent</span><span class="o">);</span>

                                        <span class="o">}</span>
                                    <span class="o">};</span>

                                    <span class="n">adapter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SearchRecyclerAdapter</span><span class="o">(</span><span class="n">cards</span><span class="o">,</span> <span class="n">getContext</span><span class="o">(),</span> <span class="n">mCardListener</span><span class="o">);</span>
                                    <span class="n">v_recycle</span><span class="o">.</span><span class="na">setAdapter</span><span class="o">(</span><span class="n">adapter</span><span class="o">);</span>
                                <span class="o">}</span>
                            <span class="o">});</span>
                        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="o">}</span>
                    <span class="o">}</span>
                <span class="o">};</span>

                <span class="n">mThread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFailure</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">ApolloException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>

            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>전체적인 그림은 Profile쪽과 비슷한데 UserTypeQery를 사용해서 해당 이름이 포함되어있는 유저에 대한 List를 돌려받아 cards에 추가해 준뒤 click이벤트와 함께 정의해주었다. 이제 문제는 어떻게 query할 이름정보를 가져오는가에 달려있다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SearchActivity</span> <span class="kd">extends</span> <span class="nc">FragmentActivity</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">REQUEST_TAKE_ALBUM</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">ImageButton</span> <span class="n">btn_add</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">ImageButton</span> <span class="n">btn_profile</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">ImageButton</span> <span class="n">btn_home</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">ImageButton</span> <span class="n">btn_search</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">ImageButton</span> <span class="n">btn_history</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Button</span> <span class="n">btn_cancel</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">EditText</span> <span class="n">searchBar</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">FragmentManager</span> <span class="n">fragmentManager</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">SearchResultFragment</span> <span class="n">fragmentB</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">FragmentTransaction</span> <span class="n">transaction</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="nc">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_search</span><span class="o">);</span>

        <span class="n">fragmentManager</span> <span class="o">=</span> <span class="n">getSupportFragmentManager</span><span class="o">();</span>
        <span class="n">fragmentB</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SearchResultFragment</span><span class="o">();</span>
        <span class="n">transaction</span> <span class="o">=</span> <span class="n">fragmentManager</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
        <span class="n">transaction</span><span class="o">.</span><span class="na">replace</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">frame_search</span><span class="o">,</span> <span class="n">fragmentB</span><span class="o">).</span><span class="na">commitAllowingStateLoss</span><span class="o">();</span>

        <span class="n">searchBar</span> <span class="o">=</span> <span class="o">(</span><span class="nc">EditText</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">search_bar</span><span class="o">);</span>
        <span class="n">searchBar</span><span class="o">.</span><span class="na">setOnFocusChangeListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">View</span><span class="o">.</span><span class="na">OnFocusChangeListener</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFocusChange</span><span class="o">(</span><span class="nc">View</span> <span class="n">v</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">hasFocus</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">Button</span> <span class="n">cancel</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Button</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button_cancel</span><span class="o">);</span>
                <span class="k">if</span><span class="o">(</span><span class="n">hasFocus</span><span class="o">){</span>
                    <span class="n">cancel</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="no">VISIBLE</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    <span class="n">cancel</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="nc">View</span><span class="o">.</span><span class="na">INVISIBLE</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">});</span>

        <span class="n">searchBar</span><span class="o">.</span><span class="na">addTextChangedListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">TextWatcher</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">beforeTextChanged</span><span class="o">(</span><span class="nc">CharSequence</span> <span class="n">s</span><span class="o">,</span> <span class="kt">int</span> <span class="n">start</span><span class="o">,</span> <span class="kt">int</span> <span class="n">count</span><span class="o">,</span> <span class="kt">int</span> <span class="n">after</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// 입력 전</span>
            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onTextChanged</span><span class="o">(</span><span class="nc">CharSequence</span> <span class="n">s</span><span class="o">,</span> <span class="kt">int</span> <span class="n">start</span><span class="o">,</span> <span class="kt">int</span> <span class="n">before</span><span class="o">,</span> <span class="kt">int</span> <span class="n">count</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">fragmentB</span><span class="o">.</span><span class="na">RenewView</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
                <span class="c1">// 입력되는 중</span>
            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterTextChanged</span><span class="o">(</span><span class="nc">Editable</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// 입력 완료</span>
            <span class="o">}</span>
        <span class="o">});</span>

        <span class="n">setBtn</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p>Fragment의 본체가 되는 Activity 부분을 보면 EditText인 searchBar 부분에 TextWatcher를 추가하였다. 이를 통하여 입력 이벤트가 발생할 때마다 fragment의 RenewView 메소드가 호출이 되며 그 인자 값으로 사용자의 입력값 데이터가 넘어가서 graphql로의 쿼리가 전송된다. 이를 통해 실시간으로 사용자의 입력 결과를 토대로 사용자조회가 가능하다.</p>

<p><img src="https://raw.githubusercontent.com/wizleysw/wizleysw.github.io/master/_posts/img/aintstagram/Search.png" alt="search" /></p>

<p>이렇게 가져온 정보를 입력하면 다음과 같이 해당 유저의 정보를 확인할 수 있다.</p>

<p><img src="https://raw.githubusercontent.com/wizleysw/wizleysw.github.io/master/_posts/img/aintstagram/Friend.png" alt="friend" /></p>

<h3 id="recyclerview에-onclick-인터페이스-구현하기">RecyclerView에 OnClick 인터페이스 구현하기</h3>

<p>위의 코드에서 언급이 되긴 하였지만 이를 구현하는데 시간을 꽤 소모하였기에 다시 한번 남기자면 RecyclerView에 사용할 adapter를 생성하는 과정에서 onClickListener를 추가할 수 있다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">View</span><span class="o">.</span><span class="na">OnClickListener</span> <span class="n">listener</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">(){</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="nc">View</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">switch</span> <span class="o">(</span><span class="n">v</span><span class="o">.</span><span class="na">getId</span><span class="o">()){</span>
            <span class="k">case</span> <span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">btn_edit_post</span><span class="o">:</span>
                <span class="n">onPostListener</span><span class="o">.</span><span class="na">onPostClick</span><span class="o">(</span><span class="n">getAdapterPosition</span><span class="o">(),</span> <span class="mi">1</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">btn_heart</span><span class="o">:</span>
                <span class="n">onPostListener</span><span class="o">.</span><span class="na">onPostClick</span><span class="o">(</span><span class="n">getAdapterPosition</span><span class="o">(),</span> <span class="mi">2</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">btn_comment</span><span class="o">:</span>
            <span class="k">case</span> <span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">comments</span><span class="o">:</span>
                <span class="n">onPostListener</span><span class="o">.</span><span class="na">onPostClick</span><span class="o">(</span><span class="n">getAdapterPosition</span><span class="o">(),</span> <span class="mi">3</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">btn_message</span><span class="o">:</span>
                <span class="n">onPostListener</span><span class="o">.</span><span class="na">onPostClick</span><span class="o">(</span><span class="n">getAdapterPosition</span><span class="o">(),</span> <span class="mi">4</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">post_img</span><span class="o">:</span>
                <span class="n">onPostListener</span><span class="o">.</span><span class="na">onPostClick</span><span class="o">(</span><span class="n">getAdapterPosition</span><span class="o">(),</span> <span class="mi">5</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
        <span class="o">};</span>
</code></pre></div></div>

<p>하지만 여기서 구현의 핵심은 Activity 또는 Fragment에서 해당 이벤트에 대한 처리를 진행하기 위해서는 포지션에 대한 정보를 알고 있어야 한다는 점이다. 이를 위해서 내부적으로 getAdapterPosition을 호출한 결과를 넘겨주어야 되는데 이를 어떤식으로 넘겨줄까에 대한 고민을 많이 하였었다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">OnPostListener</span><span class="o">{</span>
    <span class="kt">void</span> <span class="nf">onPostClick</span><span class="o">(</span><span class="kt">int</span> <span class="n">pos</span><span class="o">,</span> <span class="kt">int</span> <span class="n">choice</span><span class="o">);</span>

    <span class="kt">void</span> <span class="nf">onCommentTyped</span><span class="o">(</span><span class="kt">int</span> <span class="n">pos</span><span class="o">,</span> <span class="nc">Editable</span> <span class="n">value</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>생각한 방법은 인터페이스를 구현하는 것이다. 인터페이스를 구현하여 그 처리부분에 대한 정의를 Activity 또는 Fragment에서 정의해주면 되는 것이었다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">PostRecyclerAdapter</span><span class="o">.</span><span class="na">OnPostListener</span> <span class="n">onPostListener</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PostRecyclerAdapter</span><span class="o">.</span><span class="na">OnPostListener</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onPostClick</span><span class="o">(</span><span class="kd">final</span> <span class="kt">int</span> <span class="n">pos</span><span class="o">,</span> <span class="kt">int</span> <span class="n">choice</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">switch</span><span class="o">(</span><span class="n">choice</span><span class="o">){</span>
            <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
                <span class="nc">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">posts</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pos</span><span class="o">).</span><span class="na">getName</span><span class="o">();</span>
                <span class="nc">Intent</span> <span class="n">profileIntent</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Intent</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="nc">SearchResultProfileActivity</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
                <span class="n">profileIntent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"username"</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
                <span class="n">startActivity</span><span class="o">(</span><span class="n">profileIntent</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
                
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
                
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
                    
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="mi">4</span><span class="o">:</span>
           
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="mi">5</span><span class="o">:</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">(</span><span class="s">"Unexpected value: "</span> <span class="o">+</span> <span class="n">choice</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCommentTyped</span><span class="o">(</span><span class="kt">int</span> <span class="n">pos</span><span class="o">,</span> <span class="nc">Editable</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">record</span> <span class="o">=</span> <span class="n">posts</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pos</span><span class="o">).</span><span class="na">get_post_id</span><span class="o">();</span>
        <span class="n">addComment</span><span class="o">(</span><span class="n">record</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">value</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">};</span>

<span class="n">adapter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PostRecyclerAdapter</span><span class="o">(</span><span class="n">posts</span><span class="o">,</span> <span class="n">getApplicationContext</span><span class="o">(),</span> <span class="n">onPostListener</span><span class="o">);</span>
<span class="n">v_recycle</span><span class="o">.</span><span class="na">setAdapter</span><span class="o">(</span><span class="n">adapter</span><span class="o">);</span>
</code></pre></div></div>

<p>위와 같이 adapter에 추가해주기 전에 인터페이스의 메소드들을 구현해주게 되면 activity에서 position의 정보를 가진 pos 파라미터와 어떤 이벤트로 인해 들어왔는지를 알려주는 choice라는 정보를 토대로 작업을 수행할 수 있다. 작업의 예로는 어떤 버튼에 대한 처리를 구현한다던지, 다른 인텐트를 수행한다던지 하는 것들이 포함된다고 할 수 있다.</p>

<h3 id="constraint-layout-동적으로-visibility-설정하기">Constraint Layout 동적으로 VISIBILITY 설정하기</h3>

<p>이 부분은 같은 레이아웃을 사용하는데 본인인 경우와 본인이 아닌 경우에 버튼 등에 대한 레이아웃을 변경해야 될 경우 사용되었다. 아래의 예제는 ProfileActivity에서 본인일 경우 프로필 수정 버튼을 표시하지만 그 외의 사용자의 경우 팔로우 버튼을 표시하도록 변경하는 것이다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">runOnUiThread</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span><span class="o">(){</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(){</span>
        <span class="nc">ImageView</span> <span class="n">v_profile</span> <span class="o">=</span> <span class="o">(</span><span class="nc">ImageView</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">user_profile</span><span class="o">);</span>
        <span class="n">v_profile</span><span class="o">.</span><span class="na">setImageBitmap</span><span class="o">(</span><span class="n">bitmap</span><span class="o">);</span>

        <span class="k">if</span><span class="o">(</span><span class="n">myKakaoId</span> <span class="o">!=</span> <span class="n">searchKakaoId</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">btn_follow</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Button</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button_follow</span><span class="o">);</span>
            <span class="n">btn_follow</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="nc">View</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">);</span>
            <span class="n">btn_msg</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Button</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button_message</span><span class="o">);</span>
            <span class="n">btn_msg</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="nc">View</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">);</span>
            <span class="n">btn_edit</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Button</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button_edit_profile</span><span class="o">);</span>
            <span class="n">btn_edit</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="nc">View</span><span class="o">.</span><span class="na">GONE</span><span class="o">);</span>
            <span class="nc">ConstraintSet</span> <span class="n">constraintSet</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ConstraintSet</span><span class="o">();</span>
            <span class="nc">ConstraintLayout</span> <span class="n">constraintLayout</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">profile</span><span class="o">);</span>
            <span class="n">constraintSet</span><span class="o">.</span><span class="na">clone</span><span class="o">(</span><span class="n">constraintLayout</span><span class="o">);</span>
            <span class="n">constraintSet</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">my_pics</span><span class="o">,</span> <span class="nc">ConstraintSet</span><span class="o">.</span><span class="na">TOP</span><span class="o">,</span> <span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button_follow</span><span class="o">,</span> <span class="nc">ConstraintSet</span><span class="o">.</span><span class="na">BOTTOM</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
            <span class="n">constraintSet</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">others_pics</span><span class="o">,</span> <span class="nc">ConstraintSet</span><span class="o">.</span><span class="na">TOP</span><span class="o">,</span> <span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button_message</span><span class="o">,</span> <span class="nc">ConstraintSet</span><span class="o">.</span><span class="na">BOTTOM</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
            <span class="n">constraintSet</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="n">constraintLayout</span><span class="o">);</span>

            <span class="n">setRenewedButton</span><span class="o">();</span>
            <span class="n">getFollowInfo</span><span class="o">();</span>
        <span class="o">}</span>

    <span class="o">}</span>
<span class="o">});</span>
</code></pre></div></div>

<p>레이아웃에 대한 처리는 UI Thread에서만 진행하여야 하기 때문에 runOnUiThread를 호출하여 수행하며 위와 같이 ConstraintSet을 정의하여 connect 등의 함수로 재정의 하는 과정을 수행하면 된다.</p>

<h3 id="팔로우언팔로우-기능-구현하기">팔로우/언팔로우 기능 구현하기</h3>

<p>팔로우와 언팔로우 기능을 구현하기 위해서는 graphql에 Mutation 엔드포인트를 추가해주어야 된다. addFollow, unFollow라는 이름의 클래스를 생성하였다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">addFollow</span><span class="p">(</span><span class="n">graphene</span><span class="o">.</span><span class="n">Mutation</span><span class="p">):</span>
    <span class="n">success</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">Boolean</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Arguments</span><span class="p">:</span>
        <span class="n">accessToken</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">fkakaoID</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">Int</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mutate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">accessToken</span><span class="p">,</span> <span class="n">fkakaoID</span><span class="p">):</span>
        <span class="n">kakaoID</span> <span class="o">=</span> <span class="n">get_kakaoID</span><span class="p">(</span><span class="n">accessToken</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kakaoID</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">addFollow</span><span class="p">(</span><span class="n">success</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kakaoID</span> <span class="o">==</span> <span class="n">fkakaoID</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">addFollow</span><span class="p">(</span><span class="n">success</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">user_from</span> <span class="o">=</span> <span class="n">UserModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kakaoID</span><span class="o">=</span><span class="n">kakaoID</span><span class="p">)</span>
            <span class="n">user_to</span> <span class="o">=</span> <span class="n">UserModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kakaoID</span><span class="o">=</span><span class="n">fkakaoID</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">addFollow</span><span class="p">(</span><span class="n">success</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="n">history</span> <span class="o">=</span> <span class="n">FollowModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">user_from__kakaoID</span><span class="o">=</span><span class="n">kakaoID</span><span class="p">,</span> <span class="n">user_to__kakaoID</span><span class="o">=</span><span class="n">fkakaoID</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">history</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">addFollow</span><span class="p">(</span><span class="n">success</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">follow</span> <span class="o">=</span> <span class="n">FollowModel</span><span class="p">(</span><span class="n">user_from</span><span class="o">=</span><span class="n">user_from</span><span class="p">,</span> <span class="n">user_to</span><span class="o">=</span><span class="n">user_to</span><span class="p">)</span>
            <span class="n">follow</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

            <span class="n">addHistory</span> <span class="o">=</span> <span class="n">HistoryModel</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user_to</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">'F'</span><span class="p">,</span> <span class="n">record_id</span><span class="o">=</span><span class="n">follow</span><span class="o">.</span><span class="n">follow_id</span><span class="p">)</span>
            <span class="n">addHistory</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

            <span class="n">user_to</span><span class="o">.</span><span class="n">follower_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">user_to</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

            <span class="n">user_from</span><span class="o">.</span><span class="n">following_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">user_from</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">addFollow</span><span class="p">(</span><span class="n">success</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<p>addFollow의 경우 인자로 accessToken과 fkakaoID를 받는데 accessToken을 토대로 사용자가 존재하는지를 검사한 뒤 타 사용자의 kakaoID와 비교하여 본인일 경우에는 success를 false로 돌려주며 끝내게 된다. 만약 FollowModel 정보가 존재하지 않을 경우 팔로우 정보를 추가해주며 상대방의 follower_count 정보를 더해주고 본인의 following_count 정보를 업데이트한다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">unFollow</span><span class="p">(</span><span class="n">graphene</span><span class="o">.</span><span class="n">Mutation</span><span class="p">):</span>
    <span class="n">success</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">Boolean</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Arguments</span><span class="p">:</span>
        <span class="n">accessToken</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">fkakaoID</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">Int</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">choice</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">Int</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">mutate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">accessToken</span><span class="p">,</span> <span class="n">fkakaoID</span><span class="p">,</span> <span class="n">choice</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">kakaoID</span> <span class="o">=</span> <span class="n">get_kakaoID</span><span class="p">(</span><span class="n">accessToken</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kakaoID</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">addFollow</span><span class="p">(</span><span class="n">success</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kakaoID</span> <span class="o">==</span> <span class="n">fkakaoID</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">addFollow</span><span class="p">(</span><span class="n">success</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">choice</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">user_from</span> <span class="o">=</span> <span class="n">UserModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kakaoID</span><span class="o">=</span><span class="n">kakaoID</span><span class="p">)</span>
                <span class="n">user_to</span> <span class="o">=</span> <span class="n">UserModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kakaoID</span><span class="o">=</span><span class="n">fkakaoID</span><span class="p">)</span>
                <span class="n">history</span> <span class="o">=</span> <span class="n">FollowModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">user_from__kakaoID</span><span class="o">=</span><span class="n">kakaoID</span><span class="p">,</span> <span class="n">user_to__kakaoID</span><span class="o">=</span><span class="n">fkakaoID</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">history</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                    <span class="k">return</span> <span class="n">addFollow</span><span class="p">(</span><span class="n">success</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">user_from</span> <span class="o">=</span> <span class="n">UserModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kakaoID</span><span class="o">=</span><span class="n">fkakaoID</span><span class="p">)</span>
                <span class="n">user_to</span> <span class="o">=</span> <span class="n">UserModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kakaoID</span><span class="o">=</span><span class="n">kakaoID</span><span class="p">)</span>
                <span class="n">history</span> <span class="o">=</span> <span class="n">FollowModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">user_from__kakaoID</span><span class="o">=</span><span class="n">fkakaoID</span><span class="p">,</span> <span class="n">user_to__kakaoID</span><span class="o">=</span><span class="n">kakaoID</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">history</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                    <span class="k">return</span> <span class="n">addFollow</span><span class="p">(</span><span class="n">success</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">addFollow</span><span class="p">(</span><span class="n">success</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">history</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

            <span class="n">user_to</span><span class="o">.</span><span class="n">follower_count</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">user_to</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

            <span class="n">user_from</span><span class="o">.</span><span class="n">following_count</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">user_from</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">addFollow</span><span class="p">(</span><span class="n">success</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<p>unFollow도 addFollow와 비슷한 패턴인데 choice 정보에 따라 follow 또는 following 정보를 지우며 성공할 경우 정보를 업데이트 하고 success를 참으로 리턴해준다.</p>

<div class="language-graphql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">mutation</span><span class="w"> </span><span class="n">add_follow</span><span class="p">(</span><span class="nv">$fkakaoID</span><span class="p">:</span><span class="nb">Int</span><span class="p">!,</span><span class="w"> </span><span class="nv">$accessToken</span><span class="p">:</span><span class="nb">String</span><span class="p">!){</span><span class="w">
    </span><span class="n">addFollow</span><span class="w"> </span><span class="p">(</span><span class="n">fkakaoID</span><span class="p">:</span><span class="nv">$fkakaoID</span><span class="p">,</span><span class="w"> </span><span class="n">accessToken</span><span class="p">:</span><span class="nv">$accessToken</span><span class="p">){</span><span class="w">
        </span><span class="n">success</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>graphql에는 다음과 같이 추가해주고 아래와 같이 사용하면 된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">setRenewedButton</span><span class="o">(){</span>
    <span class="nc">View</span><span class="o">.</span><span class="na">OnClickListener</span> <span class="n">mListener</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@SuppressLint</span><span class="o">(</span><span class="s">"IntentReset"</span><span class="o">)</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="nc">View</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">switch</span><span class="o">(</span><span class="n">v</span><span class="o">.</span><span class="na">getId</span><span class="o">()){</span>
                <span class="k">case</span> <span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button_follow</span><span class="o">:</span>
                    <span class="k">if</span><span class="o">(</span><span class="n">btn_follow</span><span class="o">.</span><span class="na">getText</span><span class="o">()</span> <span class="o">==</span> <span class="s">"팔로우"</span><span class="o">){</span>
                        <span class="kd">final</span> <span class="nc">OkHttpClient</span> <span class="n">okHttpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OkHttpClient</span><span class="o">.</span><span class="na">Builder</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
                        <span class="kd">final</span> <span class="nc">ApolloClient</span> <span class="n">apolloClient</span> <span class="o">=</span> <span class="nc">ApolloClient</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">serverUrl</span><span class="o">(</span><span class="n">getString</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">api_url</span><span class="o">)).</span><span class="na">okHttpClient</span><span class="o">(</span><span class="n">okHttpClient</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
                        <span class="kd">final</span> <span class="n">Add_followMutation</span> <span class="n">f</span> <span class="o">=</span> <span class="n">Add_followMutation</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">accessToken</span><span class="o">(</span><span class="nc">Token</span><span class="o">).</span><span class="na">fkakaoID</span><span class="o">(</span><span class="n">searchKakaoId</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
                        <span class="n">apolloClient</span><span class="o">.</span><span class="na">mutate</span><span class="o">(</span><span class="n">f</span><span class="o">).</span><span class="na">enqueue</span><span class="o">(</span><span class="k">new</span> <span class="nc">ApolloCall</span><span class="o">.</span><span class="na">Callback</span><span class="o">&lt;</span><span class="n">Add_followMutation</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;()</span> <span class="o">{</span>
                            <span class="nd">@Override</span>
                            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResponse</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">Response</span><span class="o">&lt;</span><span class="n">Add_followMutation</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
                                <span class="n">getUserProfile</span><span class="o">();</span>
                                <span class="n">runOnUiThread</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span><span class="o">()</span> <span class="o">{</span>
                                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                                        <span class="nc">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="s">"요청을 완료하였습니다."</span><span class="o">,</span> <span class="nc">Toast</span><span class="o">.</span><span class="na">LENGTH_LONG</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
                                    <span class="o">}</span>
                                <span class="o">});</span>
                            <span class="o">}</span>

                            <span class="nd">@Override</span>
                            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFailure</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">ApolloException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>

                            <span class="o">}</span>
                        <span class="o">});</span>
                    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                        <span class="kd">final</span> <span class="nc">OkHttpClient</span> <span class="n">okHttpClient2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OkHttpClient</span><span class="o">.</span><span class="na">Builder</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
                        <span class="kd">final</span> <span class="nc">ApolloClient</span> <span class="n">apolloClient2</span> <span class="o">=</span> <span class="nc">ApolloClient</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">serverUrl</span><span class="o">(</span><span class="n">getString</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">api_url</span><span class="o">)).</span><span class="na">okHttpClient</span><span class="o">(</span><span class="n">okHttpClient2</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
                        <span class="kd">final</span> <span class="n">Un_followMutation</span> <span class="n">u</span> <span class="o">=</span> <span class="n">Un_followMutation</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">accessToken</span><span class="o">(</span><span class="nc">Token</span><span class="o">).</span><span class="na">fkakaoID</span><span class="o">(</span><span class="n">searchKakaoId</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
                        <span class="n">apolloClient2</span><span class="o">.</span><span class="na">mutate</span><span class="o">(</span><span class="n">u</span><span class="o">).</span><span class="na">enqueue</span><span class="o">(</span><span class="k">new</span> <span class="nc">ApolloCall</span><span class="o">.</span><span class="na">Callback</span><span class="o">&lt;</span><span class="n">Un_followMutation</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;()</span> <span class="o">{</span>
                            <span class="nd">@Override</span>
                            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResponse</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">Response</span><span class="o">&lt;</span><span class="n">Un_followMutation</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
                                <span class="n">getUserProfile</span><span class="o">();</span>
                                <span class="n">runOnUiThread</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span><span class="o">()</span> <span class="o">{</span>
                                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                                        <span class="nc">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="s">"요청을 완료하였습니다."</span><span class="o">,</span> <span class="nc">Toast</span><span class="o">.</span><span class="na">LENGTH_LONG</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
                                    <span class="o">}</span>
                                <span class="o">});</span>
                            <span class="o">}</span>

                            <span class="nd">@Override</span>
                            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFailure</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">ApolloException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>

                            <span class="o">}</span>
                        <span class="o">});</span>
                    <span class="o">}</span>
                    <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">};</span>
    <span class="n">btn_follow</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="n">mListener</span><span class="o">);</span>
<span class="o">};</span>
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/wizleysw/wizleysw.github.io/master/_posts/img/aintstagram/Follow.png" alt="follows" /></p>

<h3 id="filterable-인터페이스-recyclerview에-적용하기">Filterable 인터페이스 Recyclerview에 적용하기</h3>

<p>Filterable은 RecyclerView에서 특정 키워드로 검색을 하기 위하여 사용되었으며 Follower/Following 리스트에서 특정 키워드로 검색하는 기능을 위해 추가되었다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FollowingRecyclerAdapter</span> <span class="kd">extends</span> <span class="nc">RecyclerView</span><span class="o">.</span><span class="na">Adapter</span><span class="o">&lt;</span><span class="nc">FollowingRecyclerAdapter</span><span class="o">.</span><span class="na">ItemViewHolder</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="nc">Filterable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Context</span> <span class="n">context</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">FollowCard</span><span class="o">&gt;</span> <span class="n">cards</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">OnCardListener</span> <span class="n">onCardListener</span><span class="o">;</span>

    <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">FollowCard</span><span class="o">&gt;</span> <span class="n">unFilteredlist</span><span class="o">;</span>
    <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">FollowCard</span><span class="o">&gt;</span> <span class="n">filteredList</span><span class="o">;</span>

    <span class="o">...</span> <span class="n">생략</span> <span class="o">...</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Filter</span> <span class="nf">getFilter</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Filter</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">protected</span> <span class="nc">FilterResults</span> <span class="nf">performFiltering</span><span class="o">(</span><span class="nc">CharSequence</span> <span class="n">constraint</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">String</span> <span class="n">charString</span> <span class="o">=</span> <span class="n">constraint</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
                <span class="k">if</span><span class="o">(</span><span class="n">charString</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
                    <span class="n">filteredList</span> <span class="o">=</span> <span class="n">unFilteredlist</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">FollowCard</span><span class="o">&gt;</span> <span class="n">filteringList</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
                    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">unFilteredlist</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                        <span class="k">if</span><span class="o">(</span><span class="n">unFilteredlist</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">getName</span><span class="o">().</span><span class="na">toLowerCase</span><span class="o">().</span><span class="na">contains</span><span class="o">(</span><span class="n">charString</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">()))</span> <span class="o">{</span>
                            <span class="n">filteringList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">unFilteredlist</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
                        <span class="o">}</span>
                    <span class="o">}</span>
                    <span class="n">filteredList</span> <span class="o">=</span> <span class="n">filteringList</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="nc">FilterResults</span> <span class="n">filterResults</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FilterResults</span><span class="o">();</span>
                <span class="n">filterResults</span><span class="o">.</span><span class="na">values</span> <span class="o">=</span> <span class="n">filteredList</span><span class="o">;</span>
                <span class="k">return</span> <span class="n">filterResults</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">publishResults</span><span class="o">(</span><span class="nc">CharSequence</span> <span class="n">constraint</span><span class="o">,</span> <span class="nc">FilterResults</span> <span class="n">results</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">filteredList</span> <span class="o">=</span> <span class="o">(</span><span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">FollowCard</span><span class="o">&gt;)</span><span class="n">results</span><span class="o">.</span><span class="na">values</span><span class="o">;</span>
                <span class="n">setItem</span><span class="o">(</span><span class="n">filteredList</span><span class="o">);</span>
                <span class="n">notifyDataSetChanged</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">};</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>adapter에 Filterable 인터페이스를 추가하여 getFilter 부분을 오버라이딩 하였다. constraint로 들어온 문자열을 토대로 getName()을 한 값에 해당 문자열이 포함되어 있을 경우에 filteringList에 추가해주며 작업이 완료되면 해당 결과를 setItem한 뒤 notifyDataChanged를 호출하여 RecyclerView가 최신화되도록 한다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">searchBar</span> <span class="o">=</span> <span class="o">(</span><span class="nc">EditText</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">search_bar</span><span class="o">);</span>

<span class="n">searchBar</span><span class="o">.</span><span class="na">addTextChangedListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">TextWatcher</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">beforeTextChanged</span><span class="o">(</span><span class="nc">CharSequence</span> <span class="n">s</span><span class="o">,</span> <span class="kt">int</span> <span class="n">start</span><span class="o">,</span> <span class="kt">int</span> <span class="n">count</span><span class="o">,</span> <span class="kt">int</span> <span class="n">after</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 입력 전</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onTextChanged</span><span class="o">(</span><span class="nc">CharSequence</span> <span class="n">s</span><span class="o">,</span> <span class="kt">int</span> <span class="n">start</span><span class="o">,</span> <span class="kt">int</span> <span class="n">before</span><span class="o">,</span> <span class="kt">int</span> <span class="n">count</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">switch</span><span class="o">(</span><span class="n">choice</span><span class="o">){</span>
            <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
                <span class="n">followerFragment</span><span class="o">.</span><span class="na">filterSeq</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
                <span class="n">followingFragment</span><span class="o">.</span><span class="na">filterSeq</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
        <span class="o">}</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterTextChanged</span><span class="o">(</span><span class="nc">Editable</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">}</span>
<span class="o">});</span>
</code></pre></div></div>

<p>EditText부분에 사용자 검색과 마찬가지로 onTextChanged 부분을 오버라이딩 하여 filterSeq를 호출하면 된다.</p>

<h3 id="post의-정보-업데이트-하기">Post의 정보 업데이트 하기</h3>

<p>Post부분을 구현하기 위해서는 사용자가 follow하는 모든 사용자의 Post 정보를 시간순으로 가져와야 된다. 그리고 그와 연관된 Like, Comment등에 대한 정보를 graphql에 요청하여 가져와야 된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">getPosts</span><span class="o">(){</span>
    <span class="n">posts</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
    <span class="n">threads</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

    <span class="kd">final</span> <span class="nc">OkHttpClient</span> <span class="n">okHttpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OkHttpClient</span><span class="o">.</span><span class="na">Builder</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
    <span class="kd">final</span> <span class="nc">ApolloClient</span> <span class="n">apolloClient</span> <span class="o">=</span> <span class="nc">ApolloClient</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">serverUrl</span><span class="o">(</span><span class="n">getString</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">api_url</span><span class="o">)).</span><span class="na">okHttpClient</span><span class="o">(</span><span class="n">okHttpClient</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
    <span class="nc">Token</span> <span class="o">=</span> <span class="nc">Session</span><span class="o">.</span><span class="na">getCurrentSession</span><span class="o">().</span><span class="na">getTokenInfo</span><span class="o">().</span><span class="na">getAccessToken</span><span class="o">();</span>

    <span class="kd">final</span> <span class="nc">PostTypeQuery</span> <span class="n">q</span> <span class="o">=</span> <span class="nc">PostTypeQuery</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">accessToken</span><span class="o">(</span><span class="nc">Token</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

    <span class="n">apolloClient</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">q</span><span class="o">).</span><span class="na">enqueue</span><span class="o">(</span><span class="k">new</span> <span class="nc">ApolloCall</span><span class="o">.</span><span class="na">Callback</span><span class="o">&lt;</span><span class="nc">PostTypeQuery</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="nd">@RequiresApi</span><span class="o">(</span><span class="n">api</span> <span class="o">=</span> <span class="nc">Build</span><span class="o">.</span><span class="na">VERSION_CODES</span><span class="o">.</span><span class="na">O</span><span class="o">)</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResponse</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">Response</span><span class="o">&lt;</span><span class="nc">PostTypeQuery</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">cnt</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">posts</span><span class="o">().</span><span class="na">size</span><span class="o">();</span>

            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">cnt</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
                <span class="nc">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">posts</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">user</span><span class="o">().</span><span class="na">name</span><span class="o">;</span>
                <span class="nc">String</span> <span class="n">place</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">posts</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">place</span><span class="o">;</span>
                <span class="nc">String</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">getString</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">media_url</span><span class="o">)</span> <span class="o">+</span> <span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">posts</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">user</span><span class="o">().</span><span class="na">profile</span><span class="o">;</span>
                <span class="nc">Integer</span> <span class="n">postId</span> <span class="o">=</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">posts</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">postId</span><span class="o">);</span>
                <span class="kt">int</span> <span class="n">likes</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">posts</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">likeCount</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">comments</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">posts</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">commentCount</span><span class="o">;</span>
                <span class="nc">String</span> <span class="n">textComment</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">posts</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">textComment</span><span class="o">;</span>
                <span class="nc">String</span> <span class="n">dt</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">posts</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">date</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
                <span class="nc">ZonedDateTime</span> <span class="n">zdt</span> <span class="o">=</span> <span class="nc">ZonedDateTime</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">dt</span><span class="o">);</span>
                <span class="nc">ZonedDateTime</span> <span class="n">now</span> <span class="o">=</span> <span class="nc">ZonedDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">(</span><span class="nc">ZoneId</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"Asia/Seoul"</span><span class="o">));</span>
                <span class="kt">long</span> <span class="n">days</span> <span class="o">=</span> <span class="nc">Duration</span><span class="o">.</span><span class="na">between</span><span class="o">(</span><span class="n">zdt</span> <span class="o">,</span><span class="n">now</span><span class="o">).</span><span class="na">toDays</span><span class="o">();</span>
                <span class="kt">long</span> <span class="n">hours</span> <span class="o">=</span> <span class="nc">Duration</span><span class="o">.</span><span class="na">between</span><span class="o">(</span><span class="n">zdt</span><span class="o">,</span> <span class="n">now</span><span class="o">).</span><span class="na">toHours</span><span class="o">();</span>
                <span class="kt">long</span> <span class="n">mins</span> <span class="o">=</span> <span class="nc">Duration</span><span class="o">.</span><span class="na">between</span><span class="o">(</span><span class="n">zdt</span><span class="o">,</span> <span class="n">now</span><span class="o">).</span><span class="na">toMinutes</span><span class="o">();</span>

                <span class="k">if</span><span class="o">(</span><span class="n">days</span><span class="o">&gt;=</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">posts</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Post</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">place</span><span class="o">,</span> <span class="n">postId</span><span class="o">,</span> <span class="n">textComment</span><span class="o">,</span> <span class="n">likes</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">days</span><span class="o">)</span> <span class="o">+</span> <span class="s">" 일"</span><span class="o">,</span> <span class="n">comments</span><span class="o">));</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">hours</span><span class="o">&gt;=</span><span class="mi">1</span><span class="o">){</span>
                    <span class="n">posts</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Post</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">place</span><span class="o">,</span> <span class="n">postId</span><span class="o">,</span> <span class="n">textComment</span><span class="o">,</span> <span class="n">likes</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">hours</span><span class="o">)</span> <span class="o">+</span> <span class="s">" 시간"</span><span class="o">,</span> <span class="n">comments</span><span class="o">));</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    <span class="n">posts</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Post</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">place</span><span class="o">,</span> <span class="n">postId</span><span class="o">,</span> <span class="n">textComment</span><span class="o">,</span> <span class="n">likes</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">mins</span><span class="o">)</span> <span class="o">+</span> <span class="s">" 분"</span><span class="o">,</span> <span class="n">comments</span><span class="o">));</span>
                <span class="o">}</span>

                <span class="n">threads</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">ImgUrlThread</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">postId</span><span class="o">,</span> <span class="n">profile</span><span class="o">));</span>
            <span class="o">}</span>
</code></pre></div></div>

<p>getPosts는 서버로부터 Post에 대한 정보를 가져오는데 PostModel은 해당 사용자의 이미지를 주지 않으며 보는 사용자가 해당 게시글에 좋아요를 눌렀는지 등에 대한 정보를 주지 않는다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">posts</span> <span class="o">=</span> <span class="n">PostModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">user__name</span><span class="o">=</span><span class="n">UserModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kakaoID</span><span class="o">=</span><span class="n">kakaoID</span><span class="p">))</span>
<span class="k">for</span> <span class="n">following</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">FollowModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">user_from__kakaoID</span><span class="o">=</span><span class="n">kakaoID</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">"user_to_id"</span><span class="p">)):</span>
    <span class="n">posts</span> <span class="o">|=</span> <span class="n">PostModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">user__name</span><span class="o">=</span><span class="n">UserModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">following</span><span class="p">[</span><span class="s">"user_to_id"</span><span class="p">]))</span>
<span class="k">return</span> <span class="n">posts</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'date'</span><span class="p">)</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
</code></pre></div></div>

<p>그리하여 이를 처리하기 위해서는 추가적인 작업이 필요하다. 이를 위해 Runnable 인터페이스를 implements한 커스텀 쓰레드를 생성하였다. 커스텀으로 생성함으로 가질 수 있는 이점은 Thread가 업데이트 해야될 index에 대한 정보를 가질 수 있다는 점이며 백그라운드에서 작업을 수행할 수 있다는 점을 들 수 있다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ImgUrlThread</span> <span class="kd">implements</span> <span class="nc">Runnable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">url</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">profile_url</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">idx</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">record</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">ImgUrlThread</span><span class="o">(</span><span class="kt">int</span> <span class="n">idx</span><span class="o">,</span> <span class="nc">Integer</span> <span class="n">record</span><span class="o">,</span> <span class="nc">String</span> <span class="n">profile_url</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">record</span> <span class="o">=</span> <span class="n">record</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">profile_url</span> <span class="o">=</span> <span class="n">profile_url</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">getImageUrl</span><span class="o">(</span><span class="n">record</span><span class="o">);</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="n">addPostProfileImage</span><span class="o">(</span><span class="n">profile_url</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">ExecutionException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="n">checkLike</span><span class="o">();</span>
        <span class="n">checkPostUser</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">getImageUrl</span><span class="o">(</span><span class="kt">int</span> <span class="n">record</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="nc">OkHttpClient</span> <span class="n">okHttpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OkHttpClient</span><span class="o">.</span><span class="na">Builder</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
        <span class="kd">final</span> <span class="nc">ApolloClient</span> <span class="n">apolloClient</span> <span class="o">=</span> <span class="nc">ApolloClient</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">serverUrl</span><span class="o">(</span><span class="n">getString</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">api_url</span><span class="o">)).</span><span class="na">okHttpClient</span><span class="o">(</span><span class="n">okHttpClient</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

        <span class="kd">final</span> <span class="nc">PictureTypeQuery</span> <span class="n">q</span> <span class="o">=</span> <span class="nc">PictureTypeQuery</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">accessToken</span><span class="o">(</span><span class="nc">Token</span><span class="o">).</span><span class="na">record</span><span class="o">(</span><span class="n">record</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

        <span class="n">apolloClient</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">q</span><span class="o">).</span><span class="na">enqueue</span><span class="o">(</span><span class="k">new</span> <span class="nc">ApolloCall</span><span class="o">.</span><span class="na">Callback</span><span class="o">&lt;</span><span class="nc">PictureTypeQuery</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResponse</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">Response</span><span class="o">&lt;</span><span class="nc">PictureTypeQuery</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">url</span> <span class="o">=</span> <span class="s">"http://10.0.2.2:8000/media/"</span> <span class="o">+</span> <span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">pics</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">pic</span><span class="o">;</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="n">addPostImage</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>

                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">ExecutionException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFailure</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">ApolloException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>

            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">addPostImage</span><span class="o">(</span><span class="nc">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ExecutionException</span><span class="o">,</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="nc">Bitmap</span> <span class="n">bitmap</span> <span class="o">=</span> <span class="nc">Glide</span>
                <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">())</span>
                <span class="o">.</span><span class="na">asBitmap</span><span class="o">()</span>
                <span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">url</span><span class="o">)</span>
                <span class="o">.</span><span class="na">submit</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>

        <span class="n">posts</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">idx</span><span class="o">).</span><span class="na">set_post_img</span><span class="o">(</span><span class="n">bitmap</span><span class="o">);</span>

        <span class="nc">NotifyRunnable</span> <span class="n">runnable</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NotifyRunnable</span><span class="o">();</span>
        <span class="n">runnable</span><span class="o">.</span><span class="na">setIdx</span><span class="o">(</span><span class="n">idx</span><span class="o">);</span>
        <span class="n">runOnUiThread</span><span class="o">(</span><span class="n">runnable</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">addPostProfileImage</span><span class="o">(</span><span class="nc">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ExecutionException</span><span class="o">,</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="nc">Bitmap</span> <span class="n">bitmap</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">bitmap</span> <span class="o">=</span> <span class="nc">Glide</span>
                    <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">())</span>
                    <span class="o">.</span><span class="na">asBitmap</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">url</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">submit</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">bitmap</span> <span class="o">=</span> <span class="o">((</span><span class="nc">BitmapDrawable</span><span class="o">)</span><span class="n">getResources</span><span class="o">().</span><span class="na">getDrawable</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">userinfo</span><span class="o">)).</span><span class="na">getBitmap</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="n">posts</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">idx</span><span class="o">).</span><span class="na">set_profile_img</span><span class="o">(</span><span class="n">bitmap</span><span class="o">);</span>

        <span class="nc">NotifyRunnable</span> <span class="n">runnable</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NotifyRunnable</span><span class="o">();</span>
        <span class="n">runnable</span><span class="o">.</span><span class="na">setIdx</span><span class="o">(</span><span class="n">idx</span><span class="o">);</span>
        <span class="n">runOnUiThread</span><span class="o">(</span><span class="n">runnable</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">checkLike</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="nc">OkHttpClient</span> <span class="n">okHttpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OkHttpClient</span><span class="o">.</span><span class="na">Builder</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
        <span class="kd">final</span> <span class="nc">ApolloClient</span> <span class="n">apolloClient</span> <span class="o">=</span> <span class="nc">ApolloClient</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">serverUrl</span><span class="o">(</span><span class="n">getString</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">api_url</span><span class="o">)).</span><span class="na">okHttpClient</span><span class="o">(</span><span class="n">okHttpClient</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

        <span class="kd">final</span> <span class="nc">LikeTypeQuery</span> <span class="n">l</span> <span class="o">=</span> <span class="nc">LikeTypeQuery</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">accessToken</span><span class="o">(</span><span class="nc">Token</span><span class="o">).</span><span class="na">typeinfo</span><span class="o">(</span><span class="s">"P"</span><span class="o">).</span><span class="na">record</span><span class="o">(</span><span class="n">record</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
        <span class="n">apolloClient</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">l</span><span class="o">).</span><span class="na">enqueue</span><span class="o">(</span><span class="k">new</span> <span class="nc">ApolloCall</span><span class="o">.</span><span class="na">Callback</span><span class="o">&lt;</span><span class="nc">LikeTypeQuery</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResponse</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">Response</span><span class="o">&lt;</span><span class="nc">LikeTypeQuery</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">likes</span><span class="o">().</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">posts</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">idx</span><span class="o">).</span><span class="na">set_like_status</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    <span class="n">posts</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">idx</span><span class="o">).</span><span class="na">set_like_status</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="n">runOnUiThread</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span><span class="o">()</span> <span class="o">{</span>
                    <span class="nd">@Override</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                        <span class="n">adapter</span><span class="o">.</span><span class="na">notifyItemChanged</span><span class="o">(</span><span class="n">idx</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">});</span>
            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFailure</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">ApolloException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>

            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">checkPostUser</span><span class="o">(){</span>
        <span class="kd">final</span> <span class="nc">OkHttpClient</span> <span class="n">okHttpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OkHttpClient</span><span class="o">.</span><span class="na">Builder</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
        <span class="kd">final</span> <span class="nc">ApolloClient</span> <span class="n">apolloClient</span> <span class="o">=</span> <span class="nc">ApolloClient</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">serverUrl</span><span class="o">(</span><span class="n">getString</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">api_url</span><span class="o">)).</span><span class="na">okHttpClient</span><span class="o">(</span><span class="n">okHttpClient</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

        <span class="kd">final</span> <span class="nc">PostTypeQuery</span> <span class="n">p</span> <span class="o">=</span> <span class="nc">PostTypeQuery</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">accessToken</span><span class="o">(</span><span class="nc">Token</span><span class="o">).</span><span class="na">record</span><span class="o">(</span><span class="n">record</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
        <span class="n">apolloClient</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">p</span><span class="o">).</span><span class="na">enqueue</span><span class="o">(</span><span class="k">new</span> <span class="nc">ApolloCall</span><span class="o">.</span><span class="na">Callback</span><span class="o">&lt;</span><span class="nc">PostTypeQuery</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResponse</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">Response</span><span class="o">&lt;</span><span class="nc">PostTypeQuery</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">posts</span><span class="o">().</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">posts</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">idx</span><span class="o">).</span><span class="na">setMine</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    <span class="n">posts</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">idx</span><span class="o">).</span><span class="na">setMine</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="n">runOnUiThread</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span><span class="o">()</span> <span class="o">{</span>
                    <span class="nd">@Override</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                        <span class="n">adapter</span><span class="o">.</span><span class="na">notifyItemChanged</span><span class="o">(</span><span class="n">idx</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">});</span>
            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFailure</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">ApolloException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>

            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ImgUrlThread는 여러가지 작업을 처리하는데 그 순서를 간략하게 정리하자면 다음과 같다. Post를 올린 사용자의 프로필 정보를 받아와 set_profile_img를 호출하여 최신화 한다. checkLike를 호출하여 본인이 해당 게시글에 좋아요를 누른 상태인지를 확인한 뒤 누른 상태이면 하트의 색상을 변경한다. 해당 Post를 업로드한 본인이라면 포스트의 수정 또는 삭제를 하기 위해 누르게 되는 버튼에 대한 VISIBILITY를 처리한다.</p>

<p>그리고 작업이 끝나면 adapter에 notifyItemChanged를 호출함으로써 정보를 업데이트 하게 된다. 해당 코드를 작성하는 과정에서 imgUrlThread에 대한 ArrayList를 생성하여 처리하였는데 만약 그 과정에서 레이스 컨디션이 발생하면 null 에러가 발생할 수 있다. 그리하여 위의 코드는 그리 좋은 예제라고는 할 수 없지만 안드로이드를 처음하는 지금의 입장에서 고치기보다는 좀 더 익숙해지게 되면 다시 돌아와 고치는 편이 더 좋을 것 같다. 아직도 갈 길이 멀다..</p>

<p><img src="https://raw.githubusercontent.com/wizleysw/wizleysw.github.io/master/_posts/img/aintstagram/Post.png" alt="post" /></p>

<h3 id="recyclerview-특정-위치로-이동시키기">RecyclerView 특정 위치로 이동시키기</h3>

<p>ProfileActivity에서 사용자의 특정 사진을 클릭하면 해당 사용자의 Post만을 담고 있는 RecyclerView의 특정 부분으로 이동하게 된다. 이를 어떻게 구현하면 될까 고민을 했었는데 다음과 같이 해결이 가능하다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">adapter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PostRecyclerAdapter</span><span class="o">(</span><span class="n">posts</span><span class="o">,</span> <span class="n">getApplicationContext</span><span class="o">(),</span> <span class="n">onPostListener</span><span class="o">);</span>
<span class="n">v_recycle</span><span class="o">.</span><span class="na">setAdapter</span><span class="o">(</span><span class="n">adapter</span><span class="o">);</span>
<span class="n">v_recycle</span><span class="o">.</span><span class="na">scrollToPosition</span><span class="o">(</span><span class="n">post_pos</span><span class="o">);</span>
</code></pre></div></div>

<p>scrollToPosition으로 해결하엿다!</p>

<h3 id="commentactivity-구현하기">CommentActivity 구현하기</h3>

<p>댓글 부분에서는 대부분 받아오고 서버로 요청하는 부분이 대부분이기 때문에 특별히 다른 점을 찾아보라면 OnKeyListener를 들 수 있겠다. 사용자가 댓글을 작성을 완료하면 해당 event의 콜백부분을 수행하는 과정에서 서버로 요청을 하게 하면 된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">new_comment</span><span class="o">.</span><span class="na">setOnKeyListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">ReplyCommentListener</span><span class="o">(</span><span class="n">parent</span><span class="o">));</span>
<span class="n">new_comment</span><span class="o">.</span><span class="na">requestFocus</span><span class="o">();</span>
</code></pre></div></div>

<p>new_comment라는 이름의 EditText에 ReplyCommentListener를 달아주는데 OnKeyListener를 커스터마이징 한 클래스이다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReplyCommentListener</span> <span class="kd">implements</span> <span class="nc">View</span><span class="o">.</span><span class="na">OnKeyListener</span><span class="o">{</span>
        <span class="nc">Integer</span> <span class="n">parent</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">ReplyCommentListener</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">parent</span><span class="o">){</span>
            <span class="k">this</span><span class="o">.</span><span class="na">parent</span> <span class="o">=</span> <span class="n">parent</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onKey</span><span class="o">(</span><span class="nc">View</span> <span class="n">v</span><span class="o">,</span> <span class="kt">int</span> <span class="n">keyCode</span><span class="o">,</span> <span class="nc">KeyEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">((</span><span class="n">event</span><span class="o">.</span><span class="na">getAction</span><span class="o">()</span> <span class="o">==</span> <span class="nc">KeyEvent</span><span class="o">.</span><span class="na">ACTION_DOWN</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">keyCode</span> <span class="o">==</span> <span class="nc">KeyEvent</span><span class="o">.</span><span class="na">KEYCODE_ENTER</span><span class="o">))</span> <span class="o">{</span>
                <span class="nc">String</span> <span class="n">comment</span> <span class="o">=</span> <span class="nc">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">new_comment</span><span class="o">.</span><span class="na">getText</span><span class="o">());</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">comment</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="o">!=</span> <span class="s">"\n"</span><span class="o">)</span> <span class="o">{</span>
                    <span class="nc">OkHttpClient</span> <span class="n">okHttpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OkHttpClient</span><span class="o">.</span><span class="na">Builder</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
                    <span class="nc">ApolloClient</span> <span class="n">apolloClient</span> <span class="o">=</span> <span class="nc">ApolloClient</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">serverUrl</span><span class="o">(</span><span class="n">getString</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">api_url</span><span class="o">)).</span><span class="na">okHttpClient</span><span class="o">(</span><span class="n">okHttpClient</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

                    <span class="nc">String</span> <span class="nc">Token</span> <span class="o">=</span> <span class="nc">Session</span><span class="o">.</span><span class="na">getCurrentSession</span><span class="o">().</span><span class="na">getTokenInfo</span><span class="o">().</span><span class="na">getAccessToken</span><span class="o">();</span>
                    <span class="k">if</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">parent</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
                        <span class="kd">final</span> <span class="n">Add_commentMutation</span> <span class="n">addComment</span> <span class="o">=</span> <span class="n">Add_commentMutation</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">accessToken</span><span class="o">(</span><span class="nc">Token</span><span class="o">).</span><span class="na">record</span><span class="o">(</span><span class="n">comments</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">get_post_id</span><span class="o">()).</span><span class="na">text</span><span class="o">(</span><span class="n">comment</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
                        <span class="n">apolloClient</span><span class="o">.</span><span class="na">mutate</span><span class="o">(</span><span class="n">addComment</span><span class="o">).</span><span class="na">enqueue</span><span class="o">(</span><span class="k">new</span> <span class="nc">ApolloCall</span><span class="o">.</span><span class="na">Callback</span><span class="o">&lt;</span><span class="n">Add_commentMutation</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;()</span> <span class="o">{</span>
                            <span class="nd">@Override</span>
                            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResponse</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">Response</span><span class="o">&lt;</span><span class="n">Add_commentMutation</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
                                <span class="k">if</span> <span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">addComment</span><span class="o">.</span><span class="na">success</span><span class="o">)</span> <span class="o">{</span>
                                    <span class="n">new_comment</span><span class="o">.</span><span class="na">getText</span><span class="o">().</span><span class="na">clear</span><span class="o">();</span>

                                    <span class="n">runOnUiThread</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span><span class="o">()</span> <span class="o">{</span>
                                        <span class="nd">@Override</span>
                                        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                                            <span class="n">new_comment</span><span class="o">.</span><span class="na">clearFocus</span><span class="o">();</span>
                                        <span class="o">}</span>
                                    <span class="o">});</span>

                                    <span class="nc">InputMethodManager</span> <span class="n">imm</span> <span class="o">=</span> <span class="o">(</span><span class="nc">InputMethodManager</span><span class="o">)</span> <span class="n">getApplicationContext</span><span class="o">().</span><span class="na">getSystemService</span><span class="o">(</span><span class="nc">Activity</span><span class="o">.</span><span class="na">INPUT_METHOD_SERVICE</span><span class="o">);</span>
                                    <span class="n">imm</span><span class="o">.</span><span class="na">hideSoftInputFromWindow</span><span class="o">(</span> <span class="n">new_comment</span><span class="o">.</span><span class="na">getWindowToken</span><span class="o">(),</span> <span class="mi">0</span><span class="o">);</span>

                                    <span class="n">getCommentsList</span><span class="o">();</span>
                                <span class="o">}</span>
                            <span class="o">}</span>

                            <span class="nd">@Override</span>
                            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFailure</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">ApolloException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                                <span class="nc">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="s">"알 수 없는 이유로 실패하였습니다."</span><span class="o">,</span> <span class="nc">Toast</span><span class="o">.</span><span class="na">LENGTH_LONG</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
                            <span class="o">}</span>
                        <span class="o">});</span>
                    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                        <span class="kd">final</span> <span class="n">Add_commentMutation</span> <span class="n">addComment</span> <span class="o">=</span> <span class="n">Add_commentMutation</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">accessToken</span><span class="o">(</span><span class="nc">Token</span><span class="o">).</span><span class="na">record</span><span class="o">(</span><span class="n">comments</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">get_post_id</span><span class="o">()).</span><span class="na">parent</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">parent</span><span class="o">).</span><span class="na">text</span><span class="o">(</span><span class="n">comment</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
                        <span class="n">apolloClient</span><span class="o">.</span><span class="na">mutate</span><span class="o">(</span><span class="n">addComment</span><span class="o">).</span><span class="na">enqueue</span><span class="o">(</span><span class="k">new</span> <span class="nc">ApolloCall</span><span class="o">.</span><span class="na">Callback</span><span class="o">&lt;</span><span class="n">Add_commentMutation</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;()</span> <span class="o">{</span>
                            <span class="nd">@Override</span>
                            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResponse</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">Response</span><span class="o">&lt;</span><span class="n">Add_commentMutation</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
                                <span class="k">if</span> <span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">addComment</span><span class="o">.</span><span class="na">success</span><span class="o">)</span> <span class="o">{</span>
                                    <span class="n">new_comment</span><span class="o">.</span><span class="na">getText</span><span class="o">().</span><span class="na">clear</span><span class="o">();</span>

                                    <span class="n">runOnUiThread</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span><span class="o">()</span> <span class="o">{</span>
                                        <span class="nd">@Override</span>
                                        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                                            <span class="n">new_comment</span><span class="o">.</span><span class="na">clearFocus</span><span class="o">();</span>
                                        <span class="o">}</span>
                                    <span class="o">});</span>

                                    <span class="nc">InputMethodManager</span> <span class="n">imm</span> <span class="o">=</span> <span class="o">(</span><span class="nc">InputMethodManager</span><span class="o">)</span> <span class="n">getApplicationContext</span><span class="o">().</span><span class="na">getSystemService</span><span class="o">(</span><span class="nc">Activity</span><span class="o">.</span><span class="na">INPUT_METHOD_SERVICE</span><span class="o">);</span>
                                    <span class="n">imm</span><span class="o">.</span><span class="na">hideSoftInputFromWindow</span><span class="o">(</span> <span class="n">new_comment</span><span class="o">.</span><span class="na">getWindowToken</span><span class="o">(),</span> <span class="mi">0</span><span class="o">);</span>

                                    <span class="n">getCommentsList</span><span class="o">();</span>
                                <span class="o">}</span>
                            <span class="o">}</span>

                            <span class="nd">@Override</span>
                            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFailure</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">ApolloException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                                <span class="nc">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="s">"알 수 없는 이유로 실패하였습니다."</span><span class="o">,</span> <span class="nc">Toast</span><span class="o">.</span><span class="na">LENGTH_LONG</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
                            <span class="o">}</span>
                        <span class="o">});</span>
                    <span class="o">}</span>
                    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div></div>

<p>Comment에서 parent는 답글에 대한 답글인지를 판단하는 여부이기 떄문에 해당 값이 null인 경우 게시물 자체에 대한 댓글로 간주한다. onKey이벤트가 발생하면 사용자가 작성한 댓글을 parent와 같은 값을 토대로 build하여 전송한다. 만약 해당 요청이 성공하여 success값이 참으로 돌아온 경우 new_comment에 적혀있는 글을 clear한 뒤, clearFocus를 수행하고 keyboard를 숨기고 Comment에 대한 정보를 최신화해주는 getCommentsList를 호출하게 된다.</p>

<p><img src="https://raw.githubusercontent.com/wizleysw/wizleysw.github.io/master/_posts/img/aintstagram/CommentActivity.png" alt="comment" /></p>

<h3 id="history-서비스-구현하기">History 서비스 구현하기</h3>

<p>History는 팔로우/팔로잉/좋아요/댓글 등의 이벤트가 발생하면 사용자에게 알림을 주기 위해 필요한 기능이다. 백그라운드에서 지속적으로 돌아야 되기 때문에 Service로 구현을 하였다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HistoryService</span> <span class="kd">extends</span> <span class="nc">Service</span> <span class="kd">implements</span> <span class="nc">Runnable</span><span class="o">{</span>
    <span class="kd">private</span> <span class="nc">NotificationManager</span> <span class="n">mNM</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="no">NOTIFICATION</span> <span class="o">=</span> <span class="mi">5</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">LocalBinder</span> <span class="kd">extends</span> <span class="nc">Binder</span> <span class="o">{</span>
        <span class="nc">HistoryService</span> <span class="nf">getService</span><span class="o">(){</span>
            <span class="k">return</span> <span class="nc">HistoryService</span><span class="o">.</span><span class="na">this</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@RequiresApi</span><span class="o">(</span><span class="n">api</span> <span class="o">=</span> <span class="nc">Build</span><span class="o">.</span><span class="na">VERSION_CODES</span><span class="o">.</span><span class="na">O</span><span class="o">)</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">();</span>

        <span class="n">mNM</span>  <span class="o">=</span> <span class="o">(</span><span class="nc">NotificationManager</span><span class="o">)</span> <span class="n">getSystemService</span><span class="o">(</span><span class="no">NOTIFICATION_SERVICE</span><span class="o">);</span>
        <span class="n">showNotification</span><span class="o">(</span><span class="s">"Welcome to aintstagram"</span><span class="o">);</span>

        <span class="nc">Thread</span> <span class="n">mThread</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="n">mThread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">onStartCommand</span><span class="o">(</span><span class="nc">Intent</span> <span class="n">intent</span><span class="o">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="o">,</span> <span class="kt">int</span> <span class="n">startId</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">onStartCommand</span><span class="o">(</span><span class="n">intent</span><span class="o">,</span> <span class="n">flags</span><span class="o">,</span> <span class="n">startId</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">mNM</span><span class="o">.</span><span class="na">cancel</span><span class="o">(</span><span class="no">NOTIFICATION</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Nullable</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">IBinder</span> <span class="nf">onBind</span><span class="o">(</span><span class="nc">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">mBinder</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">IBinder</span> <span class="n">mBinder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LocalBinder</span><span class="o">();</span>

    <span class="nd">@RequiresApi</span><span class="o">(</span><span class="n">api</span> <span class="o">=</span> <span class="nc">Build</span><span class="o">.</span><span class="na">VERSION_CODES</span><span class="o">.</span><span class="na">O</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">showNotification</span><span class="o">(</span><span class="nc">CharSequence</span> <span class="n">text</span><span class="o">){</span>
        <span class="nc">PendingIntent</span> <span class="n">intent</span> <span class="o">=</span> <span class="nc">PendingIntent</span><span class="o">.</span><span class="na">getActivity</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="nc">MainActivity</span><span class="o">.</span><span class="na">class</span><span class="o">),</span> <span class="mi">0</span><span class="o">);</span>

        <span class="nc">NotificationChannel</span> <span class="n">channel</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NotificationChannel</span><span class="o">(</span><span class="s">"aintstagram"</span><span class="o">,</span> <span class="n">text</span><span class="o">,</span> <span class="no">IMPORTANCE_DEFAULT</span><span class="o">);</span>
        <span class="n">mNM</span><span class="o">.</span><span class="na">createNotificationChannel</span><span class="o">(</span><span class="n">channel</span><span class="o">);</span>

        <span class="nc">Notification</span> <span class="n">notification</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Notification</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="s">"aintstagram"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">setSmallIcon</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">aintstagram</span><span class="o">)</span>
                <span class="o">.</span><span class="na">setTicker</span><span class="o">(</span><span class="n">text</span><span class="o">)</span>  <span class="c1">// the status text</span>
                <span class="o">.</span><span class="na">setWhen</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">())</span>  <span class="c1">// the time stamp</span>
                <span class="o">.</span><span class="na">setContentTitle</span><span class="o">(</span><span class="s">"aintstagram"</span><span class="o">)</span>  <span class="c1">// the label of the entry</span>
                <span class="o">.</span><span class="na">setContentText</span><span class="o">(</span><span class="n">text</span><span class="o">)</span>  <span class="c1">// the contents of the entry</span>
                <span class="o">.</span><span class="na">setContentIntent</span><span class="o">(</span><span class="n">intent</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>

        <span class="n">mNM</span><span class="o">.</span><span class="na">notify</span><span class="o">(</span><span class="no">NOTIFICATION</span><span class="o">,</span> <span class="n">notification</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateHistory</span><span class="o">(</span><span class="kt">int</span> <span class="n">record</span><span class="o">){</span>
        <span class="kd">final</span> <span class="nc">OkHttpClient</span> <span class="n">okHttpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OkHttpClient</span><span class="o">.</span><span class="na">Builder</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
        <span class="kd">final</span> <span class="nc">ApolloClient</span> <span class="n">apolloClient</span> <span class="o">=</span> <span class="nc">ApolloClient</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">serverUrl</span><span class="o">(</span><span class="n">getString</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">api_url</span><span class="o">)).</span><span class="na">okHttpClient</span><span class="o">(</span><span class="n">okHttpClient</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
        <span class="nc">String</span> <span class="nc">Token</span> <span class="o">=</span> <span class="nc">Session</span><span class="o">.</span><span class="na">getCurrentSession</span><span class="o">().</span><span class="na">getTokenInfo</span><span class="o">().</span><span class="na">getAccessToken</span><span class="o">();</span>

        <span class="kd">final</span> <span class="n">Update_history_seenMutation</span> <span class="n">uh</span> <span class="o">=</span> <span class="n">Update_history_seenMutation</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">accessToken</span><span class="o">(</span><span class="nc">Token</span><span class="o">).</span><span class="na">record</span><span class="o">(</span><span class="n">record</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
        <span class="n">apolloClient</span><span class="o">.</span><span class="na">mutate</span><span class="o">(</span><span class="n">uh</span><span class="o">).</span><span class="na">enqueue</span><span class="o">(</span><span class="k">new</span> <span class="nc">ApolloCall</span><span class="o">.</span><span class="na">Callback</span><span class="o">&lt;</span><span class="n">Update_history_seenMutation</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;()</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResponse</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">Response</span><span class="o">&lt;</span><span class="n">Update_history_seenMutation</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>

            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFailure</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">ApolloException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>

            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">checkHistory</span><span class="o">(){</span>
        <span class="kd">final</span> <span class="nc">OkHttpClient</span> <span class="n">okHttpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OkHttpClient</span><span class="o">.</span><span class="na">Builder</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
        <span class="kd">final</span> <span class="nc">ApolloClient</span> <span class="n">apolloClient</span> <span class="o">=</span> <span class="nc">ApolloClient</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">serverUrl</span><span class="o">(</span><span class="n">getString</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">api_url</span><span class="o">)).</span><span class="na">okHttpClient</span><span class="o">(</span><span class="n">okHttpClient</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
        <span class="nc">String</span> <span class="nc">Token</span> <span class="o">=</span> <span class="nc">Session</span><span class="o">.</span><span class="na">getCurrentSession</span><span class="o">().</span><span class="na">getTokenInfo</span><span class="o">().</span><span class="na">getAccessToken</span><span class="o">();</span>

        <span class="kd">final</span> <span class="nc">HistoryTypeQuery</span> <span class="n">h</span> <span class="o">=</span> <span class="nc">HistoryTypeQuery</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">accessToken</span><span class="o">(</span><span class="nc">Token</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
        <span class="n">apolloClient</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">h</span><span class="o">).</span><span class="na">enqueue</span><span class="o">(</span><span class="k">new</span> <span class="nc">ApolloCall</span><span class="o">.</span><span class="na">Callback</span><span class="o">&lt;</span><span class="nc">HistoryTypeQuery</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;()</span> <span class="o">{</span>
            <span class="nd">@RequiresApi</span><span class="o">(</span><span class="n">api</span> <span class="o">=</span> <span class="nc">Build</span><span class="o">.</span><span class="na">VERSION_CODES</span><span class="o">.</span><span class="na">O</span><span class="o">)</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResponse</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">Response</span><span class="o">&lt;</span><span class="nc">HistoryTypeQuery</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">cnt</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">histories</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">cnt</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
                    <span class="nc">Integer</span> <span class="n">record</span> <span class="o">=</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">histories</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">historyId</span><span class="o">);</span>
                    <span class="k">if</span> <span class="o">(!</span><span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">histories</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">seen</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">switch</span> <span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">histories</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">type</span><span class="o">){</span>
                            <span class="k">case</span> <span class="nl">C:</span>
                                <span class="n">showNotification</span><span class="o">(</span><span class="s">"새로운 댓글이 있습니다."</span><span class="o">);</span>
                                <span class="n">updateHistory</span><span class="o">(</span><span class="n">record</span><span class="o">);</span>
                                <span class="k">break</span><span class="o">;</span>
                            <span class="k">case</span> <span class="nl">F:</span>
                                <span class="n">showNotification</span><span class="o">(</span><span class="s">"새로운 팔로우가 추가되었습니다."</span><span class="o">);</span>
                                <span class="n">updateHistory</span><span class="o">(</span><span class="n">record</span><span class="o">);</span>
                                <span class="k">break</span><span class="o">;</span>
                            <span class="k">case</span> <span class="nl">L:</span>
                                <span class="n">showNotification</span><span class="o">(</span><span class="s">"새로운 좋아요 정보가 있습니다."</span><span class="o">);</span>
                                <span class="n">updateHistory</span><span class="o">(</span><span class="n">record</span><span class="o">);</span>
                                <span class="k">break</span><span class="o">;</span>
                            <span class="k">case</span> <span class="n">$UNKNOWN</span><span class="o">:</span>
                                <span class="k">break</span><span class="o">;</span>
                        <span class="o">}</span>
                    <span class="o">}</span>


                <span class="o">}</span>
            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFailure</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">ApolloException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>

            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">){</span>
            <span class="k">try</span><span class="o">{</span>
                <span class="n">checkHistory</span><span class="o">();</span>
                <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">10000</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>

            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>서비스도 라이프 사이클을 가지고 있는데 onCreate로부터 시작이 되는 것은 Activity와 동일하다. 서비스는 백그라운드에서 작업을 하며 브로드캐스트와 다르게 메모리에 대한 정리가 필요한 경우 종료되기도 한다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mNM</span>  <span class="o">=</span> <span class="o">(</span><span class="nc">NotificationManager</span><span class="o">)</span> <span class="n">getSystemService</span><span class="o">(</span><span class="no">NOTIFICATION_SERVICE</span><span class="o">);</span>
<span class="n">showNotification</span><span class="o">(</span><span class="s">"Welcome to aintstagram"</span><span class="o">);</span>
</code></pre></div></div>

<p>해당 부분은 사용자에게 Welcome to aintstagram이라는 메시지 알람을 띄우는 부분이며 서비스가 실행되는 동안에는 한 번만 호출이 된다.</p>

<p><img src="https://raw.githubusercontent.com/wizleysw/wizleysw.github.io/master/_posts/img/aintstagram/alarm.png" alt="alarm" /></p>

<p>showNotification 부분에서는 알림에 대한 이름 등의 설정을 진행하게 되며 run 부분을 통해 Thread는 10초마다 checkHistory를 실행하게 된다.</p>

<p>checkHistory는 서버로부터 새로 알려야 할 History 정보가 존재하는지 요청하게 되는데 만약 존재할 경우 해당 타입에 대한 정보를 토대로 알림을 보낸 뒤 updateHistory를 요청하게 된다. updateHistory는 알림을 수행하였다는 결과를 서버에 알려주기 위함이며 해당 요청이 서버로 전달이 되게 되면 checkHistory에서 더 이상 같은 레코드 값이 넘어오지 않게 된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Intent</span> <span class="n">historyService</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Intent</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="nc">HistoryService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">startService</span><span class="o">(</span><span class="n">historyService</span><span class="o">);</span>
</code></pre></div></div>

<p>service도 Intent를 통해 실행할 수 있으며 startService로 호출을 하는 순간 실행되게 된다.</p>

<p><img src="https://raw.githubusercontent.com/wizleysw/wizleysw.github.io/master/_posts/img/aintstagram/history.png" alt="history" /></p>

<h3 id="sms-최신화">SMS 최신화</h3>

<p>타 사용자와 메시지를 주고 받는 경우에는 나로 인해 발생하는 변화와 상대방으로 발생하는 변화를 모두 캐치할 수 있어야 된다. 나로 인해 발생하는 전송/메시지 삭제의 경우 안드로이드가 알 수 있기 때문에 바로 최신화를 수행하면 되지만 상대방으로 인해 발생한 변화에 대해서는 서버에 요청하여 알아내는 과정이 필요하다.</p>

<p>어떤 방식으로 구현할 수 있을지에 대해 고민을 하다가 다음과 로직을 생각했다. 첫 번째는 누군가 특정 메시지를 삭제한 뒤 요청한 쿼리의 경우 메시지의 총량이 다르다는 점이다. 두 번째로는 만약 메시지를 삭제한 동시에 새로운 메시지가 추가되어 총량이 같은 경우에는 마지막에 추가된 메시지의 레코드 번호는 반드시 다르다는 것이다. 삭제된 만큼 추가가 되었음에도 마지막 레코드의 값이 같은 경우는 존재할 수 없기 때문이다. 이런 특징을 이용하여 Thread를 구현하였다. Thread는 2초마다 diffMessage를 호출하는데 MessageType을 쿼리하여 총량이 다르거나 마지막 레코드의 번호가 다른 경우에 update를 수행하도록 하였다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">MessageDiffThread</span> <span class="kd">extends</span> <span class="nc">Thread</span> <span class="kd">implements</span> <span class="nc">Runnable</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="nc">String</span> <span class="n">username</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">chatId</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">last_idx</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">prev_cnt</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">cur_cnt</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">MessageDiffThread</span><span class="o">(</span><span class="kt">int</span> <span class="n">chatId</span><span class="o">,</span> <span class="nc">String</span> <span class="n">username</span><span class="o">,</span> <span class="kt">int</span> <span class="n">last_idx</span><span class="o">,</span> <span class="kt">int</span> <span class="n">prev_cnt</span><span class="o">){</span>
            <span class="k">this</span><span class="o">.</span><span class="na">chatId</span> <span class="o">=</span> <span class="n">chatId</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">username</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">last_idx</span> <span class="o">=</span> <span class="n">last_idx</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">prev_cnt</span> <span class="o">=</span> <span class="n">prev_cnt</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">diffMessage</span><span class="o">();</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">2000</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="kd">private</span> <span class="kt">void</span> <span class="nf">diffMessage</span><span class="o">(){</span>
            <span class="kd">final</span> <span class="nc">OkHttpClient</span> <span class="n">okHttpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OkHttpClient</span><span class="o">.</span><span class="na">Builder</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
            <span class="kd">final</span> <span class="nc">ApolloClient</span> <span class="n">apolloClient</span> <span class="o">=</span> <span class="nc">ApolloClient</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">serverUrl</span><span class="o">(</span><span class="s">"http://10.0.2.2:8000/graphql/"</span><span class="o">).</span><span class="na">okHttpClient</span><span class="o">(</span><span class="n">okHttpClient</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
            <span class="nc">String</span> <span class="nc">Token</span> <span class="o">=</span> <span class="nc">Session</span><span class="o">.</span><span class="na">getCurrentSession</span><span class="o">().</span><span class="na">getTokenInfo</span><span class="o">().</span><span class="na">getAccessToken</span><span class="o">();</span>

            <span class="kd">final</span> <span class="nc">MessageTypeQuery</span> <span class="n">m</span> <span class="o">=</span> <span class="nc">MessageTypeQuery</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">accessToken</span><span class="o">(</span><span class="nc">Token</span><span class="o">).</span><span class="na">username</span><span class="o">(</span><span class="n">username</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

            <span class="n">apolloClient</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">m</span><span class="o">).</span><span class="na">enqueue</span><span class="o">(</span><span class="k">new</span> <span class="nc">ApolloCall</span><span class="o">.</span><span class="na">Callback</span><span class="o">&lt;</span><span class="nc">MessageTypeQuery</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;()</span> <span class="o">{</span>
                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResponse</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">Response</span><span class="o">&lt;</span><span class="nc">MessageTypeQuery</span><span class="o">.</span><span class="na">Data</span><span class="o">&gt;</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">cur_cnt</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">messages</span><span class="o">().</span><span class="na">size</span><span class="o">();</span>
                    <span class="kt">int</span> <span class="n">new_last_idx</span> <span class="o">=</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">().</span><span class="na">messages</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">cur_cnt</span><span class="o">-</span><span class="mi">1</span><span class="o">).</span><span class="na">messageId</span><span class="o">);</span>

                    <span class="k">if</span><span class="o">(</span><span class="n">prev_cnt</span> <span class="o">!=</span> <span class="n">cur_cnt</span><span class="o">){</span>
                        <span class="n">getMessages</span><span class="o">();</span>
                        <span class="n">prev_cnt</span> <span class="o">=</span> <span class="n">cur_cnt</span><span class="o">;</span>
                        <span class="n">last_idx</span> <span class="o">=</span> <span class="n">new_last_idx</span><span class="o">;</span>
                    <span class="o">}</span>

                    <span class="k">else</span> <span class="nf">if</span><span class="o">(</span><span class="n">new_last_idx</span> <span class="o">!=</span> <span class="n">last_idx</span><span class="o">){</span>
                        <span class="n">getMessages</span><span class="o">();</span>
                        <span class="n">last_idx</span> <span class="o">=</span> <span class="n">new_last_idx</span><span class="o">;</span>
                    <span class="o">}</span>
                <span class="o">}</span>

                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFailure</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">ApolloException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="o">}</span>
            <span class="o">});</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/wizleysw/wizleysw.github.io/master/_posts/img/aintstagram/MessageActivity.png" alt="sms" /></p>

<h3 id="github-link">GITHUB LINK</h3>

<p>사실 여기까지 진행하는데 딱 2달이라는 시간이 걸렸다. 안드로이드 프로젝트가 처음이었고 자바프로그래밍이 처음이었으며 graphql 또한 처음이었다. 개발을 진행하는 동안 수많은 문제에 봉착하였으며 해결하기 위해 많은 노력을 기울였다. 그리고 그 과정에서 스스로 해결해야 되는 문제들도 존재했으며 공식 문서를 봤지만 전혀 모르겠었던 문제들도 존재하였다. 그리고 구현이 완료된 지금도 해결하지 못하고 있는 여러 이슈들이 존재한다. 하지만 그 과정에서 많은 것을 배울 수 있었고 가장 유명한 어플을 스스로 도움없이 구현할 수 있었다는 점에서 이번 프로젝트는 성공하였다고 생각한다. 다만 안드로이드 개발을 더 잘하고 싶은 욕심이 생겨서 아마 다른 사람이 개발한 어떤 앱의 코드를 그대로 따라하며 나와 어떤 방식이 다른지에 대한 연구를 해보고자 한다.</p>

<p>안드로이드를 개발하면서 가장 힘들었던 부분이 비동기 처리를 하는 부분이었다. null 관련 에러가 발생하기 쉬운 환경이기 때문에 속도 및 로직에 대한 부분에서 많은 실수가 있었고 이를 해결하는게 쉽지 않았다. 그래도 익숙해질수록 비슷한 구현이 필요한 부분에 대한 구현 속도가 빨라진다는 점에서 숙련도가 늘고 있다는 것을 체감할 수 있었다. 클론 코딩으로 진행하기에 좀 어렵지 않았나라는 생각을 했지만 결국 구현이 가능하다는 것을 이렇게 증명할 수 있어서 한편으로는 좋았던 프로젝트 주제였다고 생각한다.</p>

<p>포스팅에는 생략된 부분이 정말 많았지만 구현을 하는 동안 정말 많은 코드를 작성하였다. 그리고 그 기록에 대한 부분은 아래의 깃링크에서 확인이 가능하다. 각각의 커밋에 대해서 설명을 달아놨으니 참고해보면 좋을 듯 하다.</p>

<p><a href="https://github.com/wizleysw/aintstagram">aintstagram 결과물</a></p>


        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> 태그: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#android" class="page__taxonomy-item" rel="tag">Android</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#graphql" class="page__taxonomy-item" rel="tag">graphQL</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#java" class="page__taxonomy-item" rel="tag">JAVA</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> 카테고리: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#dev" class="page__taxonomy-item" rel="tag">dev</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> 게시일:</strong> <time datetime="2020-04-03T00:00:00+09:00">April 3, 2020</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">공유하기</h4>
  

  <a href="https://twitter.com/intent/tweet?text=JAVA+%2B+graphQL%EB%A1%9C+%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C+%EC%96%B4%ED%94%8C+%ED%81%B4%EB%A1%A0%EC%BD%94%EB%94%A9%ED%95%98%EA%B8%B0%20http%3A%2F%2Flocalhost%3A4000%2Fdev%2FJAVA-%2B-graphQL%25EB%25A1%259C-%25EC%2595%2588%25EB%2593%259C%25EB%25A1%259C%25EC%259D%25B4%25EB%2593%259C-%25EC%2596%25B4%25ED%2594%258C-%25ED%2581%25B4%25EB%25A1%25A0%25EC%25BD%2594%25EB%2594%25A9%25ED%2595%2598%25EA%25B8%25B0%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="공유하기 Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fdev%2FJAVA-%2B-graphQL%25EB%25A1%259C-%25EC%2595%2588%25EB%2593%259C%25EB%25A1%259C%25EC%259D%25B4%25EB%2593%259C-%25EC%2596%25B4%25ED%2594%258C-%25ED%2581%25B4%25EB%25A1%25A0%25EC%25BD%2594%25EB%2594%25A9%25ED%2595%2598%25EA%25B8%25B0%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="공유하기 Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fdev%2FJAVA-%2B-graphQL%25EB%25A1%259C-%25EC%2595%2588%25EB%2593%259C%25EB%25A1%259C%25EC%259D%25B4%25EB%2593%259C-%25EC%2596%25B4%25ED%2594%258C-%25ED%2581%25B4%25EB%25A1%25A0%25EC%25BD%2594%25EB%2594%25A9%25ED%2595%2598%25EA%25B8%25B0%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="공유하기 LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/dev/Django-+-REST-+-SQLite-@-docker%EB%A1%9C-Eaten_Away-%EC%84%9C%EB%B9%84%EC%8A%A4-%EA%B0%9C%EB%B0%9C%ED%95%98%EA%B8%B0/" class="pagination--pager" title="Django + REST + SQLite @ docker로 Eaten_Away 서비스 개발하기
">이전</a>
    
    
      <a href="/dev/%EB%84%88%EC%9D%98-%EC%9D%B4%EB%A6%84%EC%9D%80-%EC%98%81%ED%99%94%EC%97%90-%EB%82%98%EC%98%A8-MyDiary%EB%A5%BC-%EA%B5%AC%ED%98%84%ED%95%9C-%EC%98%A4%ED%94%88%EC%86%8C%EC%8A%A4-%EC%95%B1-%EB%98%91%EA%B0%99%EC%9D%B4-%EB%94%B0%EB%9D%BC-%EC%BD%94%EB%94%A9%ED%95%B4%EB%B3%B4%EA%B8%B0/" class="pagination--pager" title="너의 이름은 영화에 나온 MyDiary를 구현한 오픈소스 앱 똑같이 따라 코딩해보기
">다음</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">참고</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/dev/%EB%84%88%EC%9D%98-%EC%9D%B4%EB%A6%84%EC%9D%80-%EC%98%81%ED%99%94%EC%97%90-%EB%82%98%EC%98%A8-MyDiary%EB%A5%BC-%EA%B5%AC%ED%98%84%ED%95%9C-%EC%98%A4%ED%94%88%EC%86%8C%EC%8A%A4-%EC%95%B1-%EB%98%91%EA%B0%99%EC%9D%B4-%EB%94%B0%EB%9D%BC-%EC%BD%94%EB%94%A9%ED%95%B4%EB%B3%B4%EA%B8%B0/" rel="permalink">너의 이름은 영화에 나온 MyDiary를 구현한 오픈소스 앱 똑같이 따라 코딩해보기
</a>
      
    </h2>
    <!--
      comments:
        아카이브 싱글 페이지 각 포스트 제목 하단에 Updated 시간 표기
        기존에는 read_time이 표기됨
    
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  18 분 소요

</p>
    
    -->
    
    <p class="page__meta"><i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> June 02 2020</p>
    

    <p class="archive__item-excerpt" itemprop="description">Overview
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/dev/Django-+-REST-+-SQLite-@-docker%EB%A1%9C-Eaten_Away-%EC%84%9C%EB%B9%84%EC%8A%A4-%EA%B0%9C%EB%B0%9C%ED%95%98%EA%B8%B0/" rel="permalink">Django + REST + SQLite @ docker로 Eaten_Away 서비스 개발하기
</a>
      
    </h2>
    <!--
      comments:
        아카이브 싱글 페이지 각 포스트 제목 하단에 Updated 시간 표기
        기존에는 read_time이 표기됨
    
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  46 분 소요

</p>
    
    -->
    
    <p class="page__meta"><i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> March 02 2020</p>
    

    <p class="archive__item-excerpt" itemprop="description">Overview
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/dev/PHP-+-nginx-+-mysql-@-docker%EB%A1%9C-%EA%B2%8C%EC%8B%9C%ED%8C%90-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0/" rel="permalink">PHP + nginx + mysql @ docker로 게시판 구현하기
</a>
      
    </h2>
    <!--
      comments:
        아카이브 싱글 페이지 각 포스트 제목 하단에 Updated 시간 표기
        기존에는 read_time이 표기됨
    
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  37 분 소요

</p>
    
    -->
    
    <p class="page__meta"><i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> February 25 2020</p>
    

    <p class="archive__item-excerpt" itemprop="description">Overview
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/dev/Hello-Design-Pattern/" rel="permalink">Hello Design Pattern!
</a>
      
    </h2>
    <!--
      comments:
        아카이브 싱글 페이지 각 포스트 제목 하단에 Updated 시간 표기
        기존에는 read_time이 표기됨
    
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  6 분 소요

</p>
    
    -->
    
    <p class="page__meta"><i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> February 19 2020</p>
    

    <p class="archive__item-excerpt" itemprop="description">HelloWorld!
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>팔로우:</strong></li>
    

    
      
        
          <li><a href="https://github.com/wizleysw" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> 피드</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2020 Wizley. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>










  </body>
</html>
